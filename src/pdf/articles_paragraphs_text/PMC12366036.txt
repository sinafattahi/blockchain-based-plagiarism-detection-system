As important mobile elements in prokaryotes, prophages shape the genomic context of their hosts and regulate the structure of bacterial populations. However, it is challenging to precisely identify prophages through computational methods. Here, we introduce PIDE for identifying prophages from bacterial genomes or metagenome-assembled genomes. PIDE integrates a pre-trained protein language model and gene density clustering algorithm to distinguish prophages. Benchmarking with induced prophage sequencing datasets demonstrates that PIDE pinpoints prophages with precise boundaries. Applying PIDE to 4744 human gut representative genomes reveals 24,467 prophages with widespread functional capacity. PIDE is available athttps://github.com/chyghy/PIDE, with model training code athttps://zenodo.org/records/16457629.

The online version contains supplementary material available at 10.1186/s13059-025-03733-0.

Bacteriophages, or phages, are viruses that infect bacteria and the most abundant and diverse entities in the biosphere [1]. They mainly exhibit two life cycles: the lytic cycle and the lysogenic cycle. Unlike obligate lytic phages, temperate phages have a life cycle that involves a decision-making process between lysis and lysogeny. During lysogeny, temperate phages integrate their genomes into bacterial genomes as prophages, remaining dormant until an induction signal is sensed [2]. A previous study found that over 80% of bacterial strains from infant feces could produce phages when exposed to mitomycin C [3], highlighting the prevalence of lysogeny in the human gut. As a result, lysogeny not only regulates bacterial community structure but also contributes to genetic variation by disrupting host genes or introducing new functions [4–7], and certain defective prophages can have a significant impact on the host’s physiological functions [8–10]. Therefore, identifying prophages, even defective prophages, in a given environment is essential for understanding their effects on bacterial hosts. Due to challenges in determining prophage activity and the presence of mobile genetic elements carrying phage-related genes, this study uses the term “Prophage Island (PI)” to refer to genomic regions that may include complete prophages, prophage remnants, or other phage-related elements.

Given their significance, various prophage identification tools have been developed, each employing distinct strategies. For instance, VirSorter2 employs random forest classifiers on sliding windows to detect viral segments in non-viral regions [11]. PHASTER identifies phage genes via BLAST and uses gene clustering density measurements to locate prophages [12]. Similarly, Prophinder and ProphET use BLAST to identify genomic segments statistically enriched in phage-like genes [13,14]. The recently published geNomad also employs a conditional random field model to identify viral marker-enriched regions within bacterial chromosome [15]. The common strategy across these tools involves identifying phage-like open reading frames (ORFs) through sequence similarity searches or machine learning classifiers, and subsequently detecting regions with high enrichment of phage ORFs. The success of pre-trained language models in natural language processing has spurred a growing interest in applying similar deep learning techniques to biological tasks. Protein language models based on Transformer architecture are adept at uncovering complex patterns within protein sequences to decipher their structures and functions. Evolutionary Scale Modeling (ESM)−2, a protein language model pre-trained on millions of unique protein sequences from the UniRef database, can capture both sequence information and functional characteristics of proteins [16]. It can be easily adapted by finetuning a small proportion of parameters for specific tasks [17,18].

Here, we introduce a tool named PIDE (prophage island detection using ESM-2) to detect prophage islands. PIDE first accurately predicted phage ORFs from bacterial genomes by finetuned ESM-2 with 650 million parameters, and subsequently pinpointed prophages by employing a statistical algorithm to cluster predicted phage ORFs based on gene density. Furthermore, we validated the performance of PIDE using induced prophage sequencing datasets from 38 bacterial strains. Last, we applied it to bacterial genomes derived from human gut microbiome data and found that PIs were widely present in gut bacteria and functional analysis indicated that these PIs could potentially influence their host resistance and metabolism.

PIDE is an automated, user-friendly tool specifically developed for the identification of PIs within bacterial genomes. The tool consists of two core stages: (1) identifying phage ORFs; (2) detecting regions with high enrichment of these ORFs. In the first step, the deep learning model for phage ORF prediction adopts ESM-2 with 650 million parameters as the extractor for 1D sequence embedding (Fig.1a). Then, the sequence embedding is fed into a multi-layer perceptron (MLP) classifier with five layers to obtain the classification for each ORF, where ORFs with the probability over 0.5 are considered as phage ORFs. Next, as many PIs may carry bacterial genes which are also known as cargo genes, the PIs may exhibit characteristics of clustered prophage genes accompanied by scattered bacterial elements (Fig.1a). Here, we cluster adjacent prophage ORFs into a single PI, ensuring that the intergenic distance between adjacent prophage ORFs is less than the clustering distance thresholdD. And to obtain relatively high-confidence PIs, we ensure that the PI score (P), which is the average probability of each ORF based on the MLP output, is not less than 0.7. If thePfalls below 0.7, we iteratively trim ORFs one by one from both ends untilPreaches or exceeds 0.7. Empirically, we require the PI to include at least five phage ORFs to output PI information [19] (Fig.1b).

The accuracy of the model on the test set reached 0.90, the F1 score reached 0.90, the AUC reached 0.96, and the AP reached 0.95 (Fig.1c, Table1). To evaluate the performance of the fine-tuned ESM2-based classifier (PIDE-ESM2), we compared it against three alternative methods—BLASTP-TOP, BiLSTM, and Transformer Encoder—using the same training and testing datasets (see the “Methods” section). PIDE-ESM2 consistently outperformed all competing models across all metrics (Additional file 1: Fig. S1).

To further investigate the contribution of the step of finetuning ESM-2, we performed an ablation study. Without finetuning, the evaluation performance of the model dropped, especially in the recall, demonstrating the benefit of fine-tuning (Fig.1c). Fine-tuning ESM-2 yields modest performance improvements, which is a common situation for some specific tasks [20], as the pre-training of ESM-2 on a vast corpus of protein sequences already learned a broad range of features relevant to these tasks. While the gains are incremental, fine-tuning enhances the specificity of this model for phage-bacteria protein discrimination without compromising inference speed or usability.

Next, we assessed the impact of differentDvalues on PI identification, as largerDvalues tend to introduce false positives by including bacterial sequences within prophages, whereas smallerDvalues can fragment prophage sequences, leading to the omission of potential prophage-associated genes. To assess the effectiveness of differentDvalues in predicting prophages, we calculated the number of PIs predicted by PIDE for each single complete PhaTYP-predicted temperate phage genome from the RefSeq [21,22], as temperate phages typically have the capacity to form prophages, making their genomes closely aligned with the biological context of prophages. A greater number of predicted PIs within a single complete temperate phage suggest lower effectiveness of PI prediction. Nine differentDvalues ranging from 1 to 5 kb were tested. At the distance threshold of 1 kb, PIDE fragments 32% of phages into two or even nine segments; at 3 kb, 95% of phages remain unfragmented. And at 5 kb, 99% remain unfragmented (Fig.1d, e). Here, PIDE defaults to the 3 kb threshold to strike a balance between minimizing false positives and maintaining the integrity of prophages. At this threshold, further analysis revealed that 93.5% of PIs predicted by PIDE achieve a genome coverage of over 90% for the original reference genome, with the missing regions mainly located at the ends of the phage genome (Additional file 1: Fig. S2a, S2b).

Some PIs may contain numerous nonphage-related genes with scattered phage-related genes within the 3 kb threshold (defaultDvalue), leading to a proportion of cargo genes exceeding 50%, which may result in false positives. Given that up to 60% cargo genes have been observed in PhaTYP-predicted temperate phage genomes (Additional file 1: Fig. S2c), PIDE did not set cutoff on the percentage of bacterial cargo genes relative to the total ORF number. The proportion of cargo genes within each PI was included in the PIDE report, and users can enforce stricter criteria based on their specific research needs for downstream analysis. We did not include any cutoff in the following analysis.

We evaluated PIDE alongside three other widely used tools on 38 gut-derived bacterial isolates with complete whole genome sequences available. A total of 365 PIs were identified using PIDE, whereas geNomad, Virsorter2, and PHASTER identified 142, 101, and 174 PIs, respectively. PIDE successfully predicted 84% of geNomad predictions, 80% of Virsorter2 predictions, and 55% of PHASTER predictions, demonstrating the highest performance in recovering overlapping PIs across different tools (Fig.2a). Moreover, PIDE identified the highest number of unique PIs not predicted by other tools, with 184 out of 365 PIs being unique, followed by PHASTER (Additional file 1: Fig. S3a). To validate these predicted PIs, we conducted BLAST searches against the NT database (evalue < 1E-10) to identify potential viral sequences which have been previously reported. Among the 181 PIs predicted by PIDE and at least one other tool, 132 were alignable, with 99 exhibiting coverage of ≥ 50% (Fig.2b). For unique PIs with coverage ≥ 50%, PIDE had the highest alignable count at 24, followed by PHASTER with 5, VirSorter with 1, and geNomad with 0 (Fig.2c, Additional file 1: Fig. S3a). The remaining unalignable sequences may represent novel, unidentified phages, although they could also include false positives.

Genome completeness assessment of the identified PIs was performed using CheckV [23]. Of the 365 PIs identified by PIDE, 34 exhibited high completeness with the completeness score greater than 90 (Additional file 1: Fig. S3b). Notably, among the 53 PIs showing activity in mitomycin C-induced prophage sequencing, 39.6% had completeness scores greater than 90, and 11.3% had completeness scores lower than 20 (Additional file 1: Fig. S3c), indicating that even prophages with lower completeness scores may still be inducible by mitomycin C. The completeness score assessment relies on reference databases, which may hinder its ability to identify novel prophage elements that are not well represented in existing databases. Therefore, we retained all PIs predicted by PIDE, allowing users to perform further selection based on completeness analysis.

For further analysis, we selected a prophage-like element (PIDE-Ef PI) identified exclusively by PIDE, which originates fromEnterococcus faecalisV583 and spans 12,704 bp. The classification model predicted that this PI harbors 20 phage-associated genes out of a total of 23 (Fig.2d). Furthermore, sequencing data from mitomycin C-induced prophages revealed discernible activity of the PIDE-Ef PI relative to adjacent genomic regions (Fig.2e). Overall, these results demonstrated the superior sensitivity of PIDE in predicting PIs.

Besides, the induced prophage sequencing data can help provide precise insights into the boundaries of active PIs, which can serve as a reliable ground truth. Hence, we computed and compared the base recall and base precision metrics for PIs identified by different tools (see the “Methods” section), aiming to assess their accuracy in boundary delineation. The results demonstrated that PIDE exhibited the highest base precision with a mean score of 0.91, followed by geNomad at 0.81, PHASTER at 0.7, and Virsorter2 at 0.35. In terms of base recall, Virsorter2 achieved the highest mean score at 0.94, followed by PIDE at 0.91, geNomad at 0.90, and PHASTER at 0.80 (Fig.2f). Notably, VirSorter2 systematically overpredicted PI boundaries, whereas PHASTER frequently missed portions of PI regions—a pattern illustrated by two representative examples in Fig.2g. Together, these results indicate that PIDE outperforms other tools in independent validation tests, enhancing our capacity to infer the gene pool and ecological dynamics of naturally occurring PIs.

PIDE can also be used to identify phage-derived contigs. To determine whether a contig is phage-derived, we assessed the proportion of phage-like ORFs relative to the total number of ORFs. Contig length can affect the accuracy of identifying phage contigs, so we first established the optimal thresholds for the phage-like ORF proportion across different contig lengths. We simulated 60,000 contigs of various lengths (0.5 kb, 1 kb, 3 kb, 5 kb, 10 kb, 20 kb) from 6099 phage genomes in RefSeq and 4744 representative bacterial genomes from the Unified Human Gastrointestinal Genome (UHGG) [24]. These simulated contigs were analyzed by PIDE for phage ORF prediction, and the phage-like ORF proportions were calculated. The optimal thresholds for contigs of 0.5 kb, 1 kb, 3 kb, 5 kb, 10 kb, and 20 kb were determined to be 1, 1, 0.57, 0.56, 0.53, and 0.52, respectively (Fig.3a).

Performance metrics were assessed using an additional set of ten independent samples and compared with VirRep, a state-of-the-art hybrid language representation learning framework for identifying viruses from metagenomic contigs [25]. While PIDE demonstrated higher precision across most sequence lengths, its performance for shorter sequences (0.5–1 kb) was limited, detecting less than 50% of phage sequences. F1 score comparisons indicated that PIDE showed an advantage over VirRep in predicting phage contigs for longer sequences (> 3 kb) (Fig.3b). These results highlight the complementary strengths of both tools, with PIDE excelling for longer sequences and VirRep demonstrating better performance for sequences in the 1–3 kb range.

Next, we applied PIDE to 4744 species representatives derived from the human gut microbiome to survey the PI features in the human gut microbiome. A total of 24,467 PIs were detected across 4198 genomes (88.5% prevalence). The high prevalence of PIs in the gut microbiome underscores lysogeny as a widespread strategy for phage survival in the gut ecosystem, highlighting the potential role of prophages in shaping microbiome composition and function. On average, prophage-derived sequences constituted 2.8% of their host genomic content, with an interquartile range from 0.8 to 3.6%. A genome contained an average of 6 PIs, with a maximum of 42. And these islands varied widely in size, with a median of 7738 bp, and up to 205,026 bp (Additional file 1: Fig. S4a). Of particular significance was the discovery of a 205,026 bp prophage within a genome ofCoprobacillus, representing genomic evidence for the existence of jumbo prophages. Genomic annotation using Pharokka revealed characteristic features of prophages and jumbo phages, including genes associated with integration, lysis, structural morphogenesis, and DNA replication (Additional file 1: Fig. S4b). Furthermore, we detected numerous cargo genes encoding various metabolic enzymes, including NAD synthetase, nicotinamide phosphoribosyl transferase, and lipoproteins, suggesting that this jumbo prophage may play roles in regulating bacterial host metabolism and membrane remodeling (Additional file 1: Fig. S4b).

In analyzing the distribution of PIs across different taxonomic groups, we observed significant inter-phylum variations. Among the four most prevalent phyla, Proteobacteria genomes harbored the highest average number of PIs per genome, followed by Firmicutes, Bacteroidota, and Actinobacteriota, with respective median values of 6, 5, 5, and 2 PIs per genome (Fig.4a). Among prevalent gut bacterial genera,Bacteroidesexhibited the highest median number of PIs per genome, followed byClostridium,Enterococcus, andRuminococcus, with respective values of 11, 9, 9, and 8 PIs per genome. In contrast,Alistipesshowed fewer andCollinsellathe fewest, with respective values of 4 and 2 (Fig.4b). These findings suggest that the occurrence frequency of lysogeny varies significantly across different bacterial taxa.

Among these 4198 lysogens, 4039 (96.2%) were predicted to contain PIs carrying cargo genes, with cargo genes accounting for a median of 23.8% of total PI length (Additional file 1: Fig. S4c). To understand the potential functions of prophage-carried genes, we annotated PI ORFs using eggNOG-mapper v2 [26]. And 183,410 out of 399,565 predicted ORFs (45.9%) were assigned to the specific COG categories. Then, we calculated the prevalence of each COG category encoded by PIs in all bacterial genomes. In addition to genes typically found in phages related to replication, recombination, and transcription, a significant proportion of bacterial PIs carry genes involved in regulating the bacterial cell cycle, amino acid transport, and metabolism, as well as defense-related pathways (Fig.4c). To further refine these functional annotations, we employed a deep learning-based functional annotation method that provided additional resolution by assigning 93.4% of ORFs to 732 distinct GO terms (Supplementary Table 1) [27]. This multi-method annotation framework significantly expanded the known functional repertoire of human gut prophages.

Due to the potential horizontal transfer of antibiotic resistance genes (ARGs) from commensal bacteria in the gut, especially those within PIs, we conducted a more detailed analysis of the ARGs carried on PIs. Our analysis showed that 34.2% of bacteria contained PIs carrying 120 different types of ARGs categorized into 18 types involving resistance to various antibiotics through different mechanisms (Additional file 1: Fig. S4d). The most abundant types of ARGs included genes resistant to a wide range of antibiotics, such as beta-lactamases, glycopeptides, aminoglycosides, chloramphenicol, fluoroquinolones, and tetracyclines. Next, we normalized for the absolute number of bacteria within each phylum to compare the proportions of PIs carrying different types of ARGs across various phyla. The result indicated that PIs of Cyanobacteria nearly carried all kinds of ARGs, except for TE inactivator (Fig.4d). Previous studies have revealed that Cyanobacteria serve as vital reservoirs for antibiotic resistance genes [28]. Apart from these bacteria that may originate from environmental contamination, PIs carrying ARGs were mainly from Bacteroidetes, Proteobacteria, and Firmicutes, while they occurred less frequently in Actinobacteria.

Moreover, we found that 3.3% of bacteria carried PIs harboring metabolic related genes, which might modulate bacteria physiology. Pyruvate to acetate/formate and cyclic-lactone-autoinducer were the most abundant primary and secondary pathway, respectively (Fig.4e). And the main PI carriers of these related genes were from Firmicutes. Overall, these results demonstrate that the PIs harbor a diverse array of functional genes, which may contribute to the physiological processes within the human gut microbiota.

Identifying prophages is essential for elucidating the mechanisms of bacteria-phage interactions and understanding microbial community structure and function [29]. Here, we introduce PIDE, a novel framework for identifying prophages in whole bacterial genomes or MAGs. Large pretrained protein language models have demonstrated significant progress in annotating protein functions [16–18]. Compared to existing tools [11–13,30], a key innovation of PIDE is its incorporation of a large language mode to differentiate phage genes from bacterial genes. This capability is particularly important for identifying PIs that may have been previously overlooked. Additionally, PIDE features a custom-developed gene clustering algorithm specifically designed for prophage detection. We also employ a benchmarked distance threshold to ensure optimal performance and accurate identification of PI sequences. By sequencing phages induced from isolated bacterial strains, we have generated reliable data that showcases active prophage regions, providing a benchmark for evaluating the performance of various tools.

Compared to previous tools, the boundaries predicted by PIDE can achieve both high base recall and base precision at the nucleotide level. To be noted, PIDE identifies better prophage boundaries by accurately identifying the first or last phage ORF of the prophage, which can narrow down the search range for these attachment sites. However, it cannot predict the exact attachment regions of prophages. Other methods, identifying the split reads generated by lysis-lysogeny switch or searching for attachment site core sequences, such as Prophage tracer [15,31], can be integrated for further identification of the prophage attachment sites.

PIDE is also capable of predicting phage contigs in metagenomic data, even though it was not originally designed for this purpose. Considering that it is based on identifying multiple prophage genes within a certain region, it is understandable that precise results cannot be obtained when predicting shorter contigs (≤ 3 kb). Another algorithm, which can be used to predict short viral contig accurately, such as VirRep [25], can be integrated with PIDE for a good analysis of viral contig searching. It is important to note that PIDE may struggle to differentiate between authentic prophages and mobile genetic elements containing phage-associated genes. To mitigate this source of false positives, employing more stringent evaluation criteria should be considered—particularly through analyzing the proportion of phage-related genes within genomic islands (the number can be obtained from PIDE output) and integrating the phage completeness score into downstream analyses [23].

Applying PIDE to human gut microbiome revealed the widespread presence of prophages, as 88.5% of the bacteria harbor PIs. This is comparable to a previous report, which profiled prophages in more than 40,000 bacterial genomes using alignment-based method [32]. However, the average number of PIs detected in each genome doubled (5.9 vs 2.4) compared to the previous study. Although some of the PIs identified by PIDE may be not complete or active prophages, it still largely enhances the ability to discover prophage-like elements in the bacterial genomes. We also identified a well-annotated jumbo prophage. While jumbo phages (> 200 kb) identified through experimental studies have so far only been observed to follow lytic cycles, the discovery of a jumbo prophage suggests that lysogenic life cycles may also exist for this phage class [33]. This finding is particularly intriguing in light of previous bioinformatic reports identifying integrase genes in some jumbo phage genomes, thereby broadening our appreciation of phage genomic diversity [33]. Further exploration of prophages with unique characteristics using PIDE and different bacterial genomes will contribute to a deeper understanding of prophage diversity.

The taxon-specific patterns in PI distribution have important implications for understanding gut microbiome dynamics. The prevalence of lysogeny among Proteobacteria, particularly in pathogenic genera likeEscherichiaandSalmonella, may contribute to their adaptability and occasional pathogenicity [34,35]. Furthermore, these PIs harbor various genes associated with bacterial survival and adaptation, including antibiotic-resistance genes and metabolism-related genes. Prophage-encoded antibiotic-resistance genes have been documented to be significantly enriched in human-associated environments, notably highlighting the role of human-derived prophages as key reservoirs for antibiotic-resistance genes [36]. This again underscores the importance of systematically profiling prophage-like elements within bacterial genomes. The identified prophage-encoded genes could also enhance our understanding of bacterial ecology and evolution, aid in the development of novel antimicrobial strategies, and inform the design of targeted therapeutic interventions [29,37–39]. Further experiments are needed to elucidate the functions of prophage-encoded genes.

In conclusion, PIDE offers a highly accurate method for identifying prophage island regions with precise boundary detection, utilizing both bacterial and metagenome-assembled genomes. Additionally, it can be employed for viral contig identification. We believe that PIDE will enhance the exploration of microbiome and virome data, contributing valuable insights to microbiome research.

The phage and prokaryotic proteins from UniRef50 database (May 2024 version) were downloaded for training the classification model [40]. The phage dataset comprised 263,843 sequences, while the bacteria and archaea dataset contained 40,572,403 sequences. Highly similar sequences to those in the phage dataset were removed from the bacteria and archaea datasets with cd-hit-2d (sequence similarity > 95%) [41], resulting in 40,566,921 sequences. Subsequently, 263,843 sequences were randomly sampled from these 40,566,921 sequences to achieve a 1:1 ratio of positive to negative samples. Then, the dataset was randomly partitioned into training, validation, and test datasets with a ratio of 7:1.5:1.5.

The ESM-2 model with 33 Transformer Encoder layers and 650 M parameters were used for the classification of phage protein. The input protein sequence is first tokenized and subsequently encoded into an embedding representation. Then, the embeddings are averaged based on sequence length, yielding a 1280-dimensional vector. This vector is fed into a five-layer MLP, where each layer employs ReLU activation. Finally, the probability value of phage protein is obtained by processing the MLP output using a softmax layer. A protein with a value greater than 0.5 is generally considered to be a phage protein. During training, the last four layers of the Transformer Encoder were fine-tuned, while the remaining layers were kept frozen. Additionally, the MLP parameters were optimized from scratch. The learning rate was set to 5e-6, with a batch size of 4 and a weight decay of 1e-5. The model converged after 2 epochs.

where TP, FP, TN, and FN mean the number of true positive, false positive, true negative, and false negative samples during a test.

For comprehensive benchmarking of the binary classification module of PIDE, PIDE-ESM2, which determines whether an ORF belongs to a bacterium or a phage, three comparative methods were implemented alongside PIDE-ESM2. These methods include the following: BLASTP-TOP, where test sequences were matched to their lowest E-value counterparts in the training set without imposing threshold constraints on the BLASTP search to maintain binary classification parity; a two-layer bidirectional LSTM (BiLSTM); and a two-layer Transformer Encoder. All models were trained on identical datasets, with the training set serving either for database construction or model parameter optimization, followed by standardized evaluation on the same test set.

Prophages can enter lytic induction spontaneously or upon induction by mitomycin C or other agents, initiating replication, proliferation, and the release of numerous progenies from bacteria [29]. As a result, the majority of reads from induced prophages sequencing data originate from potentially active prophages, leading to significantly higher read coverage in these regions compared to the surrounding regions. Given that there are few data sets that accurately annotate the prophage region of bacteria and lack a gold standard for evaluating the effectiveness of different tools, we isolated and purified virus-like particles (VLPs) from 38 different bacterial cultures. The VLP DNA was extracted and amplified for sequencing.

The raw sequencing reads were first treated using fastp to remove adapters, duplicate reads, and low-complexity reads [42]. Then, the clean reads were mapped against the bacterial genome using bowtie2 [43]. To pinpoint these active regions, Homer (-style histone) was applied to call peaks, particularly adept at identifying broad peaks [44]. Given that most prophages span several to tens of kilobases and there is a feature of non-uniform read coverage across prophage positions, peaks within the same prophage may appear discontinuous (Additional file 1: Fig. S3d). Bedtools was employed to merge peaks within 6 kb into a single peak to reconcile this [45].

The following tools were included in our benchmarks: geNomad (version 1.8.0), VirSorter2 (version 2.2.4), and PHASTER. The tools were executed with default parameters.

Given that PIs are cryptic and some others could not be triggered, we focused our comparison on the potential inducible prophage regions which were defined as the union of prophages predicted by the four tools that intersected with the identified peaks. And the regions of these peaks were used as the experimental gold standard to evaluate the performance of the four tools in predicting prophages. For each peak, the base recall score was defined as the proportion of the region predicted by a specific tool that covered the peak region. For each predicted prophage by a specific tool, the base precision score was defined as the proportion of the peak region that covered the predicted prophage region.

PIED was employed to analyze the prophage characteristics in the human gut microbiome. A total of 4744 representative genomes of species derived from the human gut microbiome were retrieved fromhttp://ftp.ebi.ac.uk/pub/databases/metagenomics/mgnify_genomes/human-gut/v2.0.2/species_catalogue/[24].

The PI sequences were extracted using seqtk (https://github.com/lh3/seqtk) and functionally annotated using eggNOG-mapper with default settings [26]. gutSMASH and antiSMASH were employed to annotate genes involved in primary and secondary metabolism on prophages, respectively [46,47]. And these PIs were also queried against the Resfams profile HMM database to identify potential resistance genes [48].

Additional file 1. Supplementary figures, Fig. S1–S4. Fig. S1 Performance benchmarking of PIDE-ESM2. Fig. S2 The ability of PIDE to recover phage genomes at different thresholds. a, Coverage distribution of PIDE-predicted PIs in original phage genomes across various length ranges withD= 3 kb. Red line represents the overall distribution. b, Relative genomic coordinates of PIDE-predicted PI withD= 3 kb. All sequence lengths were normalized to 1. Each horizontal line represents an original phage sequence, with yellow color indicating the regions covered by PIs and black indicating the PI-uncovered regions. c, Density plot showing the proportion of cargo genes in temperate phage genomes. Fig. S3 PIs predicted by different tools. a, Venn diagram indicating the total number of PIs predicted by each of the four software tools, the number of unique PIs for each software, the number of unique PIs matched to viruses in the nr database, and the number of matches with coverage ≥ 50%. b, CheckV-evaluated genome completeness distribution of PIDE-predicted PIs. c, CheckV-evaluated genome completeness distribution of the potentially active PIs. d, An example showing the regions of Homer-predicted peaks and the distribution of virome reads in those regions and their surrounding areas. Fig. S4 The characteristics of PIs in human gut microbiome. a, The length distribution of the 24,467 PIs. b, Gene annotations of the PIDE-identified jumbo prophage using Pharokka. c, The distribution of the proportion of cargo genes relative to the total genes in PIs in length. d, The number of PIs carrying different types of ARGs.

We are grateful to members of the Liang laboratory for their help and suggestions.

Tim Sands was the primary editor of this article and managed its editorial process and peer review in collaboration with the rest of the editorial team. The peer-review history is available in the online version of this article.

H.G., B.L. and G.L. conceived the project and wrote the manuscript. B.L. and H.G. designed the method. Z.G. conducted experiments. Z.G., L.Z. and J.C. helped with data analysis. All authors revised the manuscript and approved the final version for submission.

This work was supported by the Natural Science Foundation of China (32200036, 82341116), the Start-up Foundation of Tsinghua University (400–53332101822), Tsinghua University Initiative Scientific Research Program, Tsinghua University Dushi Program (20241080062), SXMU-Tsinghua Collaborative Innovation Center for Frontier Medicine Foundation, and Tsinghua-Peking Center for Life Sciences (045–61000100122).