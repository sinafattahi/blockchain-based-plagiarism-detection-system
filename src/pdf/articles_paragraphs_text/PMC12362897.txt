The Epidemiological Unit of the Agency for Health Protection of Milan (ATS) calculates several indicators, at hospital and at patients’ residence area level (group level of analysis), with monitoring and programming scopes. Outcome indicators are usually influenced by differences in subject case-mix; therefore, adjustment methods are applied to compare each group level with mean ATS values. Inverse probability weighting (IPW) is explored as an alternative to multivariable generalized linear model (GLM), to overcome some limitations of the latter method.

To implement IPW, a multinomial logistic model, with group level as dependent and subject characteristics as independent variables, was used to estimate patient weights, which were subsequently stabilized and truncated. Checks on IPW assumptions and covariates balance were implemented both in a quantitative and in a graphical way. Comparisons on adjustment performed with fixed effects and random intercept multivariable GLM were performed and exemplified using three outcome indicators.

IPW assumptions were satisfied for all the indicators, and covariate balance presented minor issues for group levels with the lowest number of cases/events. Case-mix adjustment performed with multivariable fixed effects GLM showed a tendency to overestimate raw values and was characterized by broad confidence intervals in the three case-example indicators. Adjusted values produced using random intercept multivariable GLM suffered from a shrinkage towards the mean effect, particularly evident in the indicators with the lowest number of cases. IPW-adjusted estimates differed from raw values only when substantial differences in covariates distribution were present.

Provided that appropriate checks are implemented, IPW adjustment is applicable in the context of healthcare quality evaluation and can be easily conveyed to healthcare managers for effective dissemination.

The online version contains supplementary material available at 10.1186/s12913-025-13203-9.

Sets of indicators evaluating quality of delivered healthcare have been developed in many Healthcare Systems [1–3], either targeting different clinical areas at hospital level (i.e. analysing patients treated in a hospital) or local care (i.e. evaluating residents in an administrative geographic area), including primary care and prevention. In Italy two systems are currently in place at the national level [4,5]: the Programma Nazionale Esiti (PNE, National Outcomes Programme), primarily evaluating hospital outcomes, and the Nuovo Sistema di Garanzia (NSG), evaluating several aspects of care (public health, local and hospital care, health needs and equity).

Comparisons of healthcare outcomes among different areas or providers, either relative (i.e. ranking) or against a standard (e.g. global mean), can be confounded by patient characteristics and risk profiles. Fixed and random effects multivariable regression models are the most frequently used case-mix adjustment methods in this context [6–8]. More recently, Tang and colleagues proposed the use of inverse probability weighting (IPW) [9].

Direct standardization with fixed effects multivariable generalized linear models (GLM) allows direct comparisons across group levels of analysis, but its application results in large standard errors for small structures or areas. Using mixed-effects GLM with a random intercept for the group level of analysis also allows for direct comparison having the advantage to produce more stable estimations for small structures, as the assumption that indicator values across units have a common distribution allows to “borrow some strength” [10] from larger units reducing the problem of high random variation for small units of analysis. However, this method may excessively reduce intra-unit variation, while shrinking estimation towards the group mean, and relies on the assumption on the distribution of the indicator values, which is unknown. Consequently, both fixed and random effects models have limitations in providing an accurate representation when evaluating geographic areas or providers that do not have homogeneous case-mix [6]. From a theoretical perspective, adjustment performed using IPW offers several advantages over the previously described methods. According to the literature [11,12], it allows dimensionality reduction in presence of a large number of pre-treatment covariates and avoids extrapolating beyond observed data when groups are disparate on pre-treatment variables. Moreover, weights modelling is performed without any use of the outcome, avoiding model specification to be influenced by adjustment effects on the outcome [9]. On the other hand, the use of IPW in the public health indicator context is limited by the lack of practical guidance when comparing multiple units [11]. There is a limited number of studies using IPW in the context of institutional comparisons in healthcare [9], where the number of group levels of analysis can be very high and there are often levels with very few units. Under these circumstances, it is demanding to check the performance of the model by summarizing and visualizing the information concerning overlap and covariate balance [11].

The Agency for Health Protection of Milan (Italian acronym ATS) guarantees the governance of the Health and Social Care providers Network in an area with about 3.5 million inhabitants, which includes the metropolitan area of Milan and the province of Lodi (Northern Italy). Over the years, the Epidemiology Unit of the ATS of Milan has implemented several groups of health indicators, including those in place at national level, to evaluate healthcare processes and outcomes based on administrative health data. The implemented indicators are intended to be used by the Territorial Providers of Social and Health Care (Italian acronym ASSTs, which include both hospitals and districts that are responsible for local care and prevention), private hospitals and ATS managers to identify potential issues and possible areas of improvement as well as to monitor public health policies over time. Several outcome indicators are implemented, which are usually heavily influenced by differences in case-mix such as demographic and socioeconomic ones. The objective of our study is to evaluate the feasibility of applying the IPW adjustment method to compare health outcome indicators across the group level of analysis, i.e. administrative areas or providers, with those of the entire ATS. Our goal is to demonstrate that IPW is an alternative method that, in addition to having solid theoretical foundations, can be implemented in practice quite easily on a large number and variety of indicators, and that it has some practical advantages over the most frequently used multivariable regression models, especially in case of small-sized group levels of analysis.

The indicators are calculated aggregating subjects at the group level of analysis, which can be either the administrative area of residence (eight ASSTs, subdivided into 25 districts) or the hospital performing the procedure/service under evaluation (maximum number 48).

Indicators are computed as proportions, rates, means or medians, providing yearly values. This paper focuses on proportion-based indicators (see Table1).

All the data used for the calculation and adjustment of indicators are administrative and routinely collected for health system management purposes at patient level for the 3.5 million of residents in the ATS area. Demographic data (including date of death), hospitalizations, ambulatory care, drug prescriptions and exemptions are examples of the information available to the ATS as routinely collected data. For each indicator, a dataset is created containing patient information on the event of interest, comorbidities and demographic data. Indicators are usually calculated on a yearly basis, unless otherwise specified, starting from 2015 until the most recent year. Patients comorbidities are evaluated using a consolidated algorithm [4] considering all available sources of information (including hospital discharge records, outpatient records, drug prescriptions and co-payment exemptions data) over a 10-year period.

We adopted the IPW method to estimate the Average Treatment Effect (ATE) [11] to compare districts/ASSTs or hospitals values with those of the ATS of Milan.

The IPW method is based on the idea of assigning a weight to each subject in a group in order to reproduce for each group a pseudo-population similar to that of the entire population [12], which means that confounding variables result well balanced in all groups after weighting. The weights are calculated on the basis of each patient’s probability of being assigned to their own group according to their characteristics. Using a multinomial logistic model with the unit of analysis as the dependent variable, for each patient and for every group level we evaluated the probability of patients being assigned (i.e. residing in or being treated by) that specific level, according to their demographical characteristics, citizenship and comorbidities. To comply with privacy policies, group levels with a denominator in the latest available year or a mean value in the available period since 2013 of less than five were excluded from the analysis. A model was fit for each year of inclusion in the at-risk group. If convergence was questionable for at least one year, a single multinomial logistic model was evaluated using all the available years.

Adjustment variables were chosen on the basis of clinical relevance, collection reliability, practicability, sufficient comprehensiveness, association with the outcome and clear definition [13].

Age, modelled as a natural 4-knot cubic spline, citizenship (Italian vs. non-Italian) and sex (when appropriate) were always included in the analysis as independent variables. The year of calculation was only included when evaluating the model using data from all years. Patient’s comorbidities were evaluated in the year before their inclusion in the at-risk group. A comorbidity was included in the model, regardless of statistical significance, when an association with the outcome was established in the literature and when it affected more than 5% and less than 95% of all patients, in order to avoid model convergence issues [14,15].

According to IPW theory the assumption of positivity, or overlap, has to be satisfied. In our context, positivity/overlap is the assumption that all subjects have a non-zero probability of belonging to each group level [16]. Probability overlap was checked [9] by comparing the distributions of the probability that patients who belong to an index group level could be assigned to any other reference level. Considering the large number of indicators to be adjusted, following Tang et al. [9]., we adopted a synthetic approach by evaluating the Bhattacharyya coefficient and the absolute value of pairwise mean differences (PMDs) or their standardized values for ordered pairs of group levels. Their values were represented through heatmap charts, pointing out group levels with poor overlap.

Subsequently, a weight was evaluated for each patient as the inverse of the probability of being assigned to their actual group level. Stabilized weights were calculated by multiplying the original weights by the overall probability of the group level, estimated as the frequency of patients treated by, or resident in, that particular group level [17,18]. Finally, weights were truncated at the 1 st and 99th percentiles [17]. As a quality check, the mean value of truncated and stabilized weights was compared with the value of 1 within each year.

The intended effect of IPW is to create a pseudo-population for each hospital/area level with characteristics similar to those of the entire ATS area [12]. The effect of IPW in balancing covariates was evaluated by comparing the distribution of covariates (for continuous or ordinal variables) or density (for nominal variables) of each group level with that of the ATS, before and after weighting. Following the ideas proposed by McCaffrey et al. [11]., the maximum value of the absolute differences of the empirical distribution/density functions (EDF/EdF, respectively) between group level and ATS was calculated. It is worth observing that for binary variables the evaluation performed using either EDF or EdF is the same. According to the Authors [11], for modest to large sample sizes a maximum value greater than 10% indicates imbalance. Lastly, unweighted and weighted indicators were evaluated with a logistic model for each group level. Indicator values were calculated by means of the LSMEANS statement in the SAS proc GLIMMIX. By applying the inverse link function, the measures were brought back to the original scale, and can be read as proportions. Robust “sandwich” confidence intervals (CIs) were calculated for the weighted indicators and were compared with ATS values.

As examples, we hereby present the results of IPW adjustment for three indicators, calculated using data on hospital admissions for the year 2022: 30-day mortality among patients admitted for hip fracture (labelled PNE038, evaluated at hospital level), 30-day readmission after a hospitalization for ischemic stroke (PNE019, evaluated for the 25 districts) and 30-day readmission after a hospitalization for heart failure (PNE201, evaluated for the 25 districts). Coincidentally, the number of hospitals to which the calculation of PNE038 was applicable was also 25. The indicators were chosen in order to exemplify different scenarios: total number of cases ranging from small (PNE019) to very high (PNE201); mean ATS indicator values varying from about 5.5% (PNE038, PNE019) to 11.7% (PNE210) and denominators varying widely from one hospital to another (7-651 for PNE038; see Table1).

Number of group levels for which the CI does not include the ATS indicator value.

All analyses were carried out using SAS/STAT software, version 9.4 (PROC LOGISTIC for IPW multinomial model and PROC GLIMMIX for all the other models).

Patients or public were not involved in the research.

In 2022, the total number of cases (denominator) and of events (numerator) varied from 205 out of 3569 for PNE038, to 516 out of 4417 for PNE201 and 141 out of 2637 for PNE019. The range of cases across group levels, the comorbidities included in the multinomial logistic model and those selected by the stepwise method can be found in Table1.

Overlapping issues, evaluated through the Bhattacharyya coefficient, were only found for PNE038 and for two hospitals, which had denominator values equal to 7 and 11 respectively (the third smallest denominator was 57). This means that the probability of subjects treated in other hospitals being treated in one of these two hospitals did not completely overlap with the same probability of subjects actually treated in the two hospitals. Nevertheless, the mean value of truncated stabilized weights was close to 1 (0.998). Bhattacharyya coefficient heatmaps and boxplots representing distributions of weights, stabilized and truncated stabilized weights for the three indicators are provided in FiguresS1andS2-S4in Additional file 1.

To evaluate the effect of IPW in balancing covariates, the maximum values of EDF/EdF differences for selected variables between group levels and ATS are presented, to exemplify cases where balance issues persist or are overcome (Fig.1). Thresholds are placed at 1, 2.5 and 10% points. According to literature, group levels (i.e. hospitals or districts) with value of EDF/EdF difference for a specific variable higher than 10% after weighting present balance issues for that variable. For indicator PNE038, the aforementioned two hospitals with overlapping issues showed poor level of balance for several adjustment variables.

As for the covariate balance, for PNE038 the number of hospitals, out of 25, with differences on EDF/EdF > 2.5% varied from 2 to 22 for 11 variables on raw values and from 1 to 4 for 9 variables, reaching values of 20 and 23 for two variables (age and spline of age), on weighted values.

However, the maximum number of hospitals with differences > 10% after weighting was 2 (5 variables). Similar results were obtained for PNE201 and PNE019 (Fig.1).

Comparisons between the adjusted indicators and their CIs can be found in Table2; Figs.2,3,4. In all examples, the variability (i.e. standard deviation) of FEM indicators was the highest, while that of RIM indicators was the lowest. Variability of IPW indicators was quite similar to that of the raw ones. RIM also showed the lowest variability of CI size. The FEM indicators always exceeded the raw values (mean RD > 0), while RDs were centred on zero for IPW and RIM, with a higher dispersion for the latter. As for RDs of CI size, FEM and RIM adjusted CIs were always respectively higher and lower than those of raw indicators, while the IPW CIs were more similar to the unadjusted ones.

The variation due to adjustment was particularly relevant for RIM in the two indicators with the lowest number of cases (PNE038 and PNE019). This was probably due to a more important shrinkage effect that brought estimated values closer to the ATS mean, regardless of the raw values. On the other side, the variation due to the FEM adjustment was very low for the two indicators evaluated at district level (PNE201 and PNE019), where adjustment variables had similar distributions across districts. IPW adjustment presents the same level of variation as FEM when applied at hospital level and as RIM when applied to a large number of cases.

Kendall’s distance, which measures changes in relative position of group levels after adjustment, shows the lowest values for FEM. RIM applied to a low-medium sample size (PNE038 and PNE019) showed the highest Kendall’s distance, leading to high instability of the relative level position.

The number of group levels for which the CI does not include the ATS indicator value was more similar to the raw one for the IPW adjustment compared to FEM, due to the general overestimation of the fixed effects adjustment.

The Epidemiology Unit of the ATS of Milan calculates all the indicators proposed by the Italian PNE for its local providers and NSG indicators at the ASST and district levels (about 150–200,000 residents each), which are much smaller areas than the Lombardy region (9.96 million inhabitants) used by the Ministry of Health (MOH). Indicators are computed according to publicly available protocols [4,5], with minor deviations attributable to differences in the data available at the ATS level for the NSG. The PNE uses a fixed effects approach for case-mix adjustment, whereas the NSG does not employ case-mix adjustment, with the exception of standardization by age and sex for some rate-based indicators. The adjustment covariates used in the IPW approach are those proposed by PNE, with the inclusion of citizenship. As a further development, we could consider the introduction of other socio-economic factors, such as the deprivation index proposed by Rosano et al. [24], in order to account for patient characteristics that influence the outcome but that are not under the control of healthcare provider. We sought to implement a flexible method that can be used systematically for all outcome indicators computed by the ATS of Milan for comparisons between its hospitals or administrative areas and the ATS mean. Our method should allow us to deal with units characterized by small numbers of cases/events, where obtaining unbiased adjusted estimates for indicators could be difficult [25]. Random effects models may suffer from a severe shrinkage towards population mean effect, especially for small units, resulting in biased outcome estimates. Both random and fixed effects models may suffer from a risk of extrapolation when the unit population differs substantially from the overall population, which is more likely to happen for small units [26]. Moreover, strong extrapolation may lead to inadequate standard error estimation. IPW does not directly perform models on outcome using patient characteristics, thus avoiding model extrapolation.

Balancing covariates to generate a pseudo-population similar to that of ATS for each group level is a key element in IPW adjustment models, which is achieved by assigning weights to patients and needs a careful evaluation. As expected by theory [9], patients of smaller group levels have generally larger weights and, in general, group level size may affect covariate balancing. However, extreme weight distributions are reduced through stabilization and truncation [17,26]. According to Hernán et al. [17], stabilized weights usually result narrower in 95% confidence intervals than non-stabilized weights, while providing the same estimate. In our experience, the normalized weights proposed by Tang et al. [9]. did not provide the same effect on variance reduction as stabilization, which was therefore preferred. Truncation is another method used to reduce weights variance, but its drawback consists in changing the population of inference [12] and may have disproportional effects on different group levels [9]. We decided to adopt truncation at the 1 st and 99th percentile, while assessing balance of confounders in the group levels more exposed to truncation in order to correctly evaluate adjusted values.

Balance assessment was carried out both graphically and by quantitative elements [11]. The quantitative evaluation permits comparison with a standard, to keep track of group levels and covariates that are not well balanced, and to consider poor balancing when interpreting adjusted indicator values.

The three adjustment methods produce quite different indicator and CI values. Adjusted values obtained with the random effects model are strongly shrunk towards the ATS value. CIs calculated with the method proposed by Krumholz et al. [20]. are quite narrow, regardless of the underlying sample size, and the ATS mean value always falls within the CIs. In all the examples, adjusted indicators obtained through fixed effects model are close to or higher than the ATS mean in almost all the group levels, which makes comparisons questionable. Moreover, by using fixed effects models, larger CIs and thus less precise values are estimated even for group levels with higher sample sizes. A possible limitation of our work is due to the fact that the fixed and random effects multivariable GLMs included a subset of the variables we adjusted for when using IPW and that we used the stepwise selection method to obtain this subset. According to several authors, including Harrell [27], the use of this method can lead to several issues, such as biased high regression coefficients, confidence intervals for effects and predicted values that are falsely narrow and p-values that do not have the proper meaning. However, the selection was done on a limited number of clinically significant variables reported in Table1, previously chosen at the national level by groups of epidemiologist and clinicians in the context of PNE (National Outcomes Programme [4]), while socio-demographic variables were always included in the model. The selection was made to reduce the width of the confidence intervals for the fixed effects model and to prevent potential convergence problems in estimating confidence intervals with the method proposed by Krumholz et al. [20] for the random effects model. IPW-adjusted estimates do not usually differ much from raw values, which is quite expected and advisable when differences in covariate distributions across units are modest. Nevertheless, in presence of important differences in distributions of confounders, point estimates were quite different from raw and fixed effects adjusted values, both in terms of effect size and direction (e.g. PNE201 – level D02 and FigureS5in Additional file 1).

In general, we would evaluate an adjustment system positively if it fulfils certain characteristics. Firstly, differences between adjusted and raw values occur in both directions, that is increasing and decreasing the indicator value. In our work, this does not seem to be the case for fixed effects model adjustment. Secondly, accounting for random variation, poorer and higher performers are pointed out with respect to the mean population indicator. This is a complicated issue, as assuming a common distribution for the district/hospital effect, as in the random effects model, would “shrink towards the mean” the estimation for smaller units. This can be viewed positively as it mitigates the effect of larger random variation for smaller units. However, it may also prevent to detect real differences in the indicator existing for smaller units. For example, in our study, the random effects model considerably reduces differences across units. On the contrary, the fixed effects model is known to be more sensitive in this respect, however it may give rise to false positives [28]. At last, adjustment does modify the values of the indicators only if there are differences in the characteristic of the population for one or more group elements (districts or hospitals). In fact, in the study area the population in the districts or hospitals is quite homogeneous, as can be seen in the examples in Fig.1and figureS5for some variables and indicators. Therefore, we do not expect a radical change in the values of the indicators from raw to adjusted for the different districts/hospitals. In the study, the IPW method adequately fulfils this expectation, while the mixed-effect models reduce the value of small unit indicators even in the absence of substantial differences in case-mix.

In summary, the fixed effects multivariable regression model has some advantages in that it is easy to implement and interpret, and it is able to assess the direct effect of individual variables on the adjustment. On the other hand, it can produce overestimated indicator values and is subject to possible extrapolation in presence of small group levels. By adding a random intercept we take into account the variability due to the grouping variable. However, estimates are well known to be shrunk towards the mean especially for small group levels, and calculation of confidence intervals is not straightforward. The use of IPW with multiple levels of the grouping variable may seem more complex to implement than the other models. However, it reduces the risk of extrapolation and, by emphasizing the need to assess respect for theoretical assumptions and balancing, it reduces the risk of biased estimates on small units. Finally, the interpretation of results of the IPW model can be more straightforward by reflecting the idea of a weighting system to reduce differences between populations at the group level.

As long as due controls are implemented on probability overlap, effect of stabilization and truncation of weights, and covariates balance, IPW adjustment is applicable in the context of institutional and geographic areas comparisons for healthcare quality evaluation. Moreover, the idea of reproducing a pseudo-population is quite intuitive, and can easily be conveyed to healthcare managers for effective dissemination of results.

Below is the link to the electronic supplementary material.