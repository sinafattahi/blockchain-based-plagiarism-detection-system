
<!DOCTYPE html>
<html lang="en" >
    <head >

        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="HandheldFriendly" content="True" />
        <meta name="MobileOptimized" content="320" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        
        

        
        
  <link rel="stylesheet" href="/static/assets/style-8258669d.css" />
<script type="module" crossorigin="" src="/static/assets/base_style-f4a99799.js"></script>

  <link rel="stylesheet" href="/static/assets/style-ef962842.css" />
<link rel="stylesheet" href="/static/assets/style-3ade8b5c.css" />
<script type="module" crossorigin="" src="/static/assets/article_style-d757a0dd.js"></script>

  
  
    <style>
  
  
  @media screen and (min-width: 64em) {
    div.pmc-wm {
      background: repeat-y;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='350' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Cdefs%3E%3Cfilter x='-.02' y='0' width='1.05' height='1' id='c'%3E%3CfeFlood flood-color='%23FFF'/%3E%3CfeComposite in='SourceGraphic'/%3E%3C/filter%3E%3Ctext id='b' font-family='Helvetica' font-size='11pt' style='opacity:1;fill:%23005ea2;stroke:none;text-anchor:middle' x='175' y='14'%3E%3C/text%3E%3Cpath id='a' style='fill:%23005ea2' d='M0 8h350v3H0z'/%3E%3C/defs%3E%3Cuse xlink:href='%23a' transform='rotate(90 10 10)'/%3E%3Cuse xlink:href='%23b' transform='rotate(90 10 10)' filter='url(%23c)'/%3E%3C/svg%3E");
      padding-left: 3rem;
    }
  }
</style>

  



        
            <link rel="apple-touch-icon"
                  sizes="180x180"
                  href="/static/img/favicons/apple-touch-icon.png" />
            <link rel="icon"
                  type="image/png"
                  sizes="48x48"
                  href="/static/img/favicons/favicon-48x48.png" />
            <link rel="icon"
                  type="image/png"
                  sizes="32x32"
                  href="/static/img/favicons/favicon-32x32.png" />
            <link rel="icon"
                  type="image/png"
                  sizes="16x16"
                  href="/static/img/favicons/favicon-16x16.png" />
            <link rel="manifest" href="/static/img/favicons/site.webmanifest" />
            <link rel="mask-icon"
                  href="/static/img/favicons/safari-pinned-tab.svg"
                  color="#0071bc" />
            <meta name="msapplication-config"
                  content="/static/img/favicons/browserconfig.xml" />
            <meta name="theme-color" content="#ffffff" />
        

        <title>
            rcprd: An R package to simplify the extraction and processing of Clinical Practice Research Datalink (CPRD) data, and create analysis-ready datasets - PMC
        </title>

        
        
  
  <!-- Logging params: Pinger defaults -->
<meta name="ncbi_app" content="cloudpmc-viewer" />
<meta name="ncbi_db" content="pmc" />
<meta name="ncbi_phid" content="D2E4B53D8AF3A5C305B53D0032A6492A.m_1" />
<meta name="ncbi_pinger_stat_url" content="https://pmc.ncbi.nlm.nih.gov/stat" />
<!-- Logging params: Pinger custom -->
<meta name="ncbi_pdid" content="article" />
  
    <link rel="preconnect" href="https://www.google-analytics.com" />

    
        <link rel="preconnect" href="https://cdn.ncbi.nlm.nih.gov" />
    

    <!-- Include USWDS Init Script -->
    <script src="/static/assets/uswds-init.js"></script>


    <meta name="ncbi_domain" content="plosone">
<meta name="ncbi_type" content="fulltext">
<meta name="ncbi_pcid" content="journal">
<meta name="ncbi_feature" content="associated_data">
<link rel="canonical" href="https://pmc.ncbi.nlm.nih.gov/articles/PMC12364311/">
<meta name="robots" content="INDEX,NOFOLLOW,NOARCHIVE">
<meta name="citation_journal_title" content="PLOS One">
<meta name="citation_title" content="rcprd: An R package to simplify the extraction and processing of Clinical Practice Research Datalink (CPRD) data, and create analysis-ready datasets">
<meta name="citation_author" content="Alexander Pate">
<meta name="citation_author_institution" content="Division of Informatics, Imaging and Data Sciences, University of Manchester">
<meta name="citation_author" content="Rosa Parisi">
<meta name="citation_author_institution" content="Division of Informatics, Imaging and Data Sciences, University of Manchester">
<meta name="citation_author" content="Evangelos Kontopantelis">
<meta name="citation_author_institution" content="Division of Informatics, Imaging and Data Sciences, University of Manchester">
<meta name="citation_author" content="Matthew Sperrin">
<meta name="citation_author_institution" content="Division of Informatics, Imaging and Data Sciences, University of Manchester">
<meta name="citation_publication_date" content="2025 Aug 19">
<meta name="citation_volume" content="20">
<meta name="citation_issue" content="8">
<meta name="citation_firstpage" content="e0327229">
<meta name="citation_doi" content="10.1371/journal.pone.0327229">
<meta name="citation_pmid" content="40828847">
<meta name="citation_abstract_html_url" content="https://pmc.ncbi.nlm.nih.gov/articles/PMC12364311/">
<meta name="citation_fulltext_html_url" content="https://pmc.ncbi.nlm.nih.gov/articles/PMC12364311/">
<meta name="citation_pdf_url" content="https://pmc.ncbi.nlm.nih.gov/articles/PMC12364311/pdf/pone.0327229.pdf">
<meta name="description" content="The Clinical Practice Research Datalink (CPRD) is a large and widely used resource of electronic health records from the UK, linking primary care data to hospital data, death registration data, cancer registry data, deprivation data and mental ...">
<meta name="og:title" content="rcprd: An R package to simplify the extraction and processing of Clinical Practice Research Datalink (CPRD) data, and create analysis-ready datasets">
<meta name="og:type" content="article">
<meta name="og:site_name" content="PubMed Central (PMC)">
<meta name="og:description" content="The Clinical Practice Research Datalink (CPRD) is a large and widely used resource of electronic health records from the UK, linking primary care data to hospital data, death registration data, cancer registry data, deprivation data and mental ...">
<meta name="og:url" content="https://pmc.ncbi.nlm.nih.gov/articles/PMC12364311/">
<meta name="og:image" content="https://cdn.ncbi.nlm.nih.gov/pmc/cms/images/pmc-card-share.jpg?_=0">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@ncbi">
    
    

    </head>
    <body >
        
    <a class="usa-skipnav " href="#main-content">
      Skip to main content
    </a>


        
            

<section class="usa-banner " aria-label="Official website of the United States government" >
    <div class="usa-accordion">
        <header class="usa-banner__header">
            <div class="usa-banner__inner">
                <div class="grid-col-auto">
                    <img aria-hidden="true"
                         class="usa-banner__header-flag"
                         src="/static/img/us_flag.svg"
                         alt="" />
                </div>

                <div class="grid-col-fill tablet:grid-col-auto" aria-hidden="true">
                    <p class="usa-banner__header-text">
                        An official website of the United States government
                    </p>
                    <span class="usa-banner__header-action">Here's how you know</span>
                </div>

                



















    
        <button
            type="button"
        
    
    class="usa-accordion__button usa-banner__button
           

           
               
               
               
               
            

           
           
           
           "
    aria-expanded="false"
    aria-controls="gov-banner-default"
    
    data-testid="storybook-django-banner"
    
    >
    
        

        
                    <span class="usa-banner__button-text">Here's how you know</span>
                

        
    
        
            </button>
        


            </div>
        </header>

        <div class="usa-banner__content usa-accordion__content"
             id="gov-banner-default"
             hidden>
            <div class="grid-row grid-gap-lg">
                <div class="usa-banner__guidance tablet:grid-col-6">
                    <img class="usa-banner__icon usa-media-block__img"
                         src="/static/img/icon-dot-gov.svg"
                         alt=""
                         aria-hidden="true" />
                    <div class="usa-media-block__body">
                        <p>
                            <strong>Official websites use .gov</strong>
                            <br />
                            A
                            <strong>.gov</strong> website belongs to an official
                            government organization in the United States.
                        </p>
                    </div>
                </div>

                <div class="usa-banner__guidance tablet:grid-col-6">
                    <img class="usa-banner__icon usa-media-block__img"
                         src="/static/img/icon-https.svg"
                         alt=""
                         aria-hidden="true" />

                    <div class="usa-media-block__body">
                        <p>
                            <strong>Secure .gov websites use HTTPS</strong>
                            <br />
                            A <strong>lock</strong> (
                            <span class="icon-lock">
                                <svg xmlns="http://www.w3.org/2000/svg"
                                     width="52"
                                     height="64"
                                     viewBox="0 0 52 64"
                                     class="usa-banner__lock-image"
                                     role="graphics-symbol"
                                     aria-labelledby="banner-lock-description"
                                     focusable="false">
                                    <title id="banner-lock-title">Lock</title>
                                    <desc id="banner-lock-description">
                                    Locked padlock icon
                                    </desc>
                                    <path fill="#000000"
                                          fill-rule="evenodd"
                                          d="M26 0c10.493 0 19 8.507 19 19v9h3a4 4 0 0 1 4 4v28a4 4 0 0 1-4 4H4a4 4 0 0 1-4-4V32a4 4 0 0 1 4-4h3v-9C7 8.507 15.507 0 26 0zm0 8c-5.979 0-10.843 4.77-10.996 10.712L15 19v9h22v-9c0-6.075-4.925-11-11-11z" />
                                </svg>
</span>) or <strong>https://</strong> means you've safely
                                connected to the .gov website. Share sensitive
                                information only on official, secure websites.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

        

        
    
    
    

<div class="usa-overlay">
</div>



<header class="usa-header usa-header--extended usa-header--wide" data-header data-testid="header"    >
    <div class="ncbi-header">
        <div class="ncbi-header__container">
            <a class="ncbi-header__logo-container"
               href="https://www.ncbi.nlm.nih.gov/">
                <img alt="NCBI home page"
                     class="ncbi-header__logo-image"
                     src="/static/img/ncbi-logos/nih-nlm-ncbi--white.svg"
                     width="410"
                     height="100" />
            </a>

            <!-- Mobile menu hamburger button -->
            



















    
        <button
            type="button"
        
    
    class="usa-menu-btn ncbi-header__hamburger-button
           

           
               
               
               
               
            

           
           
           
           "
    
    
    aria-label="Show menu"
    data-testid="navMenuButton"
    
    >
    
        

        
                <svg aria-hidden="true"
                     class="ncbi-hamburger-icon"
                     fill="none"
                     focusable="false"
                     height="21"
                     viewBox="0 0 31 21"
                     width="31"
                     xmlns="http://www.w3.org/2000/svg">
                    <path clip-rule="evenodd"
                          d="M0.125 20.75H30.875V17.3333H0.125V20.75ZM0.125 12.2083H30.875V8.79167H0.125V12.2083ZM0.125 0.25V3.66667H30.875V0.25H0.125Z"
                          fill="#F1F1F1"
                          fill-rule="evenodd" />
                </svg>
            

        
    
        
            </button>
        



            
                <!-- Desktop buttons-->
                <div class="ncbi-header__desktop-buttons">
                    
                        <!-- Desktop search button -->
                        



















    
        <button
            type="button"
        
    
    class="usa-button
           

           
               
               
               
               
            

           
           
           usa-button--unstyled ncbi-header__desktop-button
           "
    aria-expanded="false"
    aria-controls="search-field-desktop-navigation"
    aria-label="Show search overlay"
    data-testid="toggleSearchPanelButton"
    data-toggle-search-panel-button
    >
    
        

        
                            



    <svg class="usa-icon " role="graphics-symbol" aria-hidden="true" >
        
        <use xlink:href="/static/img/sprite.svg#search" />
    </svg>


                            Search
                        

        
    
        
            </button>
        


                    

                    <!-- Desktop login dropdown -->
                    
                        <div class="ncbi-header__login-dropdown">
                            



















    
        <button
            type="button"
        
    
    class="usa-button
           

           
               
               
               
               
            

           
           
           usa-button--unstyled ncbi-header__desktop-button ncbi-header__login-dropdown-button
           "
    aria-expanded="false"
    aria-controls="login-dropdown-menu"
    aria-label="Show login menu"
    data-testid="toggleLoginMenuDropdown"
    data-desktop-login-button
    >
    
        

        
                                



    <svg class="usa-icon " role="graphics-symbol" aria-hidden="true" >
        
        <use xlink:href="/static/img/sprite.svg#person" />
    </svg>



                                <span data-login-dropdown-text>Log in</span>

                                <!-- Dropdown icon pointing up -->
                                



    <svg class="usa-icon ncbi-header__login-dropdown-icon ncbi-header__login-dropdown-icon--expand-less ncbi-header__login-dropdown-icon--hidden" role="graphics-symbol" aria-hidden="true" data-login-dropdown-up-arrow>
        
        <use xlink:href="/static/img/sprite.svg#expand_less" />
    </svg>



                                <!-- Dropdown icon pointing down -->
                                



    <svg class="usa-icon ncbi-header__login-dropdown-icon ncbi-header__login-dropdown-icon--expand-more ncbi-header__login-dropdown-icon--hidden" role="graphics-symbol" aria-hidden="true" data-login-dropdown-down-arrow>
        
        <use xlink:href="/static/img/sprite.svg#expand_more" />
    </svg>


                            

        
    
        
            </button>
        



                            <!-- Login dropdown menu -->
                            <ul class="usa-nav__submenu ncbi-header__login-dropdown-menu"
                                id="login-dropdown-menu"
                                data-desktop-login-menu-dropdown
                                hidden>
                                
                                    <li class="usa-nav__submenu-item">
                                        <!-- Uses custom style overrides to render external and document links. -->
                                        









    <a href="https://www.ncbi.nlm.nih.gov/myncbi/" class="usa-link  "  >
        

        
            Dashboard
        

        
    </a>


                                    </li>
                                
                                    <li class="usa-nav__submenu-item">
                                        <!-- Uses custom style overrides to render external and document links. -->
                                        









    <a href="https://www.ncbi.nlm.nih.gov/myncbi/collections/bibliography/" class="usa-link  "  >
        

        
            Publications
        

        
    </a>


                                    </li>
                                
                                    <li class="usa-nav__submenu-item">
                                        <!-- Uses custom style overrides to render external and document links. -->
                                        









    <a href="https://www.ncbi.nlm.nih.gov/account/settings/" class="usa-link  "  >
        

        
            Account settings
        

        
    </a>


                                    </li>
                                
                                <li class="usa-nav__submenu-item">
                                    



















    
        <button
            type="button"
        
    
    class="usa-button
           

           
               
               
               
               
            

           
           
           usa-button--outline ncbi-header__login-dropdown-logout-button
           "
    
    
    
    data-testid="desktopLogoutButton"
    data-desktop-logout-button
    >
    
        

        Log out

        
    
        
            </button>
        


                                </li>
                            </ul>
                        </div>
                    
                </div>
            
        </div>
    </div>

    <!-- Search panel -->
    
        <div class="ncbi-search-panel ncbi--show-only-at-desktop"
             data-header-search-panel
             hidden>
            <div class="ncbi-search-panel__container">
                <form action="https://www.ncbi.nlm.nih.gov/search/all/"
                      
                      autocomplete="off"
                      class="usa-search usa-search--big ncbi-search-panel__form"
                      data-testid="desktop-navigation-search-form"
                      method="GET"
                      role="search">
                    <label class="usa-sr-only" for="search-field-desktop-navigation">
                        Search…
                    </label>
                    <input class="usa-input"
                           id="search-field-desktop-navigation"
                           name="term"
                           
                               placeholder="Search NCBI"
                           
                           type="search"
                           value="" />
                    



















    
        <button
            type="submit"
        
    
    class="usa-button
           

           
               
               
               
               
            

           
           
           
           "
    
    
    
    
    
    >
    
        

        
                        <span class="usa-search__submit-text">
                            Search NCBI
                        </span>
                    

        
    
        
            </button>
        


                </form>

                
            </div>
        </div>
    

    <nav aria-label="Primary navigation" class="usa-nav">
        <p class="usa-sr-only" id="primary-navigation-sr-only-title">
            Primary site navigation
        </p>

        <!-- Mobile menu close button -->
        



















    
        <button
            type="button"
        
    
    class="usa-nav__close ncbi-nav__close-button
           

           
               
               
               
               
            

           
           
           
           "
    
    
    aria-label="Close navigation menu"
    data-testid="navCloseButton"
    
    >
    
        

        
            <img src="/static/img/usa-icons/close.svg" alt="Close" />
        

        
    
        
            </button>
        



        
            <!-- Mobile search component -->
            <form class="usa-search usa-search--small ncbi--hide-at-desktop margin-top-6"
                  action="https://www.ncbi.nlm.nih.gov/search/all/"
                  
                  autocomplete="off"
                  data-testid="mobile-navigation-search-form"
                  method="GET"
                  role="search">
                <label class="usa-sr-only" for="search-field-mobile-navigation">
                    Search
                </label>

                <input class="usa-input"
                       id="search-field-mobile-navigation"
                       type="search"
                       
                           placeholder="Search NCBI"
                       
                       name="term" />

                



















    
        <button
            type="submit"
        
    
    class="usa-button
           

           
               
               
               
               
            

           
           
           
           "
    
    
    
    
    
    >
    
        

        
                    <!-- This SVG should be kept inline and not replaced with a link to the icon as otherwise it will render in the wrong color -->
                    <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0Ij48cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIi8+PHBhdGggZmlsbD0iI2ZmZiIgZD0iTTE1LjUgMTRoLS43OWwtLjI4LS4yN0E2LjQ3MSA2LjQ3MSAwIDAgMCAxNiA5LjUgNi41IDYuNSAwIDEgMCA5LjUgMTZjMS42MSAwIDMuMDktLjU5IDQuMjMtMS41N2wuMjcuMjh2Ljc5bDUgNC45OUwyMC40OSAxOWwtNC45OS01em0tNiAwQzcuMDEgMTQgNSAxMS45OSA1IDkuNVM3LjAxIDUgOS41IDUgMTQgNy4wMSAxNCA5LjUgMTEuOTkgMTQgOS41IDE0eiIvPjwvc3ZnPg=="
                         class="usa-search__submit-icon"
                         alt="Search" />
                

        
    
        
            </button>
        


            </form>

            
        

        <!-- Primary navigation menu items -->
        <!-- This usa-nav__inner wrapper is required to correctly style the navigation items on Desktop -->
        

        
            <div class="ncbi-nav__mobile-login-menu ncbi--hide-at-desktop"
                 data-mobile-login-menu
                 hidden>
                <p class="ncbi-nav__mobile-login-menu-status">
                    Logged in as:
                    <strong class="ncbi-nav__mobile-login-menu-email"
                            data-mobile-login-email-text></strong>
                </p>
                <ul class="usa-nav__primary usa-accordion">
                    
                        <li class="usa-nav__primary-item">
                            









    <a href="https://www.ncbi.nlm.nih.gov/myncbi/" class="usa-link  "  >
        

        
            Dashboard
        

        
    </a>


                        </li>
                    
                        <li class="usa-nav__primary-item">
                            









    <a href="https://www.ncbi.nlm.nih.gov/myncbi/collections/bibliography/" class="usa-link  "  >
        

        
            Publications
        

        
    </a>


                        </li>
                    
                        <li class="usa-nav__primary-item">
                            









    <a href="https://www.ncbi.nlm.nih.gov/account/settings/" class="usa-link  "  >
        

        
            Account settings
        

        
    </a>


                        </li>
                    
                </ul>
            </div>
        

        



















    
        <button
            type="button"
        
    
    class="usa-button
           

           
               
               
               
               
            

           
           
           ncbi-nav__mobile-login-button ncbi--hide-at-desktop
           "
    
    
    
    data-testid="mobileLoginButton"
    data-mobile-login-button
    >
    
        

        Log in

        
    
        
            </button>
        


    </nav>
</header>

    
    
        

<section class="pmc-header pmc-header--basic" aria-label="PMC Header with search box">
    <div class="pmc-nav-container">
        <div class="pmc-header__bar">
           <div class="pmc-header__logo">
               <a href="/" title="Home" aria-label="PMC Home"></a>
           </div>
            <button
                    type="button"
                    class="usa-button usa-button--unstyled pmc-header__search__button"
                    aria-label="Open search"
                    data-ga-category="search"
                    data-ga-action="PMC"
                    data-ga-label="pmc_search_panel_mobile"
            >
                <svg class="usa-icon width-4 height-4 pmc-icon__open" aria-hidden="true" focusable="false" role="img">
                    <use xlink:href="/static/img/sprite.svg#search"></use>
                </svg>
                <svg class="usa-icon width-4 height-4 pmc-icon__close" aria-hidden="true" focusable="false" role="img">
                    <use xlink:href="/static/img/sprite.svg#close"></use>
                </svg>
            </button>
        </div>
        <div class="pmc-header__search">
            


<form class="usa-search usa-search--extra usa-search--article-right-column  pmc-header__search__form" id="pmc-search-form" autocomplete="off" role="search">
<label class="usa-sr-only" for="pmc-search">Search PMC Full-Text Archive</label>
<span class="autoComplete_wrapper flex-1">
<input class="usa-input width-full maxw-none" required="required" placeholder="Search PMC Full-Text Archive" id="pmc-search"  type="search" name="term" data-autocomplete-url="https://pmc.ncbi.nlm.nih.gov/autocomp/search/autocomp/"/>
</span>
<button
class="usa-button"
type="submit"
formaction="https://www.ncbi.nlm.nih.gov/pmc/"
data-ga-category="search"
data-ga-action="PMC"
data-ga-label="PMC_search_button"
>
<span class="usa-search__submit-text">Search in PMC</span>
<img
src="/static/img/usa-icons-bg/search--white.svg"
class="usa-search__submit-icon"
alt="Search"
/>
</button>
</form>
            <div class="display-flex flex-column tablet:flex-row tablet:flex-justify flex-justify-center flex-align-center width-full desktop:maxw-44">
                <ul class="pmc-header__search__menu">
                    <li>
                        
                            <a class="usa-link" href="/journals/" data-ga-action="featured_link" data-ga-label="journal list">
                                Journal List
                            </a>
                        
                    </li>
                    <li>
                        
                            <a class="usa-link" href="/about/userguide/" data-ga-action="featured_link"
                            data-ga-label="user guide">
                                User Guide
                            </a>
                        
                    </li>
                </ul>
                
                    <button form="pmc-search-form" formaction="https://pmc.ncbi.nlm.nih.gov/search/" type="submit" class="usa-button usa-button--unstyled hover:text-no-underline text-no-underline width-auto margin-top-1 tablet:margin-top-0">
     <span class="bg-green-label padding-05 text-white">New</span><span class="text-underline text-primary">Try this search in PMC Beta Search</span>
</button>
                
            </div>
        </div>
    </div>
</section>

    


        
        

       
  <div class="usa-section padding-top-0 desktop:padding-top-6 pmc-article-section" data-article-db="pmc" data-article-id="12364311">

    

   



<div class="grid-container pmc-actions-bar" aria-label="Actions bar" role="complementary">
    <div class="grid-row">
        <div class="grid-col-fill display-flex">
             <div class="display-flex">
                <ul class="usa-list usa-list--unstyled usa-list--horizontal">
                    <li class="margin-right-2 mobile-lg:margin-right-4 display-flex mob">
                        <button
                                type="button"
                                class="usa-button pmc-sidenav__container__open usa-button--unstyled width-auto display-flex"
                                aria-label="Open resources"
                                data-extra-class="is-visible-resources"
                                data-ga-category="resources_accordion"
                                data-ga-action="click"
                                data-ga-label="mobile_icon"
                        >
                            <svg class="usa-icon width-4 height-4" aria-hidden="true" focusable="false" role="img">
                                <use xlink:href="/static/img/sprite.svg#more_vert"></use>
                            </svg>
                        </button>
                    </li>
                    
                    <li class="margin-right-2 mobile-lg:margin-right-4 display-flex mob">
                        <a
                                href="https://doi.org/10.1371/journal.pone.0327229"
                                class="usa-link display-flex usa-tooltip"
                                role="button"
                                target="_blank"
                                rel="noreferrer noopener"
                                title="View on publisher site"
                                data-position="bottom"
                                aria-label="View on publisher site"
                                data-ga-category="actions"
                                data-ga-action="click"
                                data-ga-label="publisher_link_mobile"
                        >
                                <svg class="usa-icon width-4 height-4" aria-hidden="true" focusable="false" role="img">
                                    <use xlink:href="/static/img/sprite.svg#launch"></use>
                                </svg>
                        </a>
                    </li>
                    
                    
                        <li class="margin-right-2 mobile-lg:margin-right-4 display-flex">
                             <a
                                     href="pdf/pone.0327229.pdf"
                                     class="usa-link display-flex usa-tooltip"
                                     role="button"
                                     title="Download PDF"
                                     data-position="bottom"
                                     aria-label="Download PDF"
                                     data-ga-category="actions"
                                     data-ga-action="click"
                                     data-ga-label="pdf_download_mobile"
                             >
                                <svg class="usa-icon width-4 height-4" aria-hidden="true" focusable="false" role="img">
                                    <use xlink:href="/static/img/sprite.svg#file_download"></use>
                                </svg>
                            </a>
                        </li>
                    
                    <li class="margin-right-2 mobile-lg:margin-right-4 display-flex">
                        <button
                            class="usa-button usa-button--unstyled  usa-tooltip collections-dialog-trigger collections-button display-flex collections-button-empty"
                            title="Add to Collections"
                            data-position="bottom"
                            aria-label="Save article in MyNCBI collections."
                            data-ga-category="actions"
                            data-ga-action="click"
                            data-ga-label="collections_button_mobile"
                            data-collections-open-dialog-enabled="false"
                            data-collections-open-dialog-url="https://account.ncbi.nlm.nih.gov/?back_url=https%3A%2F%2Fpmc.ncbi.nlm.nih.gov%2Farticles%2FPMC12364311%2F%3Freport%3Dclassic%23open-collections-dialog"
                            data-in-collections="false"
                        >
                            <svg class="usa-icon width-4 height-4 usa-icon--bookmark-full" aria-hidden="true" focusable="false" role="img" hidden>
                                <use xlink:href="/static/img/action-bookmark-full.svg#icon"></use>
                            </svg>
                            <svg class="usa-icon width-4 height-4 usa-icon--bookmark-empty" aria-hidden="true" focusable="false" role="img" hidden>
                                <use xlink:href="/static/img/action-bookmark-empty.svg#icon"></use>
                            </svg>
                        </button>
                    </li>
                    
                    <li class="margin-right-2 mobile-lg:margin-right-4 display-flex">
                        <button role="button" class="usa-button usa-button--unstyled usa-tooltip citation-dialog-trigger display-flex"
                            aria-label="Open dialog with citation text in different styles"
                            title="Cite"
                            data-position="bottom"
                            data-ga-category="actions"
                            data-ga-action="open"
                            data-ga-label="cite_mobile"
                            data-all-citations-url="/resources/citations/12364311/"
                            data-citation-style="nlm"
                            data-download-format-link="/resources/citations/12364311/export/"
                        >
                            <svg class="usa-icon width-4 height-4 usa-icon--bookmark-empty" aria-hidden="true" focusable="false" role="img" hidden>
                                <use xlink:href="/static/img/sprite.svg#format_quote"></use>
                            </svg>
                        </button>
                    </li>
                    
                    <li class="pmc-permalink display-flex" >
                         <button
                                 type="button"
                                 title="Permalink"
                                 data-position="bottom"
                                 class="usa-button usa-button--unstyled display-flex usa-tooltip"
                                 aria-label="Show article permalink"
                                 aria-expanded="false"
                                 aria-haspopup="true"
                                 data-ga-category="actions"
                                 data-ga-action="open"
                                 data-ga-label="permalink_mobile"
                         >
                            <svg class="usa-icon width-4 height-4" aria-hidden="true" focusable="false" role="img">
                                <use xlink:href="/static/img/sprite.svg#share"></use>
                            </svg>
                        </button>
                        

<div class="pmc-permalink__dropdown" hidden>
    <div class="pmc-permalink__dropdown__container">
          <h2 class="usa-modal__heading margin-top-0 margin-bottom-2 text-uppercase font-sans-xs">PERMALINK</h2>
          <div class="pmc-permalink__dropdown__content">
              <input type="text" class="usa-input" value="https://pmc.ncbi.nlm.nih.gov/articles/PMC12364311/" aria-label="Article permalink">
              <button class="usa-button display-inline-flex pmc-permalink__dropdown__copy__btn margin-right-0" title="Copy article permalink" data-ga-category="save_share" data-ga-action="link" data-ga-label="copy_link">
                  <svg class="usa-icon" aria-hidden="true" focusable="false" role="img">
                    <use xlink:href="/static/img/sprite.svg#content_copy"></use>
                  </svg>
                  <span class="margin-left-1">Copy</span>
              </button>
          </div>
    </div>
</div>
                    </li>
                </ul>
            </div>
            <button
                    type="button"
                    class="usa-button pmc-sidenav__container__open usa-button--unstyled width-auto display-flex"
                    aria-label="Open article navigation"
                    data-extra-class="is-visible-in-page"
                    data-ga-category="actions"
                    data-ga-action="open"
                    data-ga-label="article_nav_mobile"
            >
                <svg class="usa-icon width-4 height-4" aria-hidden="true" focusable="false" role="img">
                    <use xlink:href="/static/img/sprite.svg#list"></use>
                </svg>
            </button>
        </div>
    </div>
</div>
    <div class="grid-container desktop:padding-left-6">
      <div id="article-container" class="grid-row grid-gap">
        <div class="grid-col-12 desktop:grid-col-8 order-2 pmc-layout__content">
            <div class="grid-container padding-left-0 padding-right-0">
                <div class="grid-row desktop:margin-left-neg-6">
                    <div class="grid-col-12">
                        <div class="pmc-layout__disclaimer" role="complementary" aria-label="Disclaimer note">
    As a library, NLM provides access to scientific literature. Inclusion in an NLM database does not imply endorsement of, or agreement with,
    the contents by NLM or the National Institutes of Health.<br/>
    Learn more:
    <a class="usa-link" data-ga-category="Link click" data-ga-action="Disclaimer" data-ga-label="New disclaimer box" href="/about/disclaimer/">PMC Disclaimer</a>
    |
    <a class="usa-link" data-ga-category="Link click" data-ga-action="PMC Copyright Notice" data-ga-label="New disclaimer box" href="/about/copyright/">
        PMC Copyright Notice
    </a>
</div>
                    </div>
                </div>
                <div class="grid-row pmc-wm desktop:margin-left-neg-6">
                    <!-- Main content -->
                    <main
                      id="main-content"
                      class="usa-layout-docs__main usa-layout-docs grid-col-12 pmc-layout pmc-prose padding-0"
                    >

                      
                        <section class="pmc-journal-banner text-center line-height-none" aria-label="Journal banner"><img src="https://cdn.ncbi.nlm.nih.gov/pmc/banners/logo-plosone.png" alt="PLOS One logo" usemap="#pmc-banner-imagemap" width="500" height="75"><map name="pmc-banner-imagemap"><area alt="Link to PLOS One" title="Link to PLOS One" shape="default" href="https://doi.org/10.1371/journal.pone.0327229" target="_blank" rel="noopener noreferrer"></map></section><article lang="en"><section aria-label="Article citation and metadata"><section class="pmc-layout__citation font-secondary font-xs"><div>
<div class="display-inline-block"><button type="button" class="cursor-pointer text-no-underline bg-transparent border-0 padding-0 text-left margin-0 text-normal text-primary" aria-controls="journal_context_menu">PLoS One</button></div>. 2025 Aug 19;20(8):e0327229. doi: <a href="https://doi.org/10.1371/journal.pone.0327229" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">10.1371/journal.pone.0327229</a>
</div>
<nav id="journal_context_menu" hidden="hidden"><ul class="menu-list font-family-ui" role="menu">
<li role="presentation"><a href="https://www.ncbi.nlm.nih.gov/pmc/?term=%22PLoS%20One%22%5Bjour%5D" class="usa-link" role="menuitem">Search in PMC</a></li>
<li role="presentation"><a href="https://pubmed.ncbi.nlm.nih.gov/?term=%22PLoS%20One%22%5Bjour%5D" lang="en" class="usa-link" role="menuitem">Search in PubMed</a></li>
<li role="presentation"><a href="https://www.ncbi.nlm.nih.gov/nlmcatalog?term=%22PLoS%20One%22%5BTitle%20Abbreviation%5D" class="usa-link" role="menuitem">View in NLM Catalog</a></li>
<li role="presentation"><a href="?term=%22PLoS%20One%22%5Bjour%5D" class="usa-link" role="menuitem" data-add-to-search="true">Add to search</a></li>
</ul></nav></section><section class="front-matter"><div class="ameta p font-secondary font-xs">
<hgroup><h1>rcprd: An R package to simplify the extraction and processing of Clinical Practice Research Datalink (CPRD) data, and create analysis-ready datasets</h1></hgroup><div class="cg p">
<a href="https://pubmed.ncbi.nlm.nih.gov/?term=%22Pate%20A%22%5BAuthor%5D" class="usa-link" aria-describedby="id1"><span class="name western">Alexander Pate</span></a><div hidden="hidden" id="id1">
<h3><span class="name western">Alexander Pate</span></h3>
<div class="p">
<sup>1</sup>Division of Informatics, Imaging and Data Sciences, University of Manchester</div>
<div>Conceptualization, Formal analysis, Methodology, Software, Writing – original draft, Writing – review &amp; editing</div>
<div class="p">Find articles by <a href="https://pubmed.ncbi.nlm.nih.gov/?term=%22Pate%20A%22%5BAuthor%5D" class="usa-link"><span class="name western">Alexander Pate</span></a>
</div>
</div>
<sup>1,</sup><sup>*</sup>, <a href="https://pubmed.ncbi.nlm.nih.gov/?term=%22Parisi%20R%22%5BAuthor%5D" class="usa-link" aria-describedby="id2"><span class="name western">Rosa Parisi</span></a><div hidden="hidden" id="id2">
<h3><span class="name western">Rosa Parisi</span></h3>
<div class="p">
<sup>1</sup>Division of Informatics, Imaging and Data Sciences, University of Manchester</div>
<div>Conceptualization, Methodology, Writing – review &amp; editing</div>
<div class="p">Find articles by <a href="https://pubmed.ncbi.nlm.nih.gov/?term=%22Parisi%20R%22%5BAuthor%5D" class="usa-link"><span class="name western">Rosa Parisi</span></a>
</div>
</div>
<sup>1</sup>, <a href="https://pubmed.ncbi.nlm.nih.gov/?term=%22Kontopantelis%20E%22%5BAuthor%5D" class="usa-link" aria-describedby="id3"><span class="name western">Evangelos Kontopantelis</span></a><div hidden="hidden" id="id3">
<h3><span class="name western">Evangelos Kontopantelis</span></h3>
<div class="p">
<sup>1</sup>Division of Informatics, Imaging and Data Sciences, University of Manchester</div>
<div>Conceptualization, Methodology, Writing – review &amp; editing</div>
<div class="p">Find articles by <a href="https://pubmed.ncbi.nlm.nih.gov/?term=%22Kontopantelis%20E%22%5BAuthor%5D" class="usa-link"><span class="name western">Evangelos Kontopantelis</span></a>
</div>
</div>
<sup>1</sup>, <a href="https://pubmed.ncbi.nlm.nih.gov/?term=%22Sperrin%20M%22%5BAuthor%5D" class="usa-link" aria-describedby="id4"><span class="name western">Matthew Sperrin</span></a><div hidden="hidden" id="id4">
<h3><span class="name western">Matthew Sperrin</span></h3>
<div class="p">
<sup>1</sup>Division of Informatics, Imaging and Data Sciences, University of Manchester</div>
<div>Conceptualization, Funding acquisition, Methodology, Supervision, Writing – review &amp; editing</div>
<div class="p">Find articles by <a href="https://pubmed.ncbi.nlm.nih.gov/?term=%22Sperrin%20M%22%5BAuthor%5D" class="usa-link"><span class="name western">Matthew Sperrin</span></a>
</div>
</div>
<sup>1</sup>
</div>
<div class="cg p">Editor: <span class="name western">Sreeram V Ramagopalan</span><sup>2</sup>
</div>
<ul class="d-buttons inline-list">
<li><button class="d-button" aria-controls="aip_a" aria-expanded="false">Author information</button></li>
<li><button class="d-button" aria-controls="anp_a" aria-expanded="false">Article notes</button></li>
<li><button class="d-button" aria-controls="clp_a" aria-expanded="false">Copyright and License information</button></li>
</ul>
<div class="d-panels font-secondary-light">
<div id="aip_a" class="d-panel p" style="display: none">
<div class="p" id="aff001">
<sup>1</sup>Division of Informatics, Imaging and Data Sciences, University of Manchester</div>
<div id="edit1">
<sup>2</sup>University of Oxford, UNITED KINGDOM OF GREAT BRITAIN AND NORTHERN IRELAND</div>
<div class="author-notes p">
<div class="fn" id="cor001">
<sup>✉</sup><p class="display-inline">* E-mail: <span>alexander.pate@manchester.ac.uk</span></p>
</div>
<div class="fn" id="coi001"><p><strong>Competing Interests: </strong>The authors have declared that no competing interests exist.</p></div>
</div>
<h4 class="font-secondary">Roles</h4>
<div class="p">
<strong class="contrib"><span class="name western">Alexander Pate</span></strong>: <span class="role">Conceptualization, Formal analysis, Methodology, Software, Writing – original draft, Writing – review &amp; editing</span>
</div>
<div>
<strong class="contrib"><span class="name western">Rosa Parisi</span></strong>: <span class="role">Conceptualization, Methodology, Writing – review &amp; editing</span>
</div>
<div>
<strong class="contrib"><span class="name western">Evangelos Kontopantelis</span></strong>: <span class="role">Conceptualization, Methodology, Writing – review &amp; editing</span>
</div>
<div>
<strong class="contrib"><span class="name western">Matthew Sperrin</span></strong>: <span class="role">Conceptualization, Funding acquisition, Methodology, Supervision, Writing – review &amp; editing</span>
</div>
<div class="p">
<strong class="contrib"><span class="name western">Sreeram V Ramagopalan</span></strong>: <span class="role">Editor</span>
</div>
</div>
<div id="anp_a" class="d-panel p" style="display: none"><div class="notes p"><section id="historyarticle-meta1" class="history"><p>Received 2024 Nov 11; Accepted 2025 Jun 11; Collection date 2025.</p></section></div></div>
<div id="clp_a" class="d-panel p" style="display: none">
<div>© 2025 Pate et al</div>
<p>This is an open access article distributed under the terms of the <a href="https://creativecommons.org/licenses/by/4.0/" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">Creative Commons Attribution License</a>, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</p>
<div class="p"><a href="/about/copyright/" class="usa-link">PMC Copyright notice</a></div>
</div>
</div>
<div>PMCID: PMC12364311  PMID: <a href="https://pubmed.ncbi.nlm.nih.gov/40828847/" class="usa-link">40828847</a>
</div>
</div></section></section><section aria-label="Article content"><section class="body main-article-body"><section class="abstract" id="abstract1"><h2>Abstract</h2>
<p>The Clinical Practice Research Datalink (CPRD) is a large and widely used resource of electronic health records from the UK, linking primary care data to hospital data, death registration data, cancer registry data, deprivation data and mental health services data. Extraction and management of CPRD data is a computationally demanding process and requires a significant amount of work, in particular when using R. The <strong>rcprd</strong> package simplifies the process of extracting and processing CPRD data in order to build datasets ready for statistical analysis. Raw CPRD data is provided in thousands of.txt files, making querying this data cumbersome and inefficient. <strong>rcprd</strong> saves the relevant information into an SQLite database stored on the hard drive which can then be queried efficiently to extract required information about individuals. <strong>rcprd</strong> follows a four-stage process: 1) Definition of a cohort, 2) Read in medical/prescription data and save into an SQLite database, 3) Query this SQLite database for specific codes and tests to create variables for each individual in the cohort, 4) Combine extracted variables into a dataset ready for statistical analysis. Functions are available to extract common variable types (e.g., history of a condition, or time until an event occurs, relative to an index date), and more general functions for database queries, allowing users to define their own variables for extraction. The entire process can be done from within R, with no knowledge of SQL required. This manuscript showcases the functionality of <strong>rcprd</strong> by running through an example using simulated CPRD Aurum data. <strong>rcprd</strong> will reduce the duplication of time and effort among those using CPRD data for research, allowing more time to be focused on other aspects of research projects.</p></section><section id="sec001"><h2 class="pmc_sec_title">1 Introduction</h2>
<p>The Clinical Practice Research Datalink (CPRD) is a large resource of Electronic Health Records from the UK, owned by the UK Medicines and Healthcare products Regulatory Agency (MHRA), and containing information on demography, medical history, test results and drug use of individuals registered with a general practice. The MHRA maintain two databases, CPRD GOLD, [<a href="#pone.0327229.ref001" class="usa-link" aria-describedby="pone.0327229.ref001">1</a>] which contains data from general practices using the Vision computer system, and CPRD Aurum [<a href="#pone.0327229.ref002" class="usa-link" aria-describedby="pone.0327229.ref002">2</a>], which contains data from general practices using the Egton Medical Information Systems (EMIS) computer system, EMIS Web. The primary care data is linked to hospital data, death registration data, cancer registry data, deprivation data and mental health services data, enabled by NHS digital [<a href="#pone.0327229.ref003" class="usa-link" aria-describedby="pone.0327229.ref003">3</a>]. As of 2016, the EMIS Web computer system was used by 4199 (56%) of the general practices in England [<a href="#pone.0327229.ref004" class="usa-link" aria-describedby="pone.0327229.ref004">4</a>]. As of September 2024, CPRD Aurum contained data on 47 million (16 million currently registered) individuals from 1,784 (1,596 currently contributing) general practices across the United Kingdom [<a href="#pone.0327229.ref005" class="usa-link" aria-describedby="pone.0327229.ref005">5</a>], and CPRD GOLD contained data on 21 million (2.9 million currently registered) individuals [<a href="#pone.0327229.ref006" class="usa-link" aria-describedby="pone.0327229.ref006">6</a>]. CPRD is a widely used resource: since 2019, a PubMed search reveals there have been 540 studies published which contain “CPRD” in the title or abstract. Extraction of CPRD data and transformation into a format ready for statistical analysis is computationally demanding and requires a significant amount of work. There is limited published software available to aid researchers in the extraction and processing of CPRD data [<a href="#pone.0327229.ref009" class="usa-link" aria-describedby="pone.0327229.ref009">9</a>].</p>
<p><strong>rEHR</strong> [<a href="#pone.0327229.ref007" class="usa-link" aria-describedby="pone.0327229.ref007">7</a>] is an R package for manipulating and analysing electronic health record data, which works by creating an SQLite database on a fixed storage device (i.e., a disk drive), which is then subsequently queried to extract relevant information, faster than with conventional statistical analysis software. <strong>rEHR</strong> was designed to be database agnostic, and contains functionality for longitudinal data extraction, cutting data by time-varying covariates, matching controls to cases, converting the units of test data, and creating clinical code lists. <strong>rEHR</strong> is however no longer maintained, it works with an older version of R (3.3.2) and has been archived on the Comprehensive R Archive Network (CRAN). The <strong>aurumpipeline</strong> package [<a href="#pone.0327229.ref008" class="usa-link" aria-describedby="pone.0327229.ref008">8</a>] contains functions to clean and process CPRD Aurum data, which works by storing the data as parquet files on the disk drive, which are then subsequently queried to extract relevant data. However, <strong>aurumpipeline</strong> is not available on CRAN and is not provided with any reproducible examples. The R package <strong>drugprepr</strong> [<a href="#pone.0327229.ref009" class="usa-link" aria-describedby="pone.0327229.ref009">9</a>] implements the algorithm of [<a href="#pone.0327229.ref010" class="usa-link" aria-describedby="pone.0327229.ref010">10</a>] for preparing drug exposure data extracted from CPRD, however it does not deal with the initial data extraction and storing of data.</p>
<p>Given the many studies using CPRD data, and the limited availability software for data processing, this indicates that a large amount of research time is being spent duplicating the work of others in order to extract CPRD data. This study introduces <strong>rcprd</strong>, an R package designed to assist researchers in working with CPRD data, and creating datasets which are ‘analysis-ready’. The main problem when working with CPRD data is the size of the raw data. Data on over 47 million individuals results in thousands of raw.txt files, and Terabytes of data, which can be cumbersome to work with. This is a particular issue for R users, as its infeasible to read all this data into the R workspace simultaneously, as R operates using physical memory (RAM). As suggested by [<a href="#pone.0327229.ref007" class="usa-link" aria-describedby="pone.0327229.ref007">7</a>], <strong>rcprd</strong> bypassess this problem by creating an SQLite database which can then be queried for data of interest in order to build an analysis-ready dataset. <strong>rcprd</strong> then simplifies the process of querying the SQLite database with functions to extract variables such as “most recent test result”, “time until first event”, or “history of a specified condition”. The SQLite database must be created on a secure device or server which aligns with the data storage requirements of CPRD.</p>
<p>We start by discussing the structure of CPRD Aurum data and the approach taken by <strong>rcprd</strong> for processing this data, which draws heavily on the work of [<a href="#pone.0327229.ref007" class="usa-link" aria-describedby="pone.0327229.ref007">7</a>]. We then run through a worked example to showcase the functionality of <strong>rcprd</strong>, which has two main groups of functions. The first are to extract and store the data in a consistent manner. The second group is to query this data to extract patient level variables. <strong>rcprd</strong> currently focuses on CPRD Aurum, as opposed to CPRD GOLD, given there has been a considerable drop in the number of practices utilising Vision software in the last 10 years, limiting the research utility of the CPRD GOLD database. However, <strong>rcprd</strong> has been designed to work with both CPRD Aurum and GOLD data, and functionality to formally accommodate CPRD GOLD data will be added in the near future.</p></section><section id="sec002"><h2 class="pmc_sec_title">2 Data structure and extraction process</h2>
<section id="sec003"><h3 class="pmc_sec_title">2.1 Structure of CPRD aurum data</h3>
<p>We first define the terminology which will be used throughout this article:</p>
<ul class="list" style="list-style-type:disc">
<li><p><em>Raw data</em>: The raw data provided to the user by CPRD.</p></li>
<li><p><em>Cohort</em>: A cohort of individuals that meet the inclusion/exclusion criteria for a given research question. In this setting, the cohort is ultimately a vector of patient id’s.</p></li>
<li><p><em>Analysis-ready dataset</em>: A data frame to which statistical models can be fitted, with one row for each individual in the cohort, and a column for each variable of interest, for example, age at cohort entry, or most recent BMI score prior to cohort entry. For longitudinal analyses, such data frames can be concatenated, with a variable indicating the time point at which the data was extracted.</p></li>
</ul>
<p>The raw CPRD Aurum data is split into eight different file types: Consultation, DrugIssue, Observation, Patient, Practice, Problem, Referral, Staff. The data specification is available here: [<a href="#pone.0327229.ref011" class="usa-link" aria-describedby="pone.0327229.ref011">11</a>]. For most research questions, the relevant files are Patient, Observation and DrugIssue. The Patient file contains information about registration into the database, date of death or lost to follow up, year of birth and gender. This file will be required to define a cohort. The observation file contains all medical diagnoses and tests, while DrugIssue contains information on prescriptions. Medical observations are identified by their <em>medcodeid</em>, whereas prescriptions are identified through their <em>prodcodeid</em>.</p>
<p>In order to facilitate data transfer, this data is commonly split by CPRD into numerous smaller files. The different patient files are denoted by the string <em>set1</em>, <em>set2</em>, <em>set3</em> in the file name. Individuals in the same patient file will have the corresponding string (<em>setX</em>) in the files containing their medical or prescription data. However, there will be more than one Observation and DrugIssue file corresponding to each patient file. For example, the observation files for patients in <em>set1</em>, will have <em>set1</em> in their file name, and then an extra suffix 1, 2, 3, etc. The same is true for the DrugIssue files. The naming structure for these is as follows:</p>
<ul class="list" style="list-style-type:disc">
<li><p>aurum_allpatid_set<span xmlns:mml="http://www.w3.org/1998/Math/MathML" id="pone.0327229.e001"><math id="M1" display="inline" overflow="linebreak"><mrow><mi>X</mi></mrow></math></span>_extract_patient_001.txt</p></li>
<li><p>aurum_allpatid_set<span xmlns:mml="http://www.w3.org/1998/Math/MathML" id="pone.0327229.e002"><math id="M2" display="inline" overflow="linebreak"><mrow><mi>X</mi></mrow></math></span>_extract_observation_0<span xmlns:mml="http://www.w3.org/1998/Math/MathML" id="pone.0327229.e003"><math id="M3" display="inline" overflow="linebreak"><mrow><mi>Y</mi></mrow></math></span>.txt</p></li>
<li><p>aurum_allpatid_set<span xmlns:mml="http://www.w3.org/1998/Math/MathML" id="pone.0327229.e004"><math id="M4" display="inline" overflow="linebreak"><mrow><mi>X</mi></mrow></math></span>_extract_drugissue_0<span xmlns:mml="http://www.w3.org/1998/Math/MathML" id="pone.0327229.e005"><math id="M5" display="inline" overflow="linebreak"><mrow><mi>Y</mi></mrow></math></span>.txt</p></li>
</ul>
<p>where <span xmlns:mml="http://www.w3.org/1998/Math/MathML" id="pone.0327229.e006"><math id="M6" display="inline" overflow="linebreak"><mrow><mi>X</mi><mo>∈</mo><mo stretchy="false">{</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo>,</mo><mn>3</mn><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo stretchy="false">}</mo></mrow></math></span> and <span xmlns:mml="http://www.w3.org/1998/Math/MathML" id="pone.0327229.e007"><math id="M7" display="inline" overflow="linebreak"><mrow><mi>Y</mi><mo>∈</mo><mo stretchy="false">{</mo><mn>01</mn><mo>,</mo><mn>02</mn><mo>,</mo><mn>03</mn><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo stretchy="false">}</mo></mrow></math></span>. Note that the prefix to the file names may vary (i.e., the ‘aurum_allpatid’ part) however we expect the naming convention with regards to ‘set<span xmlns:mml="http://www.w3.org/1998/Math/MathML" id="pone.0327229.e008"><math id="M8" display="inline" overflow="linebreak"><mrow><mi>X</mi></mrow></math></span>’, file type, and ‘<span xmlns:mml="http://www.w3.org/1998/Math/MathML" id="pone.0327229.e009"><math id="M9" display="inline" overflow="linebreak"><mrow><mn>0</mn><mi>Y</mi></mrow></math></span>’ to remain consistent. If this changes in the future, we will endeavour to update the <strong>rcprd</strong> as soon as possible.</p></section><section id="sec004"><h3 class="pmc_sec_title">2.2 Recommended process for extraction</h3>
<p>Our recommended process for developing an analysis-ready dataset is detailed in <a href="#pone.0327229.box001" class="usa-link">Box 1</a>.</p>
<section class="bt xbox font-sm" id="pone.0327229.box001"><h4 class="obj_head">Box 1: Flow diagram for recommended data extraction process.</h4>
<p>Step 1: Extract initial cohort using extract_cohort() and apply initial inclusion/exclusion criteria which can be applied using only the patient file.</p>
<ul class="list" style="list-style-type:none"><li>
<p>Q1: Do the inclusion/exclusion criteria depend on primary care data?</p>
<ul class="list" style="list-style-type:none">
<li><p>• If yes -&gt; (proceed to step 2)</p></li>
<li><p>• If no -&gt; (proceed to Q2)</p></li>
</ul>
</li></ul>
<p>Step 2: For patients that meet inclusion/exclusion criteria from step 1, add relevant primary care data into an SQLite database using cprd_extract(). See section 3.2.</p>
<p>Step 3: Query SQLite database in order to apply further inclusion/exclusion criteria. See section 3.3.</p>
<ul class="list" style="list-style-type:none"><li><p>Q2: Do the inclusion/exclusion criteria depend on linked data?</p></li></ul>
<ul class="list" style="list-style-type:disc">
<li><p>If yes -&gt; (proceed to step 4)</p></li>
<li><p>If no -&gt; (proceed to step 5)</p></li>
</ul>
<p>Step 4: Request type 1 linked data* for individuals and apply remaining inclusion/exclusion criteria.</p>
<p>Step 5: For patients in the final cohort, add relevant primary care data into an SQLite database using cprd_extract(). If an SQLite database was already created in step 2, and only a small number of individuals were excluded in steps 3 and 4, consider skipping this step. However, if a large number of individuals were excluded, it is worthwhile to create the new SQLite database, as it will be much smaller and future queries for extracting variables will run quicker. See section 3.2.</p>
<p>Step 6: Query this SQLite database for specific codes and tests to create variables for each individual in the cohort. These are stored as.rds objects, which R data analysts will be familiar with. See section 3.3.</p>
<p>Step 7: Combine extracted variables into an analysis-ready dataset, also stored as an.rds object.</p>
<p>*type 1 linked data is defined as “linked data required in order to finalise the study population”</p></section><p>This process aligns with the process implemented by CPRD when cohort inclusion/exclusion criteria are dependent on linked data (see Q2 and step 4).</p>
<p>The process can be done entirely within R using <strong>rcprd</strong> functions, without any specialist understanding of SQLite databases. We recommend this process because once set up, querying the SQLite database is computationally much quicker than reading each of the raw files into the R workspace and querying these separately. It also reduces the probability of errors induced from creating numerous loops through the raw data files. We now move onto a worked example, where we showcase how to implement the above process using <strong>rcprd</strong> and the functions which are detailed in <a href="#pone.0327229.t001" class="usa-link">Table 1</a>.</p>
<section class="tw xbox font-sm" id="pone.0327229.t001"><h4 class="obj_head">Table 1. Table of rcprd functions.</h4>
<div class="tbl-box p" tabindex="0"><table class="content" frame="hsides" rules="groups">
<colgroup span="1">
<col align="left" valign="middle" span="1">
<col align="left" valign="middle" span="1">
</colgroup>
<thead><tr>
<th align="left" rowspan="1" colspan="1">Function</th>
<th align="left" rowspan="1" colspan="1">Use</th>
</tr></thead>
<tbody>
<tr><td align="left" colspan="2" rowspan="1">
<strong>Step 1: Defining a cohort</strong>
</td></tr>
<tr>
<td align="left" rowspan="1" colspan="1">
<strong>
<em>extract_cohort</em>
</strong>
</td>
<td align="left" rowspan="1" colspan="1">Create a cohort based on the raw Aurum patient files</td>
</tr>
<tr><td align="left" colspan="2" rowspan="1">
<strong>Step 2: Reading in data and creating an SQLite database</strong>
</td></tr>
<tr>
<td align="left" rowspan="1" colspan="1">
<strong>
<em>connect_database</em>
</strong>
</td>
<td align="left" rowspan="1" colspan="1">Open a connection with a SQLite database</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">
<strong>
<em>add_to_database</em>
</strong>
</td>
<td align="left" rowspan="1" colspan="1">Add an individual raw Aurum data.txt files to SQLite database</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">
<strong>
<em>cprd_extract</em>
</strong>
</td>
<td align="left" rowspan="1" colspan="1">Add all raw Aurum data.txt files of a certain type to SQLite database</td>
</tr>
<tr><td align="left" colspan="2" rowspan="1">
<strong>Step 3: Querying the SQLite database to extract variables (extracting common variable types)</strong>
</td></tr>
<tr>
<td align="left" rowspan="1" colspan="1">
<strong>
<em>extract_ho</em>
</strong>
</td>
<td align="left" rowspan="1" colspan="1">Extract a binary variable whether individual has a specified code recorded prior to index date, e.g., a ‘history of’ type variable.</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">
<strong>
<em>extract_time_until</em>
</strong>
</td>
<td align="left" rowspan="1" colspan="1">Extracts a time-to-event/survival variable: time from index date until event of interest occurs or individual is censored.</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">
<strong>
<em>extract_test_data</em>
</strong>
</td>
<td align="left" rowspan="1" colspan="1">Extracts most recent valid test result(s) in a given time period relative to the index date.</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">
<strong>
<em>extract_test_data_var</em>
</strong>
</td>
<td align="left" rowspan="1" colspan="1">Extracts the standard deviation of all valid test results in a given time period relative to the index date.</td>
</tr>
<tr><td align="left" colspan="2" rowspan="1">
<strong>Step 3: Querying the SQLite database to extract variables (extracting specific variables)</strong>
</td></tr>
<tr>
<td align="left" rowspan="1" colspan="1">
<strong>
<em>extract_bmi</em>
</strong>
</td>
<td align="left" rowspan="1" colspan="1">Extracts BMI</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">
<strong>
<em>extract_cholhdl_ratio</em>
</strong>
</td>
<td align="left" rowspan="1" colspan="1">Extracts cholesterol/high density lipoprotein ratio</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">
<strong>
<em>extract_diabetes</em>
</strong>
</td>
<td align="left" rowspan="1" colspan="1">Extracts diabetes status (Absent, type 1, type 2)</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">
<strong>
<em>extract_smoking</em>
</strong>
</td>
<td align="left" rowspan="1" colspan="1">Extracts smoking</td>
</tr>
<tr><td align="left" colspan="2" rowspan="1">
<strong>Step 3: Querying the SQLite database to extract variables (database queries and custom variable extraction)</strong>
</td></tr>
<tr>
<td align="left" rowspan="1" colspan="1">
<strong>
<em>db_query</em>
</strong>
</td>
<td align="left" rowspan="1" colspan="1">Query the SQLite database for observations with specific codes.</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">
<strong>
<em>combine_query</em>
</strong>
</td>
<td align="left" rowspan="1" colspan="1">Merge a database query (obtained using db_query) with a cohort, with options to remove observations that do not meet certain criteria, e.g., recorded outside of specified time period, or test value outside of a specified range.</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">
<strong>
<em>combine_query_boolean</em>
</strong>
</td>
<td align="left" rowspan="1" colspan="1">Combine a database query (obtained using db_query) with a cohort, returning a 0/1 vector depending on whether each individual had a code of interest recorded in a specified time period.</td>
</tr>
</tbody>
</table></div>
<div class="p text-right font-secondary"><a href="table/pone.0327229.t001/" class="usa-link" target="_blank" rel="noopener noreferrer">Open in a new tab</a></div></section></section></section><section id="sec005"><h2 class="pmc_sec_title">3 Worked example for data extraction</h2>
<section id="sec006"><h3 class="pmc_sec_title">3.1 Step 1: defining a cohort</h3>
<p>We have provided simulated patient, observation and drugissue files which will be utilisied in the worked example. The names of the files share the same naming convention given in section 2.1, and column names of the data match the real Aurum data. Numeric variables were simulated at random as integers between 1 and 100, date variables as a date between 01/01/1900 and 01/01/2000, gender as an integer 1 or 2, and year of birth as an integer between 1900 and 2000. Patient ID and practice ID were assigned manually. These files are contained in the <em>inst/aurum_data</em> directory of <strong>rcprd</strong>. After installing <strong>rcprd</strong>, either from CRAN (<a href="https://CRAN.R-project.org/package=rcprd" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">https://CRAN.R-project.org/package=rcprd</a>) or the associated GitHub repository (<a href="https://github.com/alexpate30/rcprd" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">https://github.com/alexpate30/rcprd</a>), this directory can be accessed using the command system.file(“aurum_data”, package = “rcprd”). This contains data on 12 fake patients, split across two patient files (<em>set1</em> and <em>set2</em>) and three observation and drugissue files (all <em>set1</em>):</p>
<p>
<span xmlns:mml="http://www.w3.org/1998/Math/MathML" id="pone.0327229.e010">
<img class="inline" src="https://cdn.ncbi.nlm.nih.gov/pmc/blobs/b680/12364311/4b587b4b1e02/pone.0327229.e010.jpg" loading="lazy" alt="Inline graphic">
</span>
</p>
<p>The first step in most analyses is creating and defining a cohort of individuals, which will involve working with the patient files. Data from the patient files can be combined using the extract_cohort function. This will look in the directory specified through the filepath argument, for any file containing “patient” in the file name. All files will be read in and concatenated into a single dataset. In some circumstances, researchers may be provided with a list of patient IDs which meet their inclusion/exclusion criteria. In this case, these can be specified through the patids argument (which requires a character vector). Suppose the individuals meeting the exclusion criteria are those with patid = 1, 3, 4 and 6. We would then specify:</p>
<p>
<span xmlns:mml="http://www.w3.org/1998/Math/MathML" id="pone.0327229.e011">
<img class="inline" src="https://cdn.ncbi.nlm.nih.gov/pmc/blobs/b680/12364311/8346ee246448/pone.0327229.e011.jpg" loading="lazy" alt="Inline graphic">
</span>
</p>
<p>In other circumstances, a user may need to apply the inclusion and exclusion criteria themselves. In this case, one would initially create a patient file for all individuals.</p>
<p>
<span xmlns:mml="http://www.w3.org/1998/Math/MathML" id="pone.0327229.e012">
<img class="inline" src="https://cdn.ncbi.nlm.nih.gov/pmc/blobs/b680/12364311/131c76e69fa1/pone.0327229.e012.jpg" loading="lazy" alt="Inline graphic">
</span>
</p>
<p>The cohort of individuals would then be defined by applying study specific inclusion/exclusion criteria. For example, all individuals with &gt; 1 day valid follow up aged 65 + , after 1st January 2000. Such criteria can be applied solely using the information available in patient files. In this example, we define the individuals that met the inclusion criteria to be those with patid = 1, 3, 4 and 6.</p>
<p>
<span xmlns:mml="http://www.w3.org/1998/Math/MathML" id="pone.0327229.e013">
<img class="inline" src="https://cdn.ncbi.nlm.nih.gov/pmc/blobs/b680/12364311/4fb30a4fdbf5/pone.0327229.e013.jpg" loading="lazy" alt="Inline graphic">
</span>
</p>
<p>The cohort has now been defined. In our hypothetical example we assume there are no inclusion/exclusion criteria dependent on either primary care data or linked data, meaning the answer to Q1 and Q2 are both “no”. We therefore move straight to step 5, which is to read in the raw medical/prescription data and create an SQLite database. However, please note, if the answer to Q1 was yes, resulting in the implementation of steps 2 and 3, the process for creating the SQLite database (step 2) will follow the process outlined in section 3.2, and the process of querying this database in order to apply the criteria will follow the process outlined in section 3.3. If the answer to Q2 was yes, and inclusion/exclusion criteria are dependent on linked data, type 1 linked data should be requested from CPRD. This can be read into R and dealt with in the R workspace in order to apply the criteria, without any need for <strong>rcprd</strong> functionality.</p></section><section id="sec007"><h3 class="pmc_sec_title">3.2 Step 5: Reading in data and creating an SQLite database</h3>
<p>Data for individuals in the cohort of interest is extracted from the.txt files and put into a SQLite database. This SQLite database is stored on a fixed storage device and can be queried when defining an analysis-ready dataset.</p>
<section id="sec008"><h4 class="pmc_sec_title">3.2.1 Add individual files to SQLite database using add_to_database.</h4>
<p>The function add_to_database can be used to add individual files to the SQLite database. Start by defining and connecting to your SQLite database. In this article we create a temporary database, but in practice this would be a permanent storage location. Specifically, file.path(tempdir(), “temp.sqlite”) would be replaced by the desired file path and SQLite database name.</p>
<p>
<span xmlns:mml="http://www.w3.org/1998/Math/MathML" id="pone.0327229.e014">
<img class="inline" src="https://cdn.ncbi.nlm.nih.gov/pmc/blobs/b680/12364311/ce016026391f/pone.0327229.e014.jpg" loading="lazy" alt="Inline graphic">
</span>
</p>
<p>Next, we add medical diagnoses data from the observation files to this database using the add_to_database function. It is imperative that when adding raw CPRD data to an SQLite database, that the SQLite database itself is stored in a secure environment which aligns with the data storage requirements of CPRD. The simulated raw data provided with <strong>rcprd</strong> can be accessed using the system.file function. The vector of patient id’s that defines the cohort is defined through the subset_patids argument. Only data with patid’s matching this argument will be added to the SQLite database. The filetype argument will select an appropriate function for reading in the.txt files, and also defines the name of the table in the SQLite database that the files are added to. Note that for the first file, overwrite = TRUE is specified to create a new table. For the second and third file, append = TRUE is specified to append to an existing table.</p>
<p>
<span xmlns:mml="http://www.w3.org/1998/Math/MathML" id="pone.0327229.e015">
<img class="inline" src="https://cdn.ncbi.nlm.nih.gov/pmc/blobs/b680/12364311/4c671afd0930/pone.0327229.e015.jpg" loading="lazy" alt="Inline graphic">
</span>
</p>
<p>We can then query this database using the db_query function and return the first 3 rows. We will showcase how to use this function to query the database for specific codes in section 3.3.3. db_query utilises the package <em>RSQLite</em>, and more details on how to query an SQLite database from within R is available in <em>RSQLite</em>’s documentation [<a href="#pone.0327229.ref012" class="usa-link" aria-describedby="pone.0327229.ref012">12</a>].</p>
<p>
<span xmlns:mml="http://www.w3.org/1998/Math/MathML" id="pone.0327229.e016">
<img class="inline" src="https://cdn.ncbi.nlm.nih.gov/pmc/blobs/b680/12364311/f6788766f23a/pone.0327229.e016.jpg" loading="lazy" alt="Inline graphic">
</span>
</p>
<p>Next, the prescription data from the drugissue files is added to a table called drugissue. A single SQLite database may contain more than one table, so this data is added to a different table within the same SQLite database. The table will take the same name as the filetype argument, unless the table_name argument is specified.</p>
<p>
<span xmlns:mml="http://www.w3.org/1998/Math/MathML" id="pone.0327229.e017">
<img class="inline" src="https://cdn.ncbi.nlm.nih.gov/pmc/blobs/b680/12364311/12899610e938/pone.0327229.e017.jpg" loading="lazy" alt="Inline graphic">
</span>
</p>
<p>This table can be queried in the same way, changing the tab argument, which specifies the name of the table in the SQLite database to query:</p>
<p>
<span xmlns:mml="http://www.w3.org/1998/Math/MathML" id="pone.0327229.e018">
<img class="inline" src="https://cdn.ncbi.nlm.nih.gov/pmc/blobs/b680/12364311/a80044145116/pone.0327229.e018.jpg" loading="lazy" alt="Inline graphic">
</span>
</p>
<p>Listing the tables in the SQLite database shows there are now two, named <em>observation</em> and <em>drugissue</em>.</p>
<p>
<span xmlns:mml="http://www.w3.org/1998/Math/MathML" id="pone.0327229.e019">
<img class="inline" src="https://cdn.ncbi.nlm.nih.gov/pmc/blobs/b680/12364311/eeb4f08ff04c/pone.0327229.e019.jpg" loading="lazy" alt="Inline graphic">
</span>
</p>
<p>The add_to_database function allows specification of filetype = c(“observation”, “drugissue”, “referral”, “problem”, “consultation”, “hes_primary”,”death”), each corresponding to a specific function for reading in the corresponding.txt files with correct formatting. The “hes_primary” options correspond to the primary diagnoses file in linked HES APC data. The “death” file corresponds to the death file in the linked ONS data. If wanting to add other files to the SQLite database, a user defined function for reading in the raw.txt file can be specified through extract_txt_func, and a table name can be specified through tablename. This allows the user to add any.txt file to their SQLite database.</p>
<p>Finally, when manually adding files in this manner, it is good practice to close the connection to the SQLite database once finished.</p>
<p>
<span xmlns:mml="http://www.w3.org/1998/Math/MathML" id="pone.0327229.e020">
<img class="inline" src="https://cdn.ncbi.nlm.nih.gov/pmc/blobs/b680/12364311/a5feefcb564d/pone.0327229.e020.jpg" loading="lazy" alt="Inline graphic">
</span>
</p></section><section id="sec009"><h4 class="pmc_sec_title">3.2.2 Add all relevant files to SQLite database using cprd_extract.</h4>
<p>In practice, there will be a high number of files to add to the SQLite database and adding each one using add_to_database would be cumbersome. We now repeat the extraction but using the cprd_extract function, which is a wrapper for add_to_database, and will add all the files in a specified directory that contain a string matching the specified file type. Start by creating a connection to a new database:</p>
<p>
<span xmlns:mml="http://www.w3.org/1998/Math/MathML" id="pone.0327229.e021">
<img class="inline" src="https://cdn.ncbi.nlm.nih.gov/pmc/blobs/b680/12364311/650fd4a8948f/pone.0327229.e021.jpg" loading="lazy" alt="Inline graphic">
</span>
</p>
<p>We then use cprd_extract to add all the observation files into the SQLite database. If the connection (aurum_extract) is to an existing database, which is the case here, it will be overwritten when running cprd_extract. The directory containing the files should be specified using filepath. It will only read in and add files with the text string specified in filetype in their file name The filetype argument takes values in c(“observation”, “drugissue”, “referral”, “problem”, “consultation”). We then query the first three rows of this database, and note they are the same as previously.</p>
<p>
<span xmlns:mml="http://www.w3.org/1998/Math/MathML" id="pone.0327229.e022">
<img class="inline" src="https://cdn.ncbi.nlm.nih.gov/pmc/blobs/b680/12364311/e935baec800b/pone.0327229.e022.jpg" loading="lazy" alt="Inline graphic">
</span>
</p>
<p>
<span xmlns:mml="http://www.w3.org/1998/Math/MathML" id="pone.0327229.e023">
<img class="inline" src="https://cdn.ncbi.nlm.nih.gov/pmc/blobs/b680/12364311/98e823dce8bf/pone.0327229.e023.jpg" loading="lazy" alt="Inline graphic">
</span>
</p>
<p>The process is then repeated for the drugissue files.</p>
<p>
<span xmlns:mml="http://www.w3.org/1998/Math/MathML" id="pone.0327229.e024">
<img class="inline" src="https://cdn.ncbi.nlm.nih.gov/pmc/blobs/b680/12364311/a2582b766571/pone.0327229.e024.jpg" loading="lazy" alt="Inline graphic">
</span>
</p>
<p>
<span xmlns:mml="http://www.w3.org/1998/Math/MathML" id="pone.0327229.e025">
<img class="inline" src="https://cdn.ncbi.nlm.nih.gov/pmc/blobs/b680/12364311/aba86a00513c/pone.0327229.e025.jpg" loading="lazy" alt="Inline graphic">
</span>
</p>
<p>The string to match on, function to read in the raw data, and the name of the table in the SQLite database, can be altered using the str_match, extract_txt_func and tablename arguments respectively. Note the use of str_match may be of particular importance if the naming convention of the raw data differs from what we have described above. The argument rm_duplicates = TRUE can be specified to de-duplicate records before adding into the SQLite database. This will increase computation time, and the derivation of many variables will not be effected by having duplicate records, so consider carefully whether it’s necessary to apply this step or not. There will also be the opportunity to de-duplicate the records later on when querying the data. Note that this function may run for a considerable period of time when working with the entire CPRD AURUM database, and therefore it is not recommended to run interactively. While creation of the SQLite database may be time consuming, subsequent queries will be far more efficient, so this is short term pain for a long term gain.</p></section><section id="sec010"><h4 class="pmc_sec_title">3.2.3 Add all relevant files to SQLite database in a computationally efficient manner using the set functionality.</h4>
<p>When the number of patients in your cohort is very large (for example millions, or tens of millions), the add_to_database function may perform very slowly. This is because for each observation in the file being added to the SQLite database, add_to_database checks to see whether the patid is contained in the vector subset_patids (a vector of length 20,000,000 in our case). We can utilise the structure of the CPRD AURUM data to speed up this process. If data has the <em>set</em> naming convention (see section 2.1), we know that we only need to search for patids from subset_patids, that are in the corresponding patient file. For example, when reading in file <em>aurum_allpatid_set1_extract_observation_00Y.txt</em> (for any <em>Y</em>), we only need to search whether patid is in the vector of patids from subset.patid, that are also in <em>aurum_allpatid_set1_extract_patient_001.txt</em>, which is much smaller vector. This can reduce the computation time for add_to_database and cprd_extract.</p>
<p>To achieve this, the subset_patids object should be a data frame with two required columns. The first column should be patid, the second should be set, reporting the corresponding value of set which the patient belongs to. The first step is therefore to create a patient file, which has an extra variable set, the number following the text string <em>set</em> in the patient file containing data for that patient. When reading in the patient files to create a cohort, this can be done by specifying set = TRUE. In this example, all individuals in our cohort come from the file with string <em>set1</em>, and therefore this variable is the same for all individuals in this cohort, however this will not be the case in practice.</p>
<p>
<span xmlns:mml="http://www.w3.org/1998/Math/MathML" id="pone.0327229.e026">
<img class="inline" src="https://cdn.ncbi.nlm.nih.gov/pmc/blobs/b680/12364311/470ec611b339/pone.0327229.e026.jpg" loading="lazy" alt="Inline graphic">
</span>
</p>
<p>The patient file read in is the same as previously, with the addition of the set column. This file can be reduced to just the patid and set columns, and used as the input to subset_patids when running the add_to_database and cprd_extract functions. When extracting data from observation files with <em>set1</em> in the name, it will only search for patient id’s with set == 1 in the data.frame provided to subset_patids.</p>
<p>
<span xmlns:mml="http://www.w3.org/1998/Math/MathML" id="pone.0327229.e027">
<img class="inline" src="https://cdn.ncbi.nlm.nih.gov/pmc/blobs/b680/12364311/ac3c48d5530d/pone.0327229.e027.jpg" loading="lazy" alt="Inline graphic">
</span>
</p>
<p>The resulting SQLite database is the same as those from sections 3.2.1 and 3.2.2. The computational gains from applying the subsetting in this manner will not be realised in this example given the size of the dataset, however may be worthwhile in practice when working with large cohorts. We do not close the connection, as we will now move onto querying the database to extract variables for creating an analysis-ready dataset.</p></section></section><section id="sec011"><h3 class="pmc_sec_title">3.3 Step 6: Querying the SQLite database to extract variables</h3>
<p>Once the data has been extracted and stored in an SQLite database, it can now be queried to create variables of interest. Please note, if the answer to Q1 was yes, resulting in the implementation of steps 2 and 3, the process for querying the SQLite database to derive variables to apply the exclusion criteria (step 3) will follow the exact same process as outlined here.</p>
<p>The normal process for extracting variables from electronic health records is to create code lists, a group of codes which denote the same condition. The database would then be queried for observations with medical codes matching those in the code list. A variable would then be defined based on this query. Whether this is a binary variable, indicating whether an individual has any record of a given code, or the most recent test result with the given code, or something much more complex. In CPRD Aurum, medical diagnoses and tests are identified from the <em>observation</em> file using <em>medcodeids</em>, and prescription data is identified from the drugissue file using <em>prodcodeids</em>. Creation of code lists is an important step of data extraction, and we refer elsewhere for details on best practice for developing code lists, and the limitations of working with code lists [<a href="#pone.0327229.ref013" class="usa-link" aria-describedby="pone.0327229.ref013">13</a>–<a href="#pone.0327229.ref017" class="usa-link" aria-describedby="pone.0327229.ref017">17</a>]. The functions in this section are split into three groups:</p>
<ul class="list" style="list-style-type:disc">
<li><p>Functions for extracting common variable types.</p></li>
<li><p>Functions for extracting specific variables</p></li>
<li><p>Functions for database queries and custom variable extraction</p></li>
</ul>
<p>These functions extract and query the data relative to an <em>index date</em>. The index date may be a fixed date (e.g., 1st January 2010), a date which is different for each individual (e.g., date age 50 reached), or a combination of the two (e.g., maximum of 1st January 2010 and date aged 50 reached). Variables are calculated relative to the index date using the observation date (obsdate) in the observation file and the issue date (issuedate) in the drug issue file.</p>
<section id="sec012"><h4 class="pmc_sec_title">3.3.1 Functions for extracting common variable types.</h4>
<p>There are functions to extract three common variable types, history of condition/medication prior to index date (extract_ho), time from the index date until first occurrence of a medical code/prescription or censoring (extract_time_until), and most recent test result(s) in a given time frame and valid range relative to the index date (extract_test_data).</p>
<p>The first, extract_ho, extracts a binary variable based on whether individual has a specified code recorded prior to index date. This can be applied to search for history of medical diagnoses or prescriptions. The index date must be a variable in the cohort dataset, and is specified through the indexdt argument.</p>
<p>
<span xmlns:mml="http://www.w3.org/1998/Math/MathML" id="pone.0327229.e028">
<img class="inline" src="https://cdn.ncbi.nlm.nih.gov/pmc/blobs/b680/12364311/255ed7549cd9/pone.0327229.e028.jpg" loading="lazy" alt="Inline graphic">
</span>
</p>
<p>The second is extract_time_until, which defines a time-to-event/survival variable. This has two components, the time until the first record of a specified code or censoring, and an indicator for whether event was observed or censored. To derive a variable of this type the cohort must also contain a time until censoring variable, which can be specified through censdt.</p>
<p>
<span xmlns:mml="http://www.w3.org/1998/Math/MathML" id="pone.0327229.e029">
<img class="inline" src="https://cdn.ncbi.nlm.nih.gov/pmc/blobs/b680/12364311/f26bc4d9142d/pone.0327229.e029.jpg" loading="lazy" alt="Inline graphic">
</span>
</p>
<p>The third is extract_test, which will extract the most recent test result in a given time frame. The number of days before and after the index date to search for results are specified through time_post and time_prev respectively. Test results are identified from the observation file, using code lists. Lower and upper bounds can also be specified for the extracted data through lower_bound and upper_bound.</p>
<p>
<span xmlns:mml="http://www.w3.org/1998/Math/MathML" id="pone.0327229.e030">
<img class="inline" src="https://cdn.ncbi.nlm.nih.gov/pmc/blobs/b680/12364311/4712f3747508/pone.0327229.e030.jpg" loading="lazy" alt="Inline graphic">
</span>
</p>
<p>More than one observation can be returned by specifying numobs. Metadata of the test result, such as the unit of measurement, date recorded, and the medical code, can be returned by settings numunitid = TRUE. A variation of this function, extract_test_data_var, will returns the standard deviation of the test data within the specified time and value range. Once all the variables of interest have been extracted, they can be merged into an analysis-ready dataset (step 4).</p>
<p>
<span xmlns:mml="http://www.w3.org/1998/Math/MathML" id="pone.0327229.e031">
<img class="inline" src="https://cdn.ncbi.nlm.nih.gov/pmc/blobs/b680/12364311/a54faff53094/pone.0327229.e031.jpg" loading="lazy" alt="Inline graphic">
</span>
</p>
<p>The codelists can also be specified through an R data.frame which must contain either a <em>medcodeid</em> or <em>prodcodeid</em> column. This may allow the user to run sensitivity analyses more easily if they would like to extract the same variable for different subgroups of the same codelist. For example:</p>
<p>
<span xmlns:mml="http://www.w3.org/1998/Math/MathML" id="pone.0327229.e032">
<img class="inline" src="https://cdn.ncbi.nlm.nih.gov/pmc/blobs/b680/12364311/481da65e69e6/pone.0327229.e032.jpg" loading="lazy" alt="Inline graphic">
</span>
</p>
<p>Codelists can be specified in this way for any of the functions in this section, or sections 3.3.2 and 3.3.3. However, the extra variables from the codelist (i.e., the condition and subgroup variables in the above example) will only be returned in the output when it is meaningful to do so. For example, in extract_ho, an individual may have many matching codes in their medical history, and therefore it’s unclear which should be returned.</p></section><section id="sec013"><h4 class="pmc_sec_title">3.3.2 Functions for extracting specific variables.</h4>
<p>There are also a number of functions that can be used to extract specific variables:</p>
<ul class="list" style="list-style-type:disc">
<li><p>extract_bmi: Derives BMI scores. Requires specification of codelist for BMI, height, and weight separately.</p></li>
<li><p>extract_cholhdl_ratio: Derives total cholesterol/high-density lipoprotein ratio. Requires specification of separate codelists for total cholesterol/high-density lipoprotein ratio, total cholesterol, and high-density lipoproteins separately.</p></li>
<li><p>extract_diabetes: Derives a categorical variable for history of type 1 diabetes, history of type 2 diabetes or no history of diabetes. Requires specification of separate codelists for type 1 and type 2 diabetes. Individuals with codes for both are designated as type 1.</p></li>
<li><p>extract_smoking: Derives a categorical variable for smoking status. Requires specification of seperate codelists for non-smoker, ex-smoker, light smoker, moderate smoker and heavy smoker. If the most recent smoking status is non-smoker, but there are historical codes which indicate smoking, then individual will be classified as an ex-smoker.</p></li>
</ul>
<p>It was deemed that these variables required custom functions because their definitions did not fit into any of the variable types from section 3.3.1. In each case, a number of steps are taken in order to clean or manipulate the data in order to get the desired output. For example, height measurements recorded in centimeters are converted to metres in order to calculate BMI scores. This is done through the use of the numunitid variable in the observation file. For both BMI and cholesterol/high-density lipoprotein ratio, the variable can be either be identified directly, or calculated from the component mesaures. In each case, the component parts must be recorded in the specified time range relative to the index date. For smoking status, if an individuals most recent medical observation was recorded as a non-smoker, but their medical record shows previous smoking, the most recent record is changed to ex-smoker. For diabetes status, diabetes if often recorded with generic codes such as “diabetes mellitus”, which does not specify which type. This is dealt with by assuming all generic codes refer to type 2 diabetes, unless that individual also has a specific type 1 diabetes code, in which case they will be determined to have type 1 diabetes as opposed to type 2.</p>
<p>The full details on extracting these variables are provided in the vignette titled Details-on-algorithms-for-extracting-specific-variables. However, it is important to state, that the correct way to define a variable may change from study to study. Therefore when using these functions to extract variables, we encourage taking the time to ensure that the way the variable is extracted matches the definition in ones study, and edit these functions and algorithms accordingly.</p></section></section><section id="sec014"><h3 class="pmc_sec_title">3.3.3 Functions for database queries and custom variable extraction</h3>
<p>These functions are utilised internally in the functions from sections 3.3.1 and 3.3.2. They have been provided to more easily enable package users to write their own functions for extracting variables that are not covered in the previous two sections.</p>
<p>The db_query function will query the SQLite database for observations where the <em>medcodeid</em> or <em>prodcodeid</em> is in a specified codelist. For example, we can query the <em>observation</em> table for all codes with <em>medcodeid</em> of 187341000000114. Setting rm_duplicates = TRUE will de-duplicate the output. If the codelist is specified through an R data.frame with the codelist_df argument, the returned query will also contain the variables from the codelist data.frame.</p>
<p>
<span xmlns:mml="http://www.w3.org/1998/Math/MathML" id="pone.0327229.e033">
<img class="inline" src="https://cdn.ncbi.nlm.nih.gov/pmc/blobs/b680/12364311/399bfee51860/pone.0327229.e033.jpg" loading="lazy" alt="Inline graphic">
</span>
</p>
<p>The combine_query_boolean function will assess whether each individual in a specified cohort (pat) has an observation in the queried data (obtained using db_query) within a specified time frame from the index date, returning a 0/1 vector. The cohort must contain a variable called indexdt containing the index date. This function is useful when defining ‘history of’ type variables, where we want to know if there is any record of a given condition prior to the index date.</p>
<p>
<span xmlns:mml="http://www.w3.org/1998/Math/MathML" id="pone.0327229.e034">
<img class="inline" src="https://cdn.ncbi.nlm.nih.gov/pmc/blobs/b680/12364311/65cce2eed08f/pone.0327229.e034.jpg" loading="lazy" alt="Inline graphic">
</span>
</p>
<p>The combine_query function will merge a cohort with the queried data and return a specified number of observations (numobs) within a specified time frame from the index date. This is useful when extracting test data and requiring access to the values of the tests, or when specifying variables that require &gt; 1 observation within a certain time frame (i.e., two prescriptions within a month prior to index date). For queries from the observation table, the query type can be specified as “med” or “test”. Inputting query_type = “med” will just return the date of the observations and the <em>medcodeid</em>.</p>
<p>
<span xmlns:mml="http://www.w3.org/1998/Math/MathML" id="pone.0327229.e035">
<img class="inline" src="https://cdn.ncbi.nlm.nih.gov/pmc/blobs/b680/12364311/de28e820c61b/pone.0327229.e035.jpg" loading="lazy" alt="Inline graphic">
</span>
</p>
<p>For query_type = “test”, the value and other relevant information will also be returned, and those with NA values removed (although this can be altered through argument value_na_rm). We then close the connection to the database.</p>
<p>
<span xmlns:mml="http://www.w3.org/1998/Math/MathML" id="pone.0327229.e036">
<img class="inline" src="https://cdn.ncbi.nlm.nih.gov/pmc/blobs/b680/12364311/05311f5eea52/pone.0327229.e036.jpg" loading="lazy" alt="Inline graphic">
</span>
</p>
<p>If the query was from the drugissue table, then query_type = “drug” should be specified, and the date of the observations and the <em>prodcodeid</em> will be returned. If reduce_output = FALSE, no variables will be removed the output. The functions in this section can be used as building blocks to extract desired variables (e.g., see functions in section 3.3.2).</p>
<section id="sec015"><h4 class="pmc_sec_title">3.3.4 Saving extracted variables directly to a disk drive, and utilising rAURUMs suggested directory system.</h4>
<p>So far all extracted variables (using functions from section 3.3.1 and 3.3.2) have been read into the R workspace by specifying return_output = TRUE. When working with large cohorts it may be preferable to save the output directly onto a disk drive, by specifying out_save_disk = TRUE. The file path to save the output can be specified manually through the out_filepath argument. However, if this argument is left as NULL, <strong>rcprd</strong> will attempt to save the extracted variable into a directory “data/extraction/” relative to the working directory. The name of the file itself will be dependent on the variable name specified through argument varname. This can be a very convenient way to save the output directly to disk without having to repeatedly specify file paths and file names.</p>
<p>There is similar functionality when specifying the codelists. Codelists can be specified in two ways. The first is to read the codelist into R as a character vector and then specify through the argument codelist_vector, which has been done in all the previous examples. Alternatively, codelists stored on the disk drive can be referred to from the codelist argument in many <strong>rcprd</strong> functions, but requires a specific underlying directory structure. The codelist on the disk drive must be stored in a directory called “codelists/analysis/” relative to the working directory. The codelist must be a.csv file, and contain a column <em>medcodeid</em>, <em>prodcodeid</em> or <em>ICD10</em> depending on the table being queried. The input to argument codelist should just be a character string of the name of the files (excluding the suffix ‘.csv’). The codelist_vector argument will take precedence over the codelist argument if both are specified.</p>
<p>Finally, there is similar functionality for accessing the SQLite database internally, rather than having to 1) open a connection, 2) use this as an input in the functions, and then 3) remember to close the connection. Instead, if the SQLite database is stored in a directory “data/sql/” relative to the working directory, the SQLite database can be referred to by name (a character string) with the argument db. A connection to the SQLite datbase will be opened internally within the function call, the SQLite database will be queried, and then the connection closed. Alternatively, a SQLite database stored anywhere on the disk drive can be accessed by specifying the full filepath (character string) with the argument db_filepath.</p>
<p>This workflow is advantageous as it avoids hard file paths which beneficial if wanting to move your code onto another computer system. Furthermore, once codelists and the SQLite database have been created and stored in the appropriate folders, they can simply be referred to by name, resulting in an easier workflow. The function create_directory_system() will create the directory system required to use <strong>rcprd</strong> in this way. To avoid repetition of the previous section, this is showcased just once using the extract_ho function. For the sake of this example, we start by setting the working directory to a directory called <em>inst/example</em> within <strong>rcprd</strong>. To maintain the new working directory across multiple R markdown code chunks, we use knitr::opts_knit$set. To follow this section, the user should simply set their working directory as usual using setwd().</p>
<p>Next, the create_directory_system() function can be used to generate the required directory structure within the working directory:</p>
<p>
<span xmlns:mml="http://www.w3.org/1998/Math/MathML" id="pone.0327229.e037">
<img class="inline" src="https://cdn.ncbi.nlm.nih.gov/pmc/blobs/b680/12364311/fd78130a040a/pone.0327229.e037.jpg" loading="lazy" alt="Inline graphic">
</span>
</p>
<p>An SQLite database called “mydb.sqlite” is then created in the “data/sql” directory, using the same data from the previous examples:</p>
<p>
<span xmlns:mml="http://www.w3.org/1998/Math/MathML" id="pone.0327229.e038">
<img class="inline" src="https://cdn.ncbi.nlm.nih.gov/pmc/blobs/b680/12364311/9a96e18d4148/pone.0327229.e038.jpg" loading="lazy" alt="Inline graphic">
</span>
</p>
<p>Finally, a code list called <em>mylist.csv</em> is created and saved into the <em>codelists/analysis/</em> directory.</p>
<p>
<span xmlns:mml="http://www.w3.org/1998/Math/MathML" id="pone.0327229.e039">
<img class="inline" src="https://cdn.ncbi.nlm.nih.gov/pmc/blobs/b680/12364311/567331d1cf4a/pone.0327229.e039.jpg" loading="lazy" alt="Inline graphic">
</span>
</p>
<p>The <em>mydb.sqlite</em> database can now be queried to create a ‘history of’ type variable using the codelist <em>mylist.csv</em>, with the output saved directly onto the disk drive.</p>
<p>
<span xmlns:mml="http://www.w3.org/1998/Math/MathML" id="pone.0327229.e040">
<img class="inline" src="https://cdn.ncbi.nlm.nih.gov/pmc/blobs/b680/12364311/7a29b1fa1221/pone.0327229.e040.jpg" loading="lazy" alt="Inline graphic">
</span>
</p>
<p>Note that in order to run extract_ho here, a connection to the SQLite database did not need to be created, the codelist did not need to be in the R workspace, and there is no output from this function. Instead the extracted variable has been saved onto the disk drive in an.rds file, and can be read into the R workapce in order to create an analysis-ready dataset using:</p>
<p>
<span xmlns:mml="http://www.w3.org/1998/Math/MathML" id="pone.0327229.e041">
<img class="inline" src="https://cdn.ncbi.nlm.nih.gov/pmc/blobs/b680/12364311/28cdb2a50c12/pone.0327229.e041.jpg" loading="lazy" alt="Inline graphic">
</span>
</p></section><section id="sec016"><h4 class="pmc_sec_title">3.3.5 Extracting longitudinal data/time varying covariates.</h4>
<p>All of the functions in section 3.3.1 and 3.3.2 have the option to extract data at a given time point post index date (specified through the t argument). This allows users to extract data at fixed intervals, which can be utilised for longitudinal analyses where time-varying covariates are required. If saving the extracted variables directly to the disk drive (out_save_disk = TRUE), the time at which data was extracted from, t, will be added to the file name by default.</p></section><section id="sec017"><h4 class="pmc_sec_title">3.3.6 Working with linked data.</h4>
<p>This worked example has overlooked how to work with linked data. Linked data can be added to the SQLite database. The primary diagnosis file can be added using the add_to_database() function by specifying filetype = “hes_primary”. Any other linked file can be added to the SQLite database by writing a user-defined function which reads in the text file and formats the variables appropriately and specifying this through the `extract_txt_func` argument. However, the user will have to define functions for querying the linked data and creating variables for analysis. Working with linked data has not been made part of the core functionality because it is often much smaller in size, and files (e.g., HES Admitted Patient Care primary diagnosis file, or Office for National Statistics death registration data) are not broken up into large number of smaller files. This means they can be more easily read into R and dealt with in the R workspace.</p></section></section></section><section id="sec018"><h2 class="pmc_sec_title">4 Performance and scalability case study</h2>
<section id="sec018a"><h3 class="pmc_sec_title">4.1. Introduction</h3>
<p>So far, all the examples have been run on a very small amount of simulated data which bears no resemblance to the real CPRD Aurum data beyond the structure and variable types (all dates simulated at random between 01/01/1900 and 01/01/2000, all numbers simulated as random integers between 1 and 100). This is due to data access restrictions with the real database, and to allow all examples to be run by package users (a CRAN requirement). In this section we present a case-study to assess the performance of the package in a dataset more representative of the reality of working with large CPRD Aurum data. We set the hypothetical case-study aim of estimating the proportion of individuals alive in 2010 that have a history of hypertension. We compare the performance of <strong>rcprd</strong> with the approach of reading in and querying the raw text files manually in a ‘for loop’. Our aim is to quantify elapsed time, peak RAM usage and total RAM usage. We do not compare with <strong>rEHR</strong> or <strong>aurumpipeline</strong>, because we do not expect computational gains over these packages, these packages just do different things.</p></section><section id="sec019"><h3 class="pmc_sec_title">4.2 Data</h3>
<p>We utilize the synthetic CPRD Aurum data [<a href="#pone.0327229.ref018" class="usa-link" aria-describedby="pone.0327229.ref018">18</a>], which is available for free upon submitting a request form. We used the medium-fidelity synthetic CPRD datasets, however, these datasets are not of the same size as the real CPRD data. The synthetic data contains one text file for each file type, the patient file has 45,662 patients, and the observation file contains ~ 4.5 million observations and is 0.4GB in size. The 2021 CPRD Aurum extract contained &gt; 1200 observation files, each 1GB in size. We therefore had to take steps to increase the size of the synthetic data.</p>
<p>First, we doubled the size of the patient and observation files by duplicating and stacking these datasets, but gave new patient ID’s to the new rows. The patient ID’s were kept consistent between the two files (i.e., new observations for a given individual in the observation file, were assigned the same patient ID, corresponding to the patient ID of the new individual in the patient file). We then duplicated these files 250 times. This resulted in 250 observation files of size 0.8GB each.</p></section><section id="sec020"><h3 class="pmc_sec_title">4.3 Methods</h3>
<p>The code for this case study is available in the supplementary material. With access to the CPRD synthetic data, this example is fully reproducible.</p>
<p>We first created our cohort based off the patient files using the extract_cohort() function. We merged this with the practice file to get the last data collection date for each practice. Start of follow-up was defined using date of registration wit the practice. End of follow-up was the minimum of end of registration with the practice, and practice last data collection. Individuals were excluded if not actively registered on the 1<sup>st</sup> January 2010. This resulted in ~7 million individuals. When then extracted the variable “history of hypertension” prior to the 1<sup>st</sup> January 2010 using <strong>rcprd</strong> and a for loop applied to the raw data.</p>
<p>For the <strong>rcprd</strong> approach, we added all the observation files to an SQLite database using cprd_extract(), only adding the data for individuals that met the inclusion criteria, as done in section 3.2.2. This resulted in an SQLite database of size 172GB. We then extracted the history of hypertension variable using the extract_ho() function to query the SQLite database and derive the variable. The for loop approach followed the steps in <a href="#pone.0327229.box002" class="usa-link">Box 2</a>.</p>
<section class="bt xbox font-sm" id="pone.0327229.box002"><h4 class="obj_head">Box 2: Steps for estimating a ‘history of’ variable using the manual for loop approach.</h4>
<ul class="list" style="list-style-type:none"><li><p>Step 1: Create a 0 vector of length equal to the size of the cohort indicating disease status.</p></li></ul>
<p>For i in 1:250:</p>
<ul class="list" style="list-style-type:none">
<li><p>Step 2: Read in raw observation file and format ‘obsdate’ as a date variable.</p></li>
<li><p>Step 3: Subset the observation file to those with medcodeid contained in the codelist (see supplementary material).</p></li>
<li><p>Step 4: Merge observation file with the cohort and remove observations that didn’t happen prior to the index date.</p></li>
<li><p>Step 5: If an individual has a record of hypertension prior to the index date from step 3, set their disease status to ‘1’ in the vector from step 1.</p></li>
</ul>
<p>End loop.</p></section><p>We have attempted to do this in the most computationally efficient manner possible. Raw text files are read in using <strong>data.table::fread</strong> which is significantly quicker than <strong>utils::read.table</strong>. Subsetting/filtering is done using <strong>fastmatch::fmatch</strong>, which is significantly quicker than using the <strong>base::subset</strong> or <strong>dplyr::filter</strong> functions. In spite of this, we appreciate this approach may still not be optimal. We therefore also apply a third approach, where we just cycle through and read the 250 observation files into the R workspace and subset based on the codelist, and do not apply steps 4 or 5. This acts as a hard lower bound for the computational time when using the manual approach.</p>
<p>Finally, it should be noted that the number of observations in the observation file per patient in the synthetic data is smaller than in the real CPRD Aurum data. This results in a smaller SQLite database for the given cohort, compared to what we would see in practice. Part of this case study is to assess the computational performance of <strong>rcprd</strong> in very large data. We therefore repeated the <strong>rcprd</strong> approach, but when creating the SQLite database, we did not filter to select individuals meeting the inclusion criteria. This resulted in an SQLite database of size 172GB. While we would not recommend this in practice, and therefore performance in comparison to the for-loop approach is not relevant, it gives the user an idea of RAM usage and elapsed time for variable extraction if your SQLite database is much bigger.</p></section><section id="sec021"><h3 class="pmc_sec_title">4.4 Results and discussion</h3>
<p>The proportion of individuals with a history of hypertension on 1<sup>st</sup> January 2010 was 10.34%, obtained either using <strong>rcprd</strong> or the manual approach. Note, this is not representative of the actual prevalence of CPRD on the UK population due to the use of synthetic data. The results comparing computational efficiency in terms of elapsed time and peak RAM usage are contained in <a href="#pone.0327229.t002" class="usa-link">Table 2</a>.</p>
<section class="tw xbox font-sm" id="pone.0327229.t002"><h4 class="obj_head">Table 2. Elapsed computation time, peak RAM usage, and total RAM usage for each approach.</h4>
<div class="tbl-box p" tabindex="0"><table class="content" frame="hsides" rules="groups">
<colgroup span="1">
<col align="left" valign="middle" span="1">
<col align="left" valign="middle" span="1">
<col align="left" valign="middle" span="1">
<col align="left" valign="middle" span="1">
<col align="left" valign="middle" span="1">
</colgroup>
<thead><tr>
<th align="left" rowspan="1" colspan="1"></th>
<th align="left" rowspan="1" colspan="1">rcprd</th>
<th align="left" rowspan="1" colspan="1">rcprd (no filtering when creating SQLite)</th>
<th align="left" rowspan="1" colspan="1">Manual loop</th>
<th align="left" rowspan="1" colspan="1">Manual loop, no derivation of variable</th>
</tr></thead>
<tbody>
<tr>
<td align="left" rowspan="1" colspan="1">Elapsed Computation Time</td>
<td align="left" rowspan="1" colspan="1">41 minutes</td>
<td align="left" rowspan="1" colspan="1">58 minutes</td>
<td align="left" rowspan="1" colspan="1">431 minutes</td>
<td align="left" rowspan="1" colspan="1">125 minutes</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">Peak RAM usage</td>
<td align="left" rowspan="1" colspan="1">8452</td>
<td align="left" rowspan="1" colspan="1">7370</td>
<td align="left" rowspan="1" colspan="1">4262</td>
<td align="left" rowspan="1" colspan="1">3370</td>
</tr>
</tbody>
</table></div>
<div class="p text-right font-secondary"><a href="table/pone.0327229.t002/" class="usa-link" target="_blank" rel="noopener noreferrer">Open in a new tab</a></div></section><p>The <strong>rcprd</strong> approach took 41 minutes compared to 431 minutes for the manual for-loop approach. The <strong>rcprd</strong> approach also required less than half of the computation time than it took to simply read in the raw text files without any derivation of the variable itself (125 minutes). The <strong>rcprd</strong> approach took 58 minutes to run when querying the SQLite database which did not filter to individuals in the cohort of interest (the SQLite databases were 101GB and 172GB in size respectively).</p>
<p>While the elapsed time of <strong>rcprd</strong> was considerably lower than the for-loop approach, it did have a higher peak RAM (8452 MiB vs 4202 MiB), meaning higher RAM computers may be required to implement this approach. It’s worth noting that the peak RAM did not increase when querying the bigger SQLite database. This is because the peak RAM of the <strong>rcprd</strong> approach is driven by the size of the query returned into the R workspace, and subsequent functions to derive the variable, rather than the size of the SQLite database being queried. Querying a larger SQLite database will result in increased computation time, as evidenced by the increase in computation time between the two <strong>rcprd</strong> approaches. However, a relative increase in database size of 1.71 (172GB vs 102GB), only resulted in an increase in computation time of 1.41 (58 vs 41 minutes). We expect a linear relationship between database size and query time given the SQLite query is implemented without indexing.</p>
<p>This is just an example, and results will differ when working with the real CPRD Aurum data. We believe the computational gains in terms of elapsed time will be bigger if running on the entire CPRD Aurum extract, and smaller if running on a smaller cut of the raw data. We expect the elapsed time for the manual method to scale linearly as the size of the raw data increases, as this will result in more text files, and the text files are read in one at a time. On the contrary, we believe the <strong>rcprd</strong> approach will scale linearly with the size of the cohort. We saw previously that this approach scales linearly with the size of the SQLite database, however, observations should only be added to the SQLite database for individuals that meet the cohort inclusion/exclusion criteria. Therefore, the computation time of the functions to query the SQLite database and create variables for analysis (section 3.3) should scale linearly with the size of the cohort. This means if the cohort is very small, and the user is working with the entire raw data, then utilizing the functionality of SQLite becomes particularly relevant.</p></section></section><section id="sec022"><h2 class="pmc_sec_title">5 Discussion</h2>
<p><strong>rcprd</strong> is an R package which allows users to process CPRD data in R in a consistent and computationally efficiency manner. It provides functionality to both read in and store data, and query this data in order to create analysis-ready datasets. <strong>rcprd</strong> enables the handling and storing the raw data, achieved through the creation of an SQLite database using RSQLite. The user can define their own functions for reading in the raw data, allowing these functions to be applied to other electronic health records, or future versions of CPRD which have different data structures. The functions for extraction of variables to create analysis-ready datasets are split into three groups: 1) Functions for extracting common variable types (history of a specified condition, time until event occurs, or most recent test result); 2) Functions for extracting specific variables; 3) Functions for database queries and custom variable extraction. These querying large data files that could not otherwise be handled in the R workspace. These functions uses computationally efficient SQL queries to query large datasets that could not be read into the R workspace, but no-user knowledge of SQL is required. If using <strong>rcprd</strong> to store data from non-CPRD electronic health records, the functions for variable extraction will not be compatible.</p>
<p>By utilising RSQLite for the storing and querying of the raw data, <strong>rcprd</strong> follows the suggested approach of <strong>rEHR</strong> [<a href="#pone.0327229.ref007" class="usa-link" aria-describedby="pone.0327229.ref007">7</a>]. In many ways, <strong>rEHR</strong> is more comprehensive than <strong>rcprd</strong>, as it could also be used for case-control matching, cutting up a survival cohort by time-varying covariates, and constructing clinical code lists. Both packages provide functionality to query the underlying database for observations with specific medical or prescription codes without needing SQL experience, however, differ in their method for doing so. <strong>rEHR</strong> functions return observations between specified dates, whether that is all clinical codes, or the first/last clinical code in that period. These functions can also be applied across multiple time periods (i.e., by year) simultaneously. In contrast, <strong>rcprd</strong> functions query the database and return observations in a time period relative to an index date, which may (or may not) be a different date for each patient. As well as functions to query the database, <strong>rcprd</strong> also provides functions which will extract specific variable types, again relative to a given index date. For example, a binary variable based on existence of a clinical code prior to the index date, a test result between a specified upper and lower bound, or a time-to-event/survival type variable. These functions can also be applied any number of days before/after the specified index date to allow extraction of data for longitudinal analyses. The approach of <strong>rcprd</strong>, extracting variables relative to an index date is common when building datasets to be used for development or validation of a clinical prediction model [<a href="#pone.0327229.ref019" class="usa-link" aria-describedby="pone.0327229.ref019">19</a>], whereas the functions contained in <strong>rEHR</strong> are relevant for a wider range of epidemiological analyses, including case-control studies and reporting descriptive properties such as incidence/prevalence. A final key difference, is that <strong>rEHR</strong> is no longer routinely maintained, and cannot be used out of the box on CPRD Aurum data.</p>
<p><strong>aurumpipeline</strong> takes a different approach to <strong>rEHR</strong> and <strong>rcprd</strong> by using parquet files to store the data as opposed to SQLite. Parquet files are efficient for data storage and are optimised for query performance, meaning this setup has a high ceiling in term of computational efficiency. <strong>aurumpipeline</strong> provides functions to query the raw data between two fixed dates, with the option to define a binary variable depending if specified medical codes are recorded in this time period. Beyond this, the <strong>arrow</strong> [<a href="#pone.0327229.ref020" class="usa-link" aria-describedby="pone.0327229.ref020">20</a>] package is recommended for any further data base queries, meaning the derivation of other variables types will require user-developed functions.</p>
<p>The strength of <strong>rcprd</strong> is to simplify the complex process of turning raw CPRD data into an analysis-ready dataset, and does this by following the process of [<a href="#pone.0327229.ref007" class="usa-link" aria-describedby="pone.0327229.ref007">7</a>]. Functions for extracting variables have been designed to be user friendly, to the extent that all that needs to be specified is the index date and code list, and a number of different common variable types can be derived. More basic functions are also provided, which simply return queries of the underlying data, in order to allow the user flexibility in defining their own functions for extracting other variables or summary statistics. Another limitation is that the scope of this package may not be considered comprehensive and cover the needs of all statisticians/epidemiologists. However, as the scope and size of the package increases, so does the task of maintaining it. We believe in it’s current state, maintenance of <strong>rcprd</strong> is manageable going forwards. Furthermore, <strong>rcprd</strong> provides the foundations to build a data set for any type of analysis, some tasks will just require more user-input in order to define new functions around the database queries.</p>
<p>In summary, the main goal of this package is to reduce the duplication of time and effort among those using CPRD data for their research, allowing more time to be focused on other aspects of research projects. <strong>rcprd</strong> will be actively maintained for the foreseeable future. Suggestions for improvement are encouraged and can be posted on GitHub: <a href="https://github.com/alexpate30/rcprd" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">https://github.com/alexpate30/rcprd</a>.</p></section><section id="ack1" class="ack"><h2 class="pmc_sec_title">Acknowledgments</h2>
<p>The authors would like to thank Dr Brian McMillan for his support.</p></section><section id="notes1"><h2 class="pmc_sec_title">Data Availability</h2>
<p>The package developed in this study is available from the Comprehensive R Archive Network at <a href="https://CRAN.R-project.org/package=rcprd" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">https://CRAN.R-project.org/package=rcprd</a>, or can be installed from the following GitHub repository: <a href="https://github.com/alexpate30/rcprd" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">https://github.com/alexpate30/rcprd</a>. The data for this worked example, which is simulated completely at random, is provided within the package. For the case-study we used synthetic patient-level data from the CPRD that are not publicly available. However, researchers can access these databases without a fee by contacting CPRD. Details of the application process and conditions of access are available at: <a href="https://www.cprd.com/synthetic-data" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">https://www.cprd.com/synthetic-data</a> and <a href="https://www.cprd.com/data-access" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">https://www.cprd.com/data-access</a>. Code for implementing the case study is provided in the supplementary material, and is available at the following GitHub page: <a href="https://github.com/manchester-predictive-healthcare-group/CHI-CHARIOT/" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">https://github.com/manchester-predictive-healthcare-group/CHI-CHARIOT/</a>. The results in this paper were obtained using R version 4.4.0 with packages dplyr, tidyr, data.table, fastmatch, RSQLite, stringr, and all packages used are available from the Comprehensive Archive Network (CRAN).</p></section><section id="funding-statement1" lang="en"><h2 class="pmc_sec_title">Funding Statement</h2>
<p>This research was funded by The National Institute for Health Research (NIHR) School for Primary Care Research (SPCR) (reference: NIHR SPCR-2021-2026, grant number 648) and Endeavour Health Charitable Trust. The views expressed are those of the authors and not necessarily those of the NIHR, the Department of Health and Social Care, or Endeavour Health.</p></section><section id="ref-list1" class="ref-list"><h2 class="pmc_sec_title">References</h2>
<section id="ref-list1_sec2"><ul class="ref-list font-sm" style="list-style-type:none">
<li id="pone.0327229.ref001">
<span class="label">1.</span><cite>Herrett E, Gallagher AM, Bhaskaran K, Forbes H, Mathur R, Staa T van. Data Resource Profile: Clinical Practice Research Datalink (CPRD). Int J Epidemiol. 2015;44(3):827–36.
</cite> [<a href="https://doi.org/10.1093/ije/dyv098" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">DOI</a>] [<a href="/articles/PMC4521131/" class="usa-link">PMC free article</a>] [<a href="https://pubmed.ncbi.nlm.nih.gov/26050254/" class="usa-link">PubMed</a>] [<a href="https://scholar.google.com/scholar_lookup?journal=Int%20J%20Epidemiol&amp;title=Data%20Resource%20Profile:%20Clinical%20Practice%20Research%20Datalink%20(CPRD)&amp;author=E%20Herrett&amp;author=AM%20Gallagher&amp;author=K%20Bhaskaran&amp;author=H%20Forbes&amp;author=R%20Mathur&amp;volume=44&amp;issue=3&amp;publication_year=2015&amp;pages=827-36&amp;pmid=26050254&amp;doi=10.1093/ije/dyv098&amp;" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">Google Scholar</a>]</li>
<li id="pone.0327229.ref002">
<span class="label">2.</span><cite>Wolf A, Dedman D, Campbell J, Booth H, Lunn D, Chapman J, et al. Data resource profile: Clinical Practice Research Datalink (CPRD) Aurum. Int J Epidemiol. 2019;48(6):1740–1740g. doi: 10.1093/ije/dyz034

</cite> [<a href="https://doi.org/10.1093/ije/dyz034" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">DOI</a>] [<a href="/articles/PMC6929522/" class="usa-link">PMC free article</a>] [<a href="https://pubmed.ncbi.nlm.nih.gov/30859197/" class="usa-link">PubMed</a>] [<a href="https://scholar.google.com/scholar_lookup?journal=Int%20J%20Epidemiol&amp;title=Data%20resource%20profile:%20Clinical%20Practice%20Research%20Datalink%20(CPRD)%20Aurum&amp;author=A%20Wolf&amp;author=D%20Dedman&amp;author=J%20Campbell&amp;author=H%20Booth&amp;author=D%20Lunn&amp;volume=48&amp;issue=6&amp;publication_year=2019&amp;pages=1740-1740g&amp;pmid=30859197&amp;doi=10.1093/ije/dyz034&amp;" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">Google Scholar</a>]</li>
<li id="pone.0327229.ref003">
<span class="label">3.</span><cite>Padmanabhan S, Carty L, Cameron E, Ghosh RE, Williams R, Strongman H. Approach to record linkage of primary care data from Clinical Practice Research Datalink to other health-related patient data: overview and implications. Eur J Epidemiol. 2019;34(1):91–9. doi: 10.1007/s10654-018-0442-4

</cite> [<a href="https://doi.org/10.1007/s10654-018-0442-4" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">DOI</a>] [<a href="/articles/PMC6325980/" class="usa-link">PMC free article</a>] [<a href="https://pubmed.ncbi.nlm.nih.gov/30219957/" class="usa-link">PubMed</a>] [<a href="https://scholar.google.com/scholar_lookup?journal=Eur%20J%20Epidemiol&amp;title=Approach%20to%20record%20linkage%20of%20primary%20care%20data%20from%20Clinical%20Practice%20Research%20Datalink%20to%20other%20health-related%20patient%20data:%20overview%20and%20implications&amp;author=S%20Padmanabhan&amp;author=L%20Carty&amp;author=E%20Cameron&amp;author=RE%20Ghosh&amp;author=R%20Williams&amp;volume=34&amp;issue=1&amp;publication_year=2019&amp;pages=91-9&amp;pmid=30219957&amp;doi=10.1007/s10654-018-0442-4&amp;" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">Google Scholar</a>]</li>
<li id="pone.0327229.ref004">
<span class="label">4.</span><cite>Kontopantelis E, Stevens RJ, Helms PJ, Edwards D, Doran T, Ashcroft DM. Spatial distribution of clinical computer systems in primary care in England in 2016 and implications for primary care electronic medical record databases: a cross-sectional population study. BMJ Open. 2018;8(2):e020738. doi: 10.1136/bmjopen-2017-020738

</cite> [<a href="https://doi.org/10.1136/bmjopen-2017-020738" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">DOI</a>] [<a href="/articles/PMC5855245/" class="usa-link">PMC free article</a>] [<a href="https://pubmed.ncbi.nlm.nih.gov/29490968/" class="usa-link">PubMed</a>] [<a href="https://scholar.google.com/scholar_lookup?journal=BMJ%20Open&amp;title=Spatial%20distribution%20of%20clinical%20computer%20systems%20in%20primary%20care%20in%20England%20in%202016%20and%20implications%20for%20primary%20care%20electronic%20medical%20record%20databases:%20a%20cross-sectional%20population%20study&amp;author=E%20Kontopantelis&amp;author=RJ%20Stevens&amp;author=PJ%20Helms&amp;author=D%20Edwards&amp;author=T%20Doran&amp;volume=8&amp;issue=2&amp;publication_year=2018&amp;pmid=29490968&amp;doi=10.1136/bmjopen-2017-020738&amp;" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">Google Scholar</a>]</li>
<li id="pone.0327229.ref005">
<span class="label">5.</span><cite>CPRD Aurum September 2024 Dataset. CPRD. <a href="https://www.cprd.com/doi/cprd-aurum-march-2024-dataset" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">https://www.cprd.com/doi/cprd-aurum-march-2024-dataset</a></cite> [<a href="https://scholar.google.com/scholar_lookup?CPRD%20Aurum%20September%202024%20Dataset.%20CPRD.%20https://www.cprd.com/doi/cprd-aurum-march-2024-dataset" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">Google Scholar</a>]</li>
<li id="pone.0327229.ref006">
<span class="label">6.</span><cite>CPRD. CPRD GOLD September 2024 Dataset. <a href="https://www.cprd.com/doi/cprd-gold-june-2024-dataset" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">https://www.cprd.com/doi/cprd-gold-june-2024-dataset</a></cite>
</li>
<li id="pone.0327229.ref007">
<span class="label">7.</span><cite>Springate DA, Parisi R, Olier I, Reeves D, Kontopantelis E. rEHR: An R package for manipulating and analysing Electronic Health Record data. PLoS One. 2017;12(2):e0171784. doi: 10.1371/journal.pone.0171784

</cite> [<a href="https://doi.org/10.1371/journal.pone.0171784" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">DOI</a>] [<a href="/articles/PMC5323003/" class="usa-link">PMC free article</a>] [<a href="https://pubmed.ncbi.nlm.nih.gov/28231289/" class="usa-link">PubMed</a>] [<a href="https://scholar.google.com/scholar_lookup?journal=PLoS%20One&amp;title=rEHR:%20An%20R%20package%20for%20manipulating%20and%20analysing%20Electronic%20Health%20Record%20data&amp;author=DA%20Springate&amp;author=R%20Parisi&amp;author=I%20Olier&amp;author=D%20Reeves&amp;author=E%20Kontopantelis&amp;volume=12&amp;issue=2&amp;publication_year=2017&amp;pmid=28231289&amp;doi=10.1371/journal.pone.0171784&amp;" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">Google Scholar</a>]</li>
<li id="pone.0327229.ref008">
<span class="label">8.</span><cite>The Health Foundation Analytics Lab. Aurumpipeline [Internet]. 2021. Available from: <a href="https://github.com/HFAnalyticsLab/aurumpipeline" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">https://github.com/HFAnalyticsLab/aurumpipeline</a></cite>
</li>
<li id="pone.0327229.ref009">
<span class="label">9.</span><cite>Yimer BB, Selby D, Jani M, Nenadic G, Lunt M, Dixon WG. Drugprepr: Prepare Electronic Prescription Record Data to Estimate Drug Exposure. <a href="https://cran.r-project.org/package=drugprepr" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">https://cran.r-project.org/package=drugprepr</a>. 2021.</cite>
</li>
<li id="pone.0327229.ref010">
<span class="label">10.</span><cite>Pye SR, Sheppard T, Joseph RM, Lunt M, Girard N, Haas JS, et al. Assumptions made when preparing drug exposure data for analysis have an impact on results: An unreported step in pharmacoepidemiology studies. Pharmacoepidemiol Drug Saf. 2018;27(7):781–8. doi: 10.1002/pds.4440

</cite> [<a href="https://doi.org/10.1002/pds.4440" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">DOI</a>] [<a href="/articles/PMC6055712/" class="usa-link">PMC free article</a>] [<a href="https://pubmed.ncbi.nlm.nih.gov/29667263/" class="usa-link">PubMed</a>] [<a href="https://scholar.google.com/scholar_lookup?journal=Pharmacoepidemiol%20Drug%20Saf&amp;title=Assumptions%20made%20when%20preparing%20drug%20exposure%20data%20for%20analysis%20have%20an%20impact%20on%20results:%20An%20unreported%20step%20in%20pharmacoepidemiology%20studies&amp;author=SR%20Pye&amp;author=T%20Sheppard&amp;author=RM%20Joseph&amp;author=M%20Lunt&amp;author=N%20Girard&amp;volume=27&amp;issue=7&amp;publication_year=2018&amp;pages=781-8&amp;pmid=29667263&amp;doi=10.1002/pds.4440&amp;" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">Google Scholar</a>]</li>
<li id="pone.0327229.ref011">
<span class="label">11.</span><cite>CPRD. CPRD Aurum Data Specification. 2022. <a href="https://www.cprd.com/" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">https://www.cprd.com/</a></cite>
</li>
<li id="pone.0327229.ref012">
<span class="label">12.</span><cite>Müller K, Wickham H, James DA, Falcon S. RSQLite: SQLite Interface for R. RSQLite Documentation. <a href="https://rsqlite.r-dbi.org" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">https://rsqlite.r-dbi.org</a>. 2024.</cite> [<a href="https://scholar.google.com/scholar_lookup?M%C3%BCller%20K,%20Wickham%20H,%20James%20DA,%20Falcon%20S.%20RSQLite:%20SQLite%20Interface%20for%20R.%20RSQLite%20Documentation.%20https://rsqlite.r-dbi.org.%202024." class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">Google Scholar</a>]</li>
<li id="pone.0327229.ref013">
<span class="label">13.</span><cite>Williams R, Brown B, Kontopantelis E, van Staa T, Peek N. Term sets: A transparent and reproducible representation of clinical code sets. PLoS One. 2019;14(2):e0212291. doi: 10.1371/journal.pone.0212291

</cite> [<a href="https://doi.org/10.1371/journal.pone.0212291" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">DOI</a>] [<a href="/articles/PMC6375602/" class="usa-link">PMC free article</a>] [<a href="https://pubmed.ncbi.nlm.nih.gov/30763407/" class="usa-link">PubMed</a>] [<a href="https://scholar.google.com/scholar_lookup?journal=PLoS%20One&amp;title=Term%20sets:%20A%20transparent%20and%20reproducible%20representation%20of%20clinical%20code%20sets&amp;author=R%20Williams&amp;author=B%20Brown&amp;author=E%20Kontopantelis&amp;author=T%20van%20Staa&amp;author=N%20Peek&amp;volume=14&amp;issue=2&amp;publication_year=2019&amp;pmid=30763407&amp;doi=10.1371/journal.pone.0212291&amp;" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">Google Scholar</a>]</li>
<li id="pone.0327229.ref014">
<span class="label">14.</span><cite>Williams R, Kontopantelis E, Buchan I, Peek N. Clinical code set engineering for reusing EHR data for research: A review. J Biomed Inform. 2017;70:1–13. doi: 10.1016/j.jbi.2017.04.010

</cite> [<a href="https://doi.org/10.1016/j.jbi.2017.04.010" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">DOI</a>] [<a href="https://pubmed.ncbi.nlm.nih.gov/28442434/" class="usa-link">PubMed</a>] [<a href="https://scholar.google.com/scholar_lookup?journal=J%20Biomed%20Inform&amp;title=Clinical%20code%20set%20engineering%20for%20reusing%20EHR%20data%20for%20research:%20A%20review&amp;author=R%20Williams&amp;author=E%20Kontopantelis&amp;author=I%20Buchan&amp;author=N%20Peek&amp;volume=70&amp;publication_year=2017&amp;pages=1-13&amp;pmid=28442434&amp;doi=10.1016/j.jbi.2017.04.010&amp;" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">Google Scholar</a>]</li>
<li id="pone.0327229.ref015">
<span class="label">15.</span><cite>Watson J, Nicholson BD, Hamilton W, Price S. Identifying clinical features in primary care electronic health record studies: methods for codelist development. BMJ Open. 2017;7(11):e019637. doi: 10.1136/bmjopen-2017-019637

</cite> [<a href="https://doi.org/10.1136/bmjopen-2017-019637" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">DOI</a>] [<a href="/articles/PMC5719324/" class="usa-link">PMC free article</a>] [<a href="https://pubmed.ncbi.nlm.nih.gov/29170293/" class="usa-link">PubMed</a>] [<a href="https://scholar.google.com/scholar_lookup?journal=BMJ%20Open&amp;title=Identifying%20clinical%20features%20in%20primary%20care%20electronic%20health%20record%20studies:%20methods%20for%20codelist%20development&amp;author=J%20Watson&amp;author=BD%20Nicholson&amp;author=W%20Hamilton&amp;author=S%20Price&amp;volume=7&amp;issue=11&amp;publication_year=2017&amp;pmid=29170293&amp;doi=10.1136/bmjopen-2017-019637&amp;" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">Google Scholar</a>]</li>
<li id="pone.0327229.ref016">
<span class="label">16.</span><cite>Gulliford MC, Charlton J, Ashworth M, Rudd AG, Toschke AM, eCRT Research Team. Selection of medical diagnostic codes for analysis of electronic patient records. Application to stroke in a primary care database. PLoS One. 2009;4(9):e7168. doi: 10.1371/journal.pone.0007168

</cite> [<a href="https://doi.org/10.1371/journal.pone.0007168" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">DOI</a>] [<a href="/articles/PMC2744876/" class="usa-link">PMC free article</a>] [<a href="https://pubmed.ncbi.nlm.nih.gov/19777060/" class="usa-link">PubMed</a>] [<a href="https://scholar.google.com/scholar_lookup?journal=PLoS%20One&amp;title=Selection%20of%20medical%20diagnostic%20codes%20for%20analysis%20of%20electronic%20patient%20records.%20Application%20to%20stroke%20in%20a%20primary%20care%20database&amp;author=MC%20Gulliford&amp;author=J%20Charlton&amp;author=M%20Ashworth&amp;author=AG%20Rudd&amp;author=AM%20Toschke&amp;volume=4&amp;issue=9&amp;publication_year=2009&amp;pmid=19777060&amp;doi=10.1371/journal.pone.0007168&amp;" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">Google Scholar</a>]</li>
<li id="pone.0327229.ref017">
<span class="label">17.</span><cite>Matthewman J, Andresen K, Suffel A, Lin L-Y, Schultze A, Tazare J, et al. Checklist and guidance on creating codelists for routinely collected health data research. NIHR Open Res. 2024;4:20. doi: 10.3310/nihropenres.13550.2

</cite> [<a href="https://doi.org/10.3310/nihropenres.13550.2" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">DOI</a>] [<a href="/articles/PMC11437289/" class="usa-link">PMC free article</a>] [<a href="https://pubmed.ncbi.nlm.nih.gov/39345273/" class="usa-link">PubMed</a>] [<a href="https://scholar.google.com/scholar_lookup?journal=NIHR%20Open%20Res&amp;title=Checklist%20and%20guidance%20on%20creating%20codelists%20for%20routinely%20collected%20health%20data%20research&amp;author=J%20Matthewman&amp;author=K%20Andresen&amp;author=A%20Suffel&amp;author=L-Y%20Lin&amp;author=A%20Schultze&amp;volume=4&amp;publication_year=2024&amp;pages=20&amp;pmid=39345273&amp;doi=10.3310/nihropenres.13550.2&amp;" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">Google Scholar</a>]</li>
<li id="pone.0327229.ref018">
<span class="label">18.</span><cite>Clinical Practice Research Datalink. CPRD Aurum Sample Dataset October 2021. 2021. 10.48329/hm7t-qs28</cite> [<a href="https://doi.org/10.48329/hm7t-qs28" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">DOI</a>]</li>
<li id="pone.0327229.ref019">
<span class="label">19.</span><cite>Riley RD, van der Windt D, Croft P, Moons KGM. Prognosis Research in Healthcare: Concepts, Methods, and Impact. Oxford: Oxford University Press. 2019.</cite> [<a href="https://scholar.google.com/scholar_lookup?title=Prognosis%20Research%20in%20Healthcare:%20Concepts,%20Methods,%20and%20Impact&amp;author=RD%20Riley&amp;author=D%20van%20der%20Windt&amp;author=P%20Croft&amp;author=KGM%20Moons&amp;publication_year=2019&amp;" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">Google Scholar</a>]</li>
<li id="pone.0327229.ref020">
<span class="label">20.</span><cite>Richardson N, Cook I, Crane N, Dunnington D, Francois R, Keane J. Arrow: Integration to ’Apache’ ’Arrow’. <a href="https://github.com/apache/arrow/" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">https://github.com/apache/arrow/</a>. 2024.</cite>
</li>
</ul></section></section></section><article class="sub-article" id="pone.0327229.r001"><section class="pmc-layout__citation font-secondary font-xs"><div>PLoS One. doi: <a href="https://doi.org/10.1371/journal.pone.0327229.r001" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">10.1371/journal.pone.0327229.r001</a>
</div></section><section class="front-matter"><div class="ameta p font-secondary font-xs">
<hgroup><h1>Decision Letter 0</h1></hgroup><div class="cg p">
<a href="https://pubmed.ncbi.nlm.nih.gov/?term=%22Sivakumar%20B%22%5BAuthor%5D" class="usa-link" aria-describedby="id5"><span class="name western">B Sivakumar</span></a><div hidden="hidden" id="id5">
<h3><span class="name western">B Sivakumar</span></h3>
<div>Academic Editor</div>
<div class="p">Find articles by <a href="https://pubmed.ncbi.nlm.nih.gov/?term=%22Sivakumar%20B%22%5BAuthor%5D" class="usa-link"><span class="name western">B Sivakumar</span></a>
</div>
</div>
</div>
<ul class="d-buttons inline-list">
<li><button class="d-button" aria-controls="aip_a.c" aria-expanded="false">Author information</button></li>
<li><button class="d-button" aria-controls="clp_a.c" aria-expanded="false">Copyright and License information</button></li>
</ul>
<div class="d-panels font-secondary-light">
<div id="aip_a.c" class="d-panel p" style="display: none">
<h4 class="font-secondary">Roles</h4>
<div class="p">
<strong class="contrib"><span class="name western">B Sivakumar</span></strong>: <span class="role">Academic Editor</span>
</div>
</div>
<div id="clp_a.c" class="d-panel p" style="display: none">
<div>© 2025 B. Sivakumar</div>
<p>This is an open access article distributed under the terms of the <a href="https://creativecommons.org/licenses/by/4.0/" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">Creative Commons Attribution License</a> , which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</p>
<div class="p"><a href="/about/copyright/" class="usa-link">PMC Copyright notice</a></div>
</div>
</div>
<div></div>
</div></section><section class="body sub-article-body"><hr class="headless">
<p>
<em>12 Mar 2025</em>
</p>
<p>Dear Dr. Pate,</p>
<p>Thank you for submitting your manuscript to PLOS ONE. After careful consideration, we feel that it has merit but does not fully meet PLOS ONE’s publication criteria as it currently stands. Therefore, we invite you to submit a revised version of the manuscript that addresses the points raised during the review process.</p>
<p>
<strong>Based on the reviewers’ assessments, the manuscript presents a valuable contribution to the field of EHR analysis by introducing the rcprd R package. However, some revisions are necessary before acceptance.</strong>
</p>
<p>
<strong>Required Revisions:</strong>
</p>
<p>
<strong>Performance and Scalability – The authors should include a comparison of runtime and RAM usage when extracting data from an SQLite database versus looping through raw .txt files. A practical case study with real CPRD data (if feasible) would further strengthen the manuscript.</strong>
</p>
<p>
<strong>Comparison with Existing Tools – A direct comparison with other relevant packages, such as rEHR and aurumpipeline, should be included to clarify the advantages of rcprd.</strong>
</p>
<p>
<strong>Data Quality and Extraction Functions – The authors should clarify how unrealistic date values and general diabetes codes are handled in the extraction functions. Additionally, confirming whether SQLite supports date formats would be useful.</strong>
</p>
<p>
<strong>Security Considerations – Explicitly state the importance of using a secure device when adding raw CPRD data to an SQLite database.</strong>
</p>
<p>Please submit your revised manuscript by Apr 26 2025 11:59PM. If you will need more time than this to complete your revisions, please reply to this message or contact the journal office at <span>plosone@plos.org</span> . When you're ready to submit your revision, log on to <a href="https://www.editorialmanager.com/pone/" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">https://www.editorialmanager.com/pone/</a> and select the 'Submissions Needing Revision' folder to locate your manuscript file.</p>
<ul class="list" style="list-style-type:disc">
<li><p>A rebuttal letter that responds to each point raised by the academic editor and reviewer(s). You should upload this letter as a separate file labeled 'Response to Reviewers'.</p></li>
<li><p>A marked-up copy of your manuscript that highlights changes made to the original version. You should upload this as a separate file labeled 'Revised Manuscript with Track Changes'.</p></li>
<li><p>An unmarked version of your revised paper without tracked changes. You should upload this as a separate file labeled 'Manuscript'.</p></li>
</ul>
<p>If you would like to make changes to your financial disclosure, please include your updated statement in your cover letter. Guidelines for resubmitting your figure files are available below the reviewer comments at the end of this letter.</p>
<p>If applicable, we recommend that you deposit your laboratory protocols in protocols.io to enhance the reproducibility of your results. Protocols.io assigns your protocol its own identifier (DOI) so that it can be cited independently in the future. For instructions see: <a href="https://journals.plos.org/plosone/s/submission-guidelines#loc-laboratory-protocols" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">https://journals.plos.org/plosone/s/submission-guidelines#loc-laboratory-protocols</a> . Additionally, PLOS ONE offers an option for publishing peer-reviewed Lab Protocol articles, which describe protocols hosted on protocols.io. Read more information on sharing protocols at <a href="https://plos.org/protocols?utm_medium=editorial-email&amp;utm_source=authorletters&amp;utm_campaign=protocols" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">https://plos.org/protocols?utm_medium=editorial-email&amp;utm_source=authorletters&amp;utm_campaign=protocols</a> .</p>
<p>We look forward to receiving your revised manuscript.</p>
<p>Kind regards,</p>
<p>B. Sivakumar</p>
<p>Academic Editor</p>
<p>PLOS ONE</p>
<p>
<strong>Journal Requirements:</strong>
</p>
<p>1. When submitting your revision, we need you to address these additional requirements.--&gt;--&gt; --&gt;--&gt;Please ensure that your manuscript meets PLOS ONE's style requirements, including those for file naming. The PLOS ONE style templates can be found at --&gt;--&gt;<a href="https://journals.plos.org/plosone/s/file?id=wjVg/PLOSOne_formatting_sample_main_body.pdf" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">https://journals.plos.org/plosone/s/file?id=wjVg/PLOSOne_formatting_sample_main_body.pdf</a> and --&gt;--&gt;<a href="https://journals.plos.org/plosone/s/file?id=ba62/PLOSOne_formatting_sample_title_authors_affiliations.pdf" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">https://journals.plos.org/plosone/s/file?id=ba62/PLOSOne_formatting_sample_title_authors_affiliations.pdf</a>--&gt;--&gt; --&gt;--&gt;2. Please note that PLOS ONE has specific guidelines on code sharing for submissions in which author-generated code underpins the findings in the manuscript. In these cases, all author-generated code must be made available without restrictions upon publication of the work. Please review our guidelines at <a href="https://journals.plos.org/plosone/s/materials-and-software-sharing#loc-sharing-code" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">https://journals.plos.org/plosone/s/materials-and-software-sharing#loc-sharing-code</a> and ensure that your code is shared in a way that follows best practice and facilitates reproducibility and reuse.--&gt;--&gt; --&gt;--&gt;3. Thank you for stating the following financial disclosure: --&gt;--&gt; This research was funded by The National Institute for Health Research (NIHR) School for Primary Care Research (SPCR) (reference: NIHR SPCR-2021-2026, grant number 648) and Endeavour Health Charitable Trust. The views expressed are those of the authors and not necessarily those of the NIHR, the Department of Health and Social Care, or Endeavour Health.--&gt;--&gt; --&gt;--&gt;Please state what role the funders took in the study.  If the funders had no role, please state: "The funders had no role in study design, data collection and analysis, decision to publish, or preparation of the manuscript." --&gt;--&gt;If this statement is not correct you must amend it as needed. --&gt;--&gt;Please include this amended Role of Funder statement in your cover letter; we will change the online submission form on your behalf.--&gt;--&gt; --&gt;--&gt;4. Thank you for stating the following in the Acknowledgments Section of your manuscript: --&gt;--&gt;Dr. Brian McMillan was heavily involved with the acquisition of funding which supports the work done in this manuscript.--&gt;--&gt; --&gt;--&gt;We note that you have provided funding information that is not currently declared in your Funding Statement. However, funding information should not appear in the Acknowledgments section or other areas of your manuscript. We will only publish funding information present in the Funding Statement section of the online submission form. --&gt;--&gt;Please remove any funding-related text from the manuscript and let us know how you would like to update your Funding Statement. Currently, your Funding Statement reads as follows: --&gt;--&gt;This research was funded by The National Institute for Health Research (NIHR) School for Primary Care Research (SPCR) (reference: NIHR SPCR-2021-2026, grant number 648) and Endeavour Health Charitable Trust. The views expressed are those of the authors and not necessarily those of the NIHR, the Department of Health and Social Care, or Endeavour Health. --&gt;--&gt; --&gt;--&gt;Please include your amended statements within your cover letter; we will change the online submission form on your behalf.--&gt;--&gt; --&gt;--&gt;5. In the online submission form, you indicated that your data will be submitted to a repository upon acceptance.  We strongly recommend all authors deposit their data before acceptance, as the process can be lengthy and hold up publication timelines. Please note that, though access restrictions are acceptable now, your entire minimal  dataset will need to be made freely accessible if your manuscript is accepted for publication. This policy applies to all data except where public deposition would breach compliance with the protocol approved by your research ethics board. If you are unable to adhere to our open data policy, please kindly revise your statement to explain your reasoning and we will seek the editor's input on an exemption.--&gt;?&gt;</p>
<p>[Note: HTML markup is below. Please do not edit.]</p>
<p>Reviewers' comments:</p>
<p>Reviewer's Responses to Questions</p>
<p>
<strong>Comments to the Author</strong>
</p>
<p>1. Is the manuscript technically sound, and do the data support the conclusions?</p>
<p>Reviewer #1: Yes</p>
<p>Reviewer #2: Yes</p>
<p>**********</p>
<p>2. Has the statistical analysis been performed appropriately and rigorously? --&gt;?&gt;</p>
<p>Reviewer #1: Yes</p>
<p>Reviewer #2: N/A</p>
<p>**********</p>
<p>3. Have the authors made all data underlying the findings in their manuscript fully available??&gt;</p>
<p>The <a href="http://www.plosone.org/static/policies.action#sharing" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">PLOS Data policy</a></p>
<p>Reviewer #1: Yes</p>
<p>Reviewer #2: Yes</p>
<p>**********</p>
<p>4. Is the manuscript presented in an intelligible fashion and written in standard English??&gt;</p>
<p>Reviewer #1: Yes</p>
<p>Reviewer #2: Yes</p>
<p>**********</p>
<p><strong>Reviewer #1: </strong> **Summary**</p>
<p>The authors introduce a new R package for simplifying data extraction and cleaning data for CPRD Aurum. Building on older but no longer maintained R packages, the authors present a software package storing the data as SQLite database. This is valuable tool for researchers using large electronic health records, given the time consuming data processing with pre-built functions to extract variables and with some included algorithms for data cleaning.</p>
<p>Overall, the paper and software package are very promising and useful but could be improved by clarifying some of the functionalities of the package and comparing the runtime to existing extraction approaches.</p>
<p>**Comments to the authors**</p>
<p>General comments</p>
<p>All worked examples work well. As a researcher who is regularly using CPRD, the main advantage of using a package as the one presented by the authors would be an improvement of runtime and less local RAM use when cleaning big patient dataset. I was wondering if the authors could present some comparisons of RAM use and runtime by extracting data from the SQLite database versus by looping through the CPRD Aurum raw data .txt files? As someone using datasets with up to 20mio patients, this would be the selling point of using the new R package.</p>
<p>Introduction</p>
<p>As this paper is targeted for an audience which has not used SQLite before, I’d suggest to add a half-sentence to explain how an SQLite database on a fixed storage device can align with the data storage requirements of CPRD usage (e.g., can be stored on a secure sever).</p>
<p>2.2 Recommended process for extraction</p>
<p>Cohort specification is often done with type 1 linkage of the data, i.e., using additional data from HES or the ONS mortality dataset. Could the authors clarify whether it is possible to use linked data for the cohort definition in Step 2.2?</p>
<p>3.2.1 Add individual files to SQLite database using add_to_database</p>
<p>When creating an SQLite database, it would be good to remind the reader that this should be done on a secure device as the following functions add raw CPRD data to the database.</p>
<p>3.2.1 Add individual files to SQLite database using add_to_database</p>
<p>Is it possible to store dates in a date format within the SQLite database? It can be sometimes very helpful to inspect the dataset for unrealistic date values which is more difficult if the dates are stored as a number.</p>
<p>3.3.1 Functions for extracting common variable types</p>
<p>Could the authors clarify some of the functionalities around the extraction functions:</p>
<p>• Is the index date of each function applied to the observation date or the enter date of a medical record?</p>
<p>• Do the function check for unrealistic dates, e.g., events recorded in 1899 or before the patient was born? These are common occurrences in CPRD data and should be removed from the final dataset.</p>
<p>Code lists are often include different categories of codes (e.g., a diabetes code list could contain codes for diagnoses, but also referrals, patient registries, examination results, etc). These different categories are often used in sensitivity analyses but also required if variables are defined based on algorithms, e.g., BMI, vaccinations, eGFR, etc.</p>
<p>I think it would make data extraction easier if the authors allowed the user to enter a data frame for the code list instead of a vector alone. This function could extract based on the medcodeid but would merge the other columns included in the code list data frame to the final output. I know that the same can be done by applying the current functions iteratively but I think it would improve the workflow of data extraction.</p>
<p>Algorithms for data extraction</p>
<p>BMI</p>
<p>I would like to flag that there are entries in CPRD in other units than cm/m and kg/stone (e.g., inches, feet, pounds, …). I would recommend the authors to double check that their algorithm includes all possible measuring units of height and weight used in CPRD.</p>
<p>Diabates status</p>
<p>How does the algorithm handle general diabetes codes, e.g., “diabetes mellitus”, “diabetic foot”, etc? In the current version it only allows to enter specific codes for either type 1 or type 2. However, as the generic codes are commonly used, I would recommend including them.</p>
<p><strong>Reviewer #2: </strong> This manuscript introduces rcprd, an R package designed to streamline the extraction, processing, and querying of CPRD data. The package tackles key challenges inherent in working with large-scale EHR data by creating an SQLite database from raw .txt files and offering a suite of functions to extract both common variable types (e.g., history of a condition, time-to-event variables, test results) and specific variables (e.g., BMI, cholesterol/HDL ratio). The manuscript provides a detailed description of each function in the package. The work is timely and promises to significantly reduce redundant efforts in processing CPRD Aurum data, potentially benefiting a wide range of health data researchers. Overall, the manuscript is well-written, well-organized, and represents a significant contribution to the field of EHR analysis.</p>
<p>Major Comments:</p>
<p>Comparison to other packages: Does rEHR or any other package still remain a viable alternative for preparing analysis-ready data from CPRD Aurum data? The authors discussed the differences in approach rather than performance among rEHR, aurumpipeline, and rcprd. Would it be possible to provide a comparison with existing tools? A clear comparison would help highlight the distinct improvements offered by rcprd.</p>
<p>Scalability and practical Implementation: Although the demonstration using a simulated dataset effectively showcases the functionality, the example dataset is relatively small (containing only 12 patients and 8 .txt files). Could the authors expand on practical applications by including performance metrics or a case study using real CPRD data (if feasible) to further validate the package’s utility in real-world settings?</p>
<p>Minor Points:</p>
<p>L165: The authors mention the naming convention for the EHR files. Is user input required for this, or do the CPRD Aurum data files already adhere to the naming convention described in Section 2.1?</p>
<p>L170: Instead of stating “(note, expecting CRAN submission in the next month),” could the authors provide the CRAN link if available? If not, would a specific expected availability date (e.g., year/month) be preferable?</p>
<p>L171: Since reference 12 is the GitHub link for the R package, might it be more straightforward to directly include the GitHub URL rather than citing it as a reference?</p>
<p>L432: When adding all relevant files at once, is there a checking step for duplicate records? Could this potentially pose an issue under certain circumstances?</p>
<p>L581: There appears to be a typo: “ust” -&gt; “must” ?.</p>
<p>**********</p>
<p><a href="https://journals.plos.org/plosone/s/editorial-and-peer-review-process#loc-peer-review-history" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">what does this mean?</a> ). If published, this will include your full peer review and any attached files.</p>
<p>If you choose “no”, your identity will remain anonymous but your review may still be made public.</p>
<p><strong>Do you want your identity to be public for this peer review?</strong> For information about this choice, including consent withdrawal, please see our <a href="https://www.plos.org/privacy-policy" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">Privacy Policy</a></p>
<p>Reviewer #1: No</p>
<p>Reviewer #2: No</p>
<p>**********</p>
<p>[NOTE: If reviewer comments were submitted as an attachment file, they will be attached to this email and accessible via the submission site. Please log into your account, locate the manuscript record, and check for the action link "View Attachments". If this link does not appear, there are no attachment files.]</p>
<p>While revising your submission, please upload your figure files to the Preflight Analysis and Conversion Engine (PACE) digital diagnostic tool, <a href="https://pacev2.apexcovantage.com/" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">https://pacev2.apexcovantage.com/</a> . PACE helps ensure that figures meet PLOS requirements. To use PACE, you must first register as a user. Registration is free. Then, login and navigate to the UPLOAD tab, where you will find detailed instructions on how to use the tool. If you encounter any issues or have any questions when using PACE, please email PLOS at <span>figures@plos.org</span> . Please note that Supporting Information files do not need this step.</p>
<section class="sm xbox font-sm" id="pone.0327229.s001"><div class="caption p">
<span>Attachment</span><p>Submitted filename: <em>Comments PLos1.docx</em></p>
</div>
<div class="media p"><div class="caption">
<a href="/articles/instance/12364311/bin/pone.0327229.s001.docx" data-ga-action="click_feat_suppl" class="usa-link">pone.0327229.s001.docx</a><sup> (18.2KB, docx) </sup>
</div></div></section></section></article><article class="sub-article" id="pone.0327229.r002"><section class="pmc-layout__citation font-secondary font-xs"><div>PLoS One. 2025 Aug 19;20(8):e0327229. doi: <a href="https://doi.org/10.1371/journal.pone.0327229.r002" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">10.1371/journal.pone.0327229.r002</a>
</div></section><section class="front-matter"><div class="ameta p font-secondary font-xs">
<hgroup><h1>Author response to Decision Letter 1</h1></hgroup><ul class="d-buttons inline-list">
<li><button class="d-button" aria-controls="anp_a.d" aria-expanded="false">Article notes</button></li>
<li><button class="d-button" aria-controls="clp_a.d" aria-expanded="false">Copyright and License information</button></li>
</ul>
<div class="d-panels font-secondary-light">
<div id="anp_a.d" class="d-panel p" style="display: none"><div class="notes p"><section id="historyfront-stub2" class="history"><p>Collection date 2025.</p></section></div></div>
<div id="clp_a.d" class="d-panel p" style="display: none"><div class="p"><a href="/about/copyright/" class="usa-link">PMC Copyright notice</a></div></div>
</div>
<div></div>
</div></section><section class="body sub-article-body"><hr class="headless">
<p>
<em>4 Apr 2025</em>
</p>
<p>Hello, many thanks to the editor and both reviewers for their comments. We appreciate the time you have given to reviewing this manuscript. We have made considerable changes to the manuscript:</p>
<p>- Added a performance and scalability case study on synthetic CPRD data which is of comparable size to the real CPRD data. This case study is used to assess computational performance and quantify the benefit over the manual ‘for-loop’ approach.</p>
<p>- The ability to specify codelists through R data frames.</p>
<p>- Cleaning tools such as the ability to de-duplicate data, and the removal of dates before 1900 or prior to patient year of birth.</p>
<p>- Dates now returned in date formats after querying database.</p>
<p>- A new flow diagram and process which aligns with the process implemented by CPRD when cohort inclusion/exclusion criteria are dependent on linked data.</p>
<p>- Clarification over how diabetes codes and units of measurements have been handled.</p>
<p>We provide a comment-by-comment response below. In the submitted response document, reviewer/editors comments are in black text, our response is in blue text, and changes to the manuscript in green text. Line numbers refer to the tracked changes manuscript.</p>
<p>Reviewer #1: **Summary**</p>
<p>The authors introduce a new R package for simplifying data extraction and cleaning data for CPRD Aurum. Building on older but no longer maintained R packages, the authors present a software package storing the data as SQLite database. This is valuable tool for researchers using large electronic health records, given the time consuming data processing with pre-built functions to extract variables and with some included algorithms for data cleaning.</p>
<p>Overall, the paper and software package are very promising and useful but could be improved by clarifying some of the functionalities of the package and comparing the runtime to existing extraction approaches.</p>
<p>**Comments to the authors**</p>
<p>General comments</p>
<p>All worked examples work well. As a researcher who is regularly using CPRD, the main advantage of using a package as the one presented by the authors would be an improvement of runtime and less local RAM use when cleaning big patient dataset. I was wondering if the authors could present some comparisons of RAM use and runtime by extracting data from the SQLite database versus by looping through the CPRD Aurum raw data .txt files? As someone using datasets with up to 20mio patients, this would be the selling point of using the new R package.</p>
<p>We have added a comparison of runtime and RAM usage in a practical case study. Please see the new section 4 in the manuscript.</p>
<p>Please note, we have had to delete our raw CPRD Aurum data (common practice once intermediate datasets have been derived for data security reasons), therefore we have made use of the synthetic CPRD datasets for this: <a href="https://www.cprd.com/synthetic-data" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">https://www.cprd.com/synthetic-data</a>. The synthetic data has the same data structure as the real CPRD Aurum data, however is smaller in size. We have therefore duplicated these synthetic files over and over to create synthetic data which is of comparable size to the real CPRD Aurum data to compare runtime and RAM usage. Another benefit of using the synthetic CPRD data, is that if readers request the data themselves, they will be able to replicate the case study themselves. All code for the case study is available on our GitHub page: XXXX.</p>
<p>Please note, neither the synthetic data or real data can be shared freely, and access is tightly controlled by CPRD. It is therefore not possible to provide easy to access reproducible examples for users that utilise this data and showcase how to use the package. The main body of the paper therefore still utilises the same simulated data from the previous submission.</p>
<p>Finally, while the synthetic data we have created for the case study is still not as big as the data for 20 million patients, it’s on a similar order of magnitude, and the computational time for both methods scales linearly, so we can extrapolate the differences. This is discussed in the final paragraph of section 4. FYI, I work with similarly sized data (~ 20 million patients) and find the SQLite approach to work well. In fact, working with data this size was the motivator for taking up this approach.</p>
<p>Introduction</p>
<p>As this paper is targeted for an audience which has not used SQLite before, I’d suggest to add a half-sentence to explain how an SQLite database on a fixed storage device can align with the data storage requirements of CPRD usage (e.g., can be stored on a secure sever).</p>
<p>You are right about emphasizing data security when utilising rcprd. We have added the following sentence:</p>
<p>Line 82: The SQLite database must be created on a secure device or server which aligns with the data storage requirements of CPRD.</p>
<p>2.2 Recommended process for extraction</p>
<p>Cohort specification is often done with type 1 linkage of the data, i.e., using additional data from HES or the ONS mortality dataset. Could the authors clarify whether it is possible to use linked data for the cohort definition in Step 2.2?</p>
<p>Good question.</p>
<p>Yes, it is possible to use linked data for the cohort definition in step 2.2. Any dataset can be added to the sqlite database using the `add_to_database` function, and specifying a user-defined function (through the `extract_txt_func` argument) for reading in the text file and formatting the variables appropriately. There is also built in function for reading in the primary diagnosis HES file, which can be accessed through specifying `filetype = hes_primary`.</p>
<p>However, we don’t necessarily recommend doing this. The HES data is generally a lot smaller in size and there are little benefits to reading it into an SQLite database and querying this, in comparison to reading in the raw txt file(s) and querying them within R.</p>
<p>Re-reading the proposed steps after your question, we’ve realised it is more appropriate to have a step-by-step process that is in-keeping with the process of requesting of type 1 data, which is very often used for cohort selection. We have re-written the steps and put into a new Box, Box 1. This Box, a Flow diagram, replaces Figure 1.</p>
<p>Line 151: This process aligns with the process implemented by CPRD when cohort inclusion/exclusion criteria are dependent on linked data (see Q2 and step 4).</p>
<p>Finally, please note, because the new steps are contained in a text box, this hasn’t shown up as a tracked change. Not sure why this is the case.</p>
<p>3.2.1 Add individual files to SQLite database using add_to_database</p>
<p>When creating an SQLite database, it would be good to remind the reader that this should be done on a secure device as the following functions add raw CPRD data to the database.</p>
<p>Thanks this is an important suggestion. We have added the following reminder about data security at this point:</p>
<p>Line 268: It is imperative that when adding raw CPRD data to an SQLite database, that the SQLite database itself is stored in a secure environment which aligns with the data storage requirements of CPRD.</p>
<p>Also note, moving forwards, people will have to use the trusted research environment (CPRD Safe), so this will become less of an issue.</p>
<p>3.2.1 Add individual files to SQLite database using add_to_database</p>
<p>Is it possible to store dates in a date format within the SQLite database? It can be sometimes very helpful to inspect the dataset for unrealistic date values which is more difficult if the dates are stored as a number.</p>
<p>The short answer is no, you cannot store variables in date format in the SQLite database. They can be stored either as a number or a character string. When we initially read in the raw text files (using functions in file functions_read_txt.R), we do format them as date values. Upon writing into the SQLite database, it becomes a numeric variable, taking the underlying number that the date value is based on (reference date 1st Jan 1970). When its’ read back in through a query, its read back in as a numeric.</p>
<p>I guess the point at which you would be inspecting the dateset would be after running a database query (i.e. using db_query)? I have changed the code so that db_query will format dates variables as dates. We now also use db_query to view the data, as opposed to RSQLite::dbGetQuery, to ensure that the date formatted values are what is viewed.</p>
<p>Please see the revised section 3.2.1, where all database queries return dates in date format.</p>
<p>Effectively, the date formats are now part of the natural flow of rcprd. The dates are still stored as numbers in the SQLite database, but the user will never come across this unless querying the data using RSQLite, which we don’t recommend or showcase.</p>
<p>3.3.1 Functions for extracting common variable types</p>
<p>Could the authors clarify some of the functionalities around the extraction functions:</p>
<p>• Is the index date of each function applied to the observation date or the enter date of a medical record?</p>
<p>Observation date and issue date. Have added the following text to make this clearer:</p>
<p>Line 666: Variables are calculated relative to the index date using the observation date (obsdate) in the observation file and the issue date (issuedate) in the drug issue file.</p>
<p>• Do the function check for unrealistic dates, e.g., events recorded in 1899 or before the patient was born? These are common occurrences in CPRD data and should be removed from the final dataset.</p>
<p>No they did not. This became very evident in these examples, given the dates are all simulated completely at random.</p>
<p>We have changed the `combine_query` and `combine_query_boolean` functions to remove unrealistic dates (any event before 1900, or before the patient was born). These functions are used internally in all the other functions to extract variables, so will have the desired impact.</p>
<p>Note this has had some minor changes on the results presented.</p>
<p>Code lists are often include different categories of codes (e.g., a diabetes code list could contain codes for diagnoses, but also referrals, patient registries, examination results, etc). These different categories are often used in sensitivity analyses but also required if variables are defined based on algorithms, e.g., BMI, vaccinations, eGFR, etc.</p>
<p>I think it would make data extraction easier if the authors allowed the user to enter a data frame for the code list instead of a vector alone. This function could extract based on the medcodeid but would merge the other columns included in the code list data frame to the final output. I know that the same can be done by applying the current functions iteratively but I think it would improve the workflow of data extraction.</p>
<p>Thanks for this suggestion. I am keen to improve workflow for others, but it’s difficult to predict/know in what ways other people work! We have made the suggested change which has impacted a number of functions in different ways.</p>
<p>The `db_query` function will now merge the output with the codelist dataframe if the codelist is specified using codelist_df. Please note for large queries, this may increase computation time.</p>
<p>For functions extract_time_until and extract_test_data, if the codelist is specified using codelist_df, the output will be merged with the codelist dataframe retaining the other columns from the codelist, as you’ve suggested. For extract_test_data, its the codes associated with the returned tests. For extract_time_until, the associated data is that of the first observation post index date. For all these variables, there will be NA data for individuals who did not have any data matching the codelist.</p>
<p>For all other variables (extract_ho, extract_bmi, extract_cholhdl_ratio, extract_diabetes, extract_impotence, extract_smoking, extract_test_data_var), the codelists can be specified through the codelist_df arguments, but the output will not be merged. This is because these variables are all based off algorithms which may require multiple observations to derive the output, and its unclear which codes to present. E.g. BMI may be derived from directly from a code for BMI, or from two codes of height and weight respectively. Extract_ho might have multiple matching codes in a patients history, again, its unclear which to present.</p>
<p>We have added text in a couple of places, and an example of doing this at the end of section 3.3.1:</p>
<p>Line 776: The codelists can also be specified through an R `data.frame` which must contain either a *medcodeid* or *prodcodeid* column. This may allow the user to run sensitivity analyses more easily if they would like to extract the same variable for different subgroups of the same codelist. For example: ….</p>
<p>Line 849: If the codelist is specified through an R `data.frame` with the `codelist_df` argument, the returned query will also contain the variables from the codelist `data.frame`.</p>
<p>Please let me know if I have misunderstood.</p>
<p>Algorithms for data extraction</p>
<p>BMI</p>
<p>I would like to flag that there are entries in CPRD in other units than cm/m and kg/stone (e.g., inches, feet, pounds, …). I would recommend the authors to double check that their algorithm includes all possible measuring units of height and weight used in CPRD.</p>
<p>You are correct.</p>
<p>We did not include these because we looked at the different unit of measurements for the height and weight records of a large cohort (approx 20 million, real data) of individuals aged 18 - 85 between 2005 – 2020. The results are reported in the article “Details on algorithms for extracting specific variables”. For weight, we found no measurements that were not in kg or stones (or NA). For height, we found no measurements that were not in centimetres or metres (or NA).</p>
<p>We therefore think the approach taken is appropriate.</p>
<p>Diabates status</p>
<p>How does the algorithm handle general diabetes codes, e.g., “diabetes mellitus”, “diabetic foot”, etc? In the current version it only allows to enter specific codes for either type 1 or type 2. However, as the generic codes are commonly used, I would recommend including them.</p>
<p>We assume generic codes refer to type 2, and that type 1 diabetes is only identified through a specific code. This is why if a user has a type 2 and type 1 code, the type 1 code takes precedent, because the type 2 code could just be a generic one.</p>
<p>We have clarified this in the text:</p>
<p>Line 841: For diabetes status, diabetes if often recorded with generic codes such as "diabetes mellitus", which does not specify which type. This is dealt with by assuming all generic codes refer to type 2 diabetes, unless that individual also has a specific type 1 diabetes code, in which case they will be determined to have type 1 diabetes as opposed to type 2.</p>
<p>Full details on the algorithm are available in the package documentation.</p>
<p>Line 846: The full details on extracting these variables are provided in the vignette titled [Details-on-algorithms-for-extracting-specific-variables](<a href="https://alexpate30.github.io/rcprd/articles/Details-on-algorithms-for-extracting-specific-variables.html" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">https://alexpate30.github.io/rcprd/articles/Details-on-algorithms-for-extracting-specific-variables.html</a>).</p>
<p>We are aware that our algorithms for deriving specific variables are not perfect. There is a lack of convention for how to extract these things, and many researchers may do this in different ways. I was therefore somewhat hesitant to include these in the first place, as it may make the user-overconfident and stop thinking about these things critically themselves. However, we decided to include as it gives the user a number of examples of how to use the functions from section 3.3.3 (db_query, combine_query, etc) to write functions to derive specific variables. We have tried to make it clear that these algorithms should be adapted/changed based on the desired algorithm for defining the variable.</p>
<p>Line 848: “However, it is important to state, that the correct way to define a variable may change from study to study. Therefore when using these functions to extract variables, we encourage taking the time to ensure that the way the variable is extracted matches the definition in one’s study, and edit these functions and algorithms accordingly.”</p>
<p>If you have a specific suggestion about how to deal with generic diabetes codes that is different to how we approach it, please let us know, as we can use it to bolster this argument. We could use it as example of an alternative way to specify the diabetes variable, and then make a broader point about how there are multiple ways to define al</p>
<section class="sm xbox font-sm" id="pone.0327229.s003"><div class="caption p">
<span>Attachment</span><p>Submitted filename: <em>Peer review response R1 rcprd 20250403.docx</em></p>
</div>
<div class="media p"><div class="caption">
<a href="/articles/instance/12364311/bin/pone.0327229.s003.docx" data-ga-action="click_feat_suppl" class="usa-link">pone.0327229.s003.docx</a><sup> (45.7KB, docx) </sup>
</div></div></section></section></article><article class="sub-article" id="pone.0327229.r003"><section class="pmc-layout__citation font-secondary font-xs"><div>PLoS One. doi: <a href="https://doi.org/10.1371/journal.pone.0327229.r003" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">10.1371/journal.pone.0327229.r003</a>
</div></section><section class="front-matter"><div class="ameta p font-secondary font-xs">
<hgroup><h1>Decision Letter 1</h1></hgroup><div class="cg p">
<a href="https://pubmed.ncbi.nlm.nih.gov/?term=%22Ramagopalan%20S%22%5BAuthor%5D" class="usa-link" aria-describedby="id6"><span class="name western">Sreeram Ramagopalan</span></a><div hidden="hidden" id="id6">
<h3><span class="name western">Sreeram Ramagopalan</span></h3>
<div>Academic Editor</div>
<div class="p">Find articles by <a href="https://pubmed.ncbi.nlm.nih.gov/?term=%22Ramagopalan%20S%22%5BAuthor%5D" class="usa-link"><span class="name western">Sreeram Ramagopalan</span></a>
</div>
</div>
</div>
<ul class="d-buttons inline-list">
<li><button class="d-button" aria-controls="aip_a.e" aria-expanded="false">Author information</button></li>
<li><button class="d-button" aria-controls="clp_a.e" aria-expanded="false">Copyright and License information</button></li>
</ul>
<div class="d-panels font-secondary-light">
<div id="aip_a.e" class="d-panel p" style="display: none">
<h4 class="font-secondary">Roles</h4>
<div class="p">
<strong class="contrib"><span class="name western">Sreeram Ramagopalan</span></strong>: <span class="role">Academic Editor</span>
</div>
</div>
<div id="clp_a.e" class="d-panel p" style="display: none">
<div>© 2025 Sreeram Ramagopalan</div>
<p>This is an open access article distributed under the terms of the <a href="https://creativecommons.org/licenses/by/4.0/" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">Creative Commons Attribution License</a> , which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</p>
<div class="p"><a href="/about/copyright/" class="usa-link">PMC Copyright notice</a></div>
</div>
</div>
<div></div>
</div></section><section class="body sub-article-body"><hr class="headless">
<p>
<em>12 Jun 2025</em>
</p>
<p>rcprd: An R package to simplify the extraction and processing of Clinical Practice Research Datalink (CPRD) data, and create analysis-ready datasets</p>
<p>PONE-D-24-51682R1</p>
<p>Dear Dr. Pate,</p>
<p>We’re pleased to inform you that your manuscript has been judged scientifically suitable for publication and will be formally accepted for publication once it meets all outstanding technical requirements.</p>
<p>Within one week, you’ll receive an e-mail detailing the required amendments. When these have been addressed, you’ll receive a formal acceptance letter and your manuscript will be scheduled for publication.</p>
<p>An invoice will be generated when your article is formally accepted. Please note, if your institution has a publishing partnership with PLOS and your article meets the relevant criteria, all or part of your publication costs will be covered. Please make sure your user information is up-to-date by logging into Editorial Manager at <a href="https://www.editorialmanager.com/pone/" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">Editorial Manager®</a>  and clicking the ‘Update My Information' link at the top of the page. If you have any questions relating to publication charges, please contact our Author Billing department directly at authorbilling@plos.org.</p>
<p>If your institution or institutions have a press office, please notify them about your upcoming paper to help maximize its impact. If they’ll be preparing press materials, please inform our press team as soon as possible -- no later than 48 hours after receiving the formal acceptance. Your manuscript will remain under strict press embargo until 2 pm Eastern Time on the date of publication. For more information, please contact onepress@plos.org.</p>
<p>Kind regards,</p>
<p>Sreeram V. Ramagopalan</p>
<p>Academic Editor</p>
<p>PLOS ONE</p>
<p>Additional Editor Comments (optional):</p>
<p>Reviewers' comments:</p></section></article><article class="sub-article" id="_ad93_"><section class="pmc-layout__citation font-secondary font-xs"><div></div></section><section class="front-matter"><div class="ameta p font-secondary font-xs">
<hgroup><h1>Associated Data</h1></hgroup><ul class="d-buttons inline-list"></ul>
<div class="d-panels font-secondary-light"></div>
<div></div>
<p class="font-secondary"><em>This section collects any data citations, data availability statements, or supplementary materials included in this article.</em></p>
</div></section><section class="body sub-article-body"><section id="_adsm93_" lang="en" class="supplementary-materials"><h2 class="pmc_sec_title">Supplementary Materials</h2>
<section class="sm xbox font-sm" id="db_ds_supplementary-material1_reqid_"><div class="caption p">
<span>Attachment</span><p>Submitted filename: <em>Comments PLos1.docx</em></p>
</div>
<div class="media p"><div class="caption">
<a href="/articles/instance/12364311/bin/pone.0327229.s001.docx" data-ga-action="click_feat_suppl" class="usa-link">pone.0327229.s001.docx</a><sup> (18.2KB, docx) </sup>
</div></div></section><section class="sm xbox font-sm" id="db_ds_supplementary-material2_reqid_"><div class="caption p">
<span>Attachment</span><p>Submitted filename: <em>Peer review response R1 rcprd 20250403.docx</em></p>
</div>
<div class="media p"><div class="caption">
<a href="/articles/instance/12364311/bin/pone.0327229.s003.docx" data-ga-action="click_feat_suppl" class="usa-link">pone.0327229.s003.docx</a><sup> (45.7KB, docx) </sup>
</div></div></section></section><section id="_adda93_" lang="en" class="data-availability-statement"><h2 class="pmc_sec_title">Data Availability Statement</h2>
<p>The package developed in this study is available from the Comprehensive R Archive Network at <a href="https://CRAN.R-project.org/package=rcprd" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">https://CRAN.R-project.org/package=rcprd</a>, or can be installed from the following GitHub repository: <a href="https://github.com/alexpate30/rcprd" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">https://github.com/alexpate30/rcprd</a>. The data for this worked example, which is simulated completely at random, is provided within the package. For the case-study we used synthetic patient-level data from the CPRD that are not publicly available. However, researchers can access these databases without a fee by contacting CPRD. Details of the application process and conditions of access are available at: <a href="https://www.cprd.com/synthetic-data" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">https://www.cprd.com/synthetic-data</a> and <a href="https://www.cprd.com/data-access" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">https://www.cprd.com/data-access</a>. Code for implementing the case study is provided in the supplementary material, and is available at the following GitHub page: <a href="https://github.com/manchester-predictive-healthcare-group/CHI-CHARIOT/" class="usa-link usa-link--external" data-ga-action="click_feat_suppl" target="_blank" rel="noopener noreferrer">https://github.com/manchester-predictive-healthcare-group/CHI-CHARIOT/</a>. The results in this paper were obtained using R version 4.4.0 with packages dplyr, tidyr, data.table, fastmatch, RSQLite, stringr, and all packages used are available from the Comprehensive Archive Network (CRAN).</p></section></section></article><footer class="p courtesy-note font-secondary font-sm text-center"><hr class="headless">
<p>Articles from PLOS One are provided here courtesy of <strong>PLOS</strong></p></footer></section></article>

                      

                    </main>
                </div>
            </div>
        </div>

        



<!-- Secondary navigation placeholder -->
<div class="pmc-sidenav desktop:grid-col-4 display-flex">
    <section class="pmc-sidenav__container" aria-label="Article resources and navigation">
        <button type="button" class="usa-button pmc-sidenav__container__close usa-button--unstyled">
            <img src="/static/img/usa-icons/close.svg" role="img" alt="Close" />
        </button>
    <div class="display-none desktop:display-block">
       <section class="margin-top-4 desktop:margin-top-0">
              <h2 class="margin-top-0">ACTIONS</h2>
           <ul class="usa-list usa-list--unstyled usa-list--actions">
               
               <li>
                     <a
                             href="https://doi.org/10.1371/journal.pone.0327229"
                             class="usa-button usa-button--outline width-24 font-xs display-inline-flex flex-align-center flex-justify-start padding-left-1"
                             target="_blank"
                             rel="noreferrer noopener"
                             data-ga-category="actions"
                             data-ga-action="click"
                             data-ga-label="publisher_link_desktop"
                     >
                         <svg class="usa-icon width-3 height-3" aria-hidden="true" focusable="false" role="img" hidden>
                            <use xlink:href="/static/img/sprite.svg#launch"></use>
                         </svg>
                         <span class="display-inline-flex flex-justify-center flex-1 padding-right-2">View on publisher site</span>
                     </a>
               </li>
               
               
               <li>
                    <a
                            href="pdf/pone.0327229.pdf"
                            class="usa-button usa-button--outline width-24 display-inline-flex flex-align-center flex-justify-start padding-left-1"
                            data-ga-category="actions"
                            data-ga-action="click"
                            data-ga-label="pdf_download_desktop"
                    >
                         <svg class="usa-icon width-3 height-3" aria-hidden="true" focusable="false" role="img" hidden>
                            <use xlink:href="/static/img/sprite.svg#file_download"></use>
                        </svg>
                        <span class="display-inline-flex flex-justify-center flex-1">PDF (2.8 MB)</span>
                    </a>
               </li>
               
                
               <li>
                   <button role="button" class="usa-button width-24 citation-dialog-trigger display-inline-flex flex-align-center flex-justify-start padding-left-1"
                        aria-label="Open dialog with citation text in different styles"
                        data-ga-category="actions"
                        data-ga-action="open"
                        data-ga-label="cite_desktop"
                        data-all-citations-url="/resources/citations/12364311/"
                        data-citation-style="nlm"
                        data-download-format-link="/resources/citations/12364311/export/"
                    >
                        <svg class="usa-icon width-3 height-3" aria-hidden="true" focusable="false" role="img" hidden>
                            <use xlink:href="/static/img/sprite.svg#format_quote"></use>
                        </svg>
                       <span class="display-inline-flex flex-justify-center flex-1 button-label">Cite</span>
                    </button>
               </li>
                
               <li>

                        <button class="usa-button width-24 collections-dialog-trigger collections-button display-inline-flex flex-align-center flex-justify-start padding-left-1 collections-button-empty"
                              aria-label="Save article in MyNCBI collections."
                              data-ga-category="actions"
                              data-ga-action="click"
                              data-ga-label="collections_button_desktop"
                              data-collections-open-dialog-enabled="false"
                              data-collections-open-dialog-url="https://account.ncbi.nlm.nih.gov/?back_url=https%3A%2F%2Fpmc.ncbi.nlm.nih.gov%2Farticles%2FPMC12364311%2F%3Freport%3Dclassic%23open-collections-dialog"
                              data-in-collections="false">
                            <svg class="usa-icon width-3 height-3 usa-icon--bookmark-full" aria-hidden="true" focusable="false" role="img" hidden>
                                <use xlink:href="/static/img/action-bookmark-full.svg#icon"></use>
                            </svg>
                            <svg class="usa-icon width-3 height-3 usa-icon--bookmark-empty" aria-hidden="true" focusable="false" role="img" hidden>
                                <use xlink:href="/static/img/action-bookmark-empty.svg#icon"></use>
                            </svg>
                            <span class="display-inline-flex flex-justify-center flex-1">Collections</span>
                       </button>
               </li>
               <li class="pmc-permalink">
                    <button
                            type="button"
                            class="usa-button width-24 display-inline-flex flex-align-center flex-justify padding-left-1 shadow-none"
                            aria-label="Show article permalink"
                            aria-expanded="false"
                            aria-haspopup="true"
                            data-ga-category="actions"
                            data-ga-action="open"
                            data-ga-label="permalink_desktop"
                    >
                         <svg class="usa-icon width-3 height-3" aria-hidden="true" focusable="false" role="img" hidden>
                            <use xlink:href="/static/img/sprite.svg#share"></use>
                        </svg>
                        <span class="display-inline-flex flex-justify-center flex-1 button-label">Permalink</span>
                    </button>
                   

<div class="pmc-permalink__dropdown" hidden>
    <div class="pmc-permalink__dropdown__container">
          <h2 class="usa-modal__heading margin-top-0 margin-bottom-2 text-uppercase font-sans-xs">PERMALINK</h2>
          <div class="pmc-permalink__dropdown__content">
              <input type="text" class="usa-input" value="https://pmc.ncbi.nlm.nih.gov/articles/PMC12364311/" aria-label="Article permalink">
              <button class="usa-button display-inline-flex pmc-permalink__dropdown__copy__btn margin-right-0" title="Copy article permalink" data-ga-category="save_share" data-ga-action="link" data-ga-label="copy_link">
                  <svg class="usa-icon" aria-hidden="true" focusable="false" role="img">
                    <use xlink:href="/static/img/sprite.svg#content_copy"></use>
                  </svg>
                  <span class="margin-left-1">Copy</span>
              </button>
          </div>
    </div>
</div>
               </li>
           </ul>
       </section>
     </div>

        <section class="pmc-resources margin-top-6 desktop:margin-top-4" data-page-path="/articles/PMC12364311/">
            <h2 class="margin-top-0">RESOURCES</h2>
            
                <div class="usa-accordion usa-accordion--multiselectable" data-allow-multiple>
                    <h3 class="usa-accordion__heading">
                        <button
                        type="button"
                        class="usa-accordion__button"
                        aria-expanded="false"
                        aria-controls="resources-similar-articles"
                        data-ga-category="resources_accordion"
                        data-ga-action="open_similar_articles"
                        data-ga-label="/articles/PMC12364311/"
                        data-action-open="open_similar_articles"
                        data-action-close="close_similar_articles"
                        >
                            Similar articles
                        </button>
                    </h3>
                    <div
                            id="resources-similar-articles"
                            class="usa-accordion__content usa-prose"
                            
                                data-source-url="/resources/similar-article-links/40828847/"
                            
                    >
                        
                    </div>
                    <h3 class="usa-accordion__heading">
                        <button
                        type="button"
                        class="usa-accordion__button"
                        aria-expanded="false"
                        aria-controls="resources-cited-by-other-articles"
                        data-ga-category="resources_accordion"
                        data-ga-action="open_cited_by"
                        data-ga-label="/articles/PMC12364311/"
                        data-action-open="open_cited_by"
                        data-action-close="close_cited_by"
                        >
                             Cited by other articles
                        </button>
                    </h3>
                    <div
                            id="resources-cited-by-other-articles"
                            class="usa-accordion__content usa-prose"
                            
                                data-source-url="/resources/cited-by-links/40828847/"
                            
                    >
                          
                    </div>
                    
                        <h3 class="usa-accordion__heading">
                            <button
                            type="button"
                            class="usa-accordion__button"
                            aria-expanded="false"
                            aria-controls="resources-links-to-ncbi-databases"
                            data-ga-category="resources_accordion"
                            data-ga-action="open_NCBI_links"
                            data-ga-label="/articles/PMC12364311/"
                            data-action-open="open_NCBI_links"
                            data-action-close="close_NCBI_link"
                            >
                                 Links to NCBI Databases
                            </button>
                        </h3>
                        <div
                                id="resources-links-to-ncbi-databases"
                                class="usa-accordion__content usa-prose"
                                data-source-url="/resources/db-links/12364311/"
                        >
                        </div>
                    
                    
                </div>
            
        </section>


        <section
        class="usa-in-page-nav usa-in-page-nav--wide margin-top-6 desktop:margin-top-4"
        data-title-text="On this page"
        data-title-heading-level="h2"
        data-scroll-offset="0"
        data-root-margin="-10% 0px -80% 0px"
        data-main-content-selector="main"
        data-threshold="1"
        hidden
        ></section>
    </section>
</div>


        

<div class="overlay" role="dialog" aria-label="Citation Dialog" hidden>
    <div class="dialog citation-dialog" aria-hidden="true">
        <div class="display-inline-flex flex-align-center flex-justify width-full margin-bottom-2">
            <h2 class="usa-modal__heading margin-0">Cite</h2>
             <button type="button" class="usa-button usa-button--unstyled close-overlay text-black width-auto"  tabindex="1">
                <svg class="usa-icon width-3 height-3" aria-hidden="true" focusable="false" role="img">
                    <use xlink:href="/static/img/sprite.svg#close"></use>
                </svg>
             </button>
        </div>

        

<div class="citation-text-block">
  <div class="citation-text margin-bottom-2"></div>
  <ul class="usa-list usa-list--unstyled display-inline-flex flex-justify width-full flex-align-center">
      <li>
        <button
          class="usa-button usa-button--unstyled text-no-underline display-flex flex-align-center copy-button dialog-focus"
          data-ga-category="save_share"
          data-ga-action="cite"
          data-ga-label="copy"
          tabindex="2">
            <svg class="usa-icon width-3 height-3" aria-hidden="true" focusable="false" role="img">
                <use xlink:href="/static/img/sprite.svg#content_copy"></use>
            </svg>
            <span>Copy</span>
        </button>
      </li>
      <li>
          <a
              href="#"
              role="button"
              class="usa-button usa-button--unstyled text-no-underline display-flex flex-align-center export-button"
              data-ga-category="save_share"
              data-ga-action="cite"
              data-ga-label="download"
              title="Download a file for external citation management software"
              tabindex="3">
                <svg class="usa-icon width-3 height-3" aria-hidden="true" focusable="false" role="img">
                    <use xlink:href="/static/img/sprite.svg#file_download"></use>
                </svg>
                <span class="display-none mobile-lg:display-inline">Download .nbib</span>
                <span class="display-inline mobile-lg:display-none">.nbib</span>
            </a>
      </li>
      <li>
          

<div class="display-inline-flex flex-align-center">
  <label class="usa-label margin-top-0">Format:</label>
  <select aria-label="Format" class="usa-select citation-style-selector padding-1 margin-top-0 border-0 padding-right-4" tabindex="4" >
    
      <option data-style-url-name="ama"
              value="AMA"
              >
        AMA
      </option>
    
      <option data-style-url-name="apa"
              value="APA"
              >
        APA
      </option>
    
      <option data-style-url-name="mla"
              value="MLA"
              >
        MLA
      </option>
    
      <option data-style-url-name="nlm"
              value="NLM"
              selected="selected">
        NLM
      </option>
    
  </select>
</div>
      </li>
  </ul>
</div>
    </div>
</div>

        <div class="overlay" role="dialog" hidden>
  <div id="collections-action-dialog" class="dialog collections-dialog" aria-hidden="true">
   <div class="display-inline-flex flex-align-center flex-justify width-full margin-bottom-2">
        <h2 class="usa-modal__heading margin-0">Add to Collections</h2>
    </div>
    <div class="collections-action-panel action-panel">
      


<form id="collections-action-dialog-form"
      class="usa-form maxw-full collections-action-panel-form action-panel-content action-form action-panel-smaller-selectors"
      data-existing-collections-url="/list-existing-collections/"
      data-add-to-existing-collection-url="/add-to-existing-collection/"
      data-create-and-add-to-new-collection-url="/create-and-add-to-new-collection/"
      data-myncbi-max-collection-name-length="100"
      data-collections-root-url="https://www.ncbi.nlm.nih.gov/myncbi/collections/">

    <input type="hidden" name="csrfmiddlewaretoken" value="oobhgrUb7JdXeU8Z6IsxNWbpGfwEgngWtMznI8IXurRUXLfQz58xYafH2OYULb2N">

    <fieldset class="usa-fieldset margin-bottom-2">
        <div class="usa-radio">
            <input type="radio"
            id="collections-action-dialog-new"
            class="usa-radio__input usa-radio__input--tile collections-new  margin-top-0"
            name="collections"
            value="new"
            data-ga-category="collections_button"
            data-ga-action="click"
            data-ga-label="collections_radio_new" />
            <label class="usa-radio__label" for="collections-action-dialog-new">Create a new collection</label>
        </div>
        <div class="usa-radio">
            <input type="radio"
            id="collections-action-dialog-existing"
            class="usa-radio__input usa-radio__input--tile collections-existing"
            name="collections"
            value="existing"
            checked="true"
            data-ga-category="collections_button"
            data-ga-action="click"
            data-ga-label="collections_radio_existing" />
            <label class="usa-radio__label" for="collections-action-dialog-existing">Add to an existing collection</label>
        </div>
    </fieldset>

    <fieldset class="usa-fieldset margin-bottom-2">
        <div class="action-panel-control-wrap new-collections-controls">
           <label for="collections-action-dialog-add-to-new" class="usa-label margin-top-0">
                Name your collection
               <abbr title="required" class="usa-hint usa-hint--required text-no-underline">*</abbr>
          </label>
          <input
            type="text"
            name="add-to-new-collection"
            id="collections-action-dialog-add-to-new"
            class="usa-input collections-action-add-to-new"
            pattern="[^&quot;&amp;=&lt;&gt;/]*" title="The following characters are not allowed in the Name field: &quot;&amp;=&lt;&gt;/"
            maxlength=""
            data-ga-category="collections_button"
            data-ga-action="create_collection"
            data-ga-label="non_favorties_collection"
            required
          />
        </div>
        <div class="action-panel-control-wrap existing-collections-controls">
             <label for="collections-action-dialog-add-to-existing" class="usa-label margin-top-0">
                Choose a collection
              </label>
              <select id="collections-action-dialog-add-to-existing"
                      class="usa-select collections-action-add-to-existing"
                      data-ga-category="collections_button"
                      data-ga-action="select_collection"
                      data-ga-label="($('.collections-action-add-to-existing').val() === 'Favorites') ? 'Favorites' : 'non_favorites_collection'">
              </select>
              <div class="collections-retry-load-on-error usa-input-error-message selection-validation-message">
                Unable to load your collection due to an error<br>
                <a href="#">Please try again</a>
              </div>
        </div>
    </fieldset>

    <div class="display-inline-flex">
        <button class="usa-button margin-top-0 action-panel-submit"
            type="submit"
            data-loading-label="Adding..."
            data-pinger-ignore
            data-ga-category="collections_button"
            data-ga-action="click"
            data-ga-label="add">
          Add
        </button>
        <button class="usa-button usa-button--outline margin-top-0 action-panel-cancel"
                aria-label="Close 'Add to Collections' panel"
                ref="linksrc=close_collections_panel"
                data-ga-category="collections_button"
                data-ga-action="click"
                data-ga-label="cancel">
          Cancel
        </button>
    </div>
</form>
    </div>
  </div>
</div>

        

      </div>
    </div>
  </div>



        
    
    

<footer class="ncbi-footer ncbi-dark-background " >
    
        <div class="ncbi-footer__icon-section">
            <div class="ncbi-footer__social-header">
                Follow NCBI
            </div>

            <div class="grid-container ncbi-footer__ncbi-social-icons-container">
                
                    <a href="https://twitter.com/ncbi"
                       class="ncbi-footer__social-icon ncbi-footer__social-icon--gray"
                       target="_blank"
                       rel="noreferrer noopener">
                        <svg width="40"
                             height="40"
                             viewBox="0 0 40 40"
                             fill="none"
                             xmlns="http://www.w3.org/2000/svg"
                             focusable="false"
                             aria-hidden="true">
                            <path d="m6.067 8 10.81 13.9L6 33.2h4.2l8.4-9.1 7.068 9.1H34L22.8 18.5 31.9 8h-3.5l-7.7 8.4L14.401 8H6.067Zm3.6 1.734h3.266l16.8 21.732H26.57L9.668 9.734Z">
                            </path>
                        </svg>
                        <span class="usa-sr-only">NCBI on X (formerly known as Twitter)</span>
                    </a>
                

                
                    <a href="https://www.facebook.com/ncbi.nlm"
                       class="ncbi-footer__social-icon ncbi-footer__social-icon--gray"
                       target="_blank"
                       rel="noreferrer noopener">
                        <svg width="16"
                             height="29"
                             focusable="false"
                             aria-hidden="true"
                             viewBox="0 0 16 29"
                             fill="none"
                             xmlns="http://www.w3.org/2000/svg">
                            <path d="M3.8809 21.4002C3.8809 19.0932 3.8809 16.7876 3.8809 14.478C3.8809 14.2117 3.80103 14.1452 3.54278 14.1492C2.53372 14.1638 1.52334 14.1492 0.514288 14.1598C0.302626 14.1598 0.248047 14.0972 0.248047 13.8936C0.256034 12.4585 0.256034 11.0239 0.248047 9.58978C0.248047 9.37013 0.302626 9.30224 0.528931 9.3049C1.53798 9.31688 2.54837 9.3049 3.55742 9.31555C3.80103 9.31555 3.8809 9.26097 3.87957 9.00272C3.87158 8.00565 3.85428 7.00592 3.90753 6.00884C3.97142 4.83339 4.31487 3.73115 5.04437 2.78467C5.93095 1.63318 7.15699 1.09005 8.56141 0.967577C10.5582 0.79319 12.555 0.982221 14.5518 0.927641C14.7102 0.927641 14.7462 0.99287 14.7449 1.13664C14.7449 2.581 14.7449 4.02668 14.7449 5.47104C14.7449 5.67604 14.6517 5.68669 14.4946 5.68669C13.4523 5.68669 12.4113 5.68669 11.3703 5.68669C10.3506 5.68669 9.92057 6.10868 9.90593 7.13904C9.89661 7.7647 9.91525 8.39303 9.89794 9.01869C9.88995 9.26364 9.96583 9.31822 10.2015 9.31688C11.7204 9.30623 13.2393 9.31688 14.7595 9.3049C15.0257 9.3049 15.0723 9.3728 15.0444 9.62439C14.89 10.9849 14.7515 12.3467 14.6144 13.7085C14.5691 14.1571 14.5785 14.1585 14.1458 14.1585C12.8386 14.1585 11.5313 14.1665 10.2254 14.1518C9.95119 14.1518 9.89794 14.2317 9.89794 14.4899C9.90593 19.0799 9.89794 23.6752 9.91125 28.2612C9.91125 28.5674 9.8407 28.646 9.53186 28.6433C7.77866 28.6273 6.02414 28.6366 4.27094 28.634C3.82499 28.634 3.87158 28.6992 3.87158 28.22C3.87602 25.9472 3.87913 23.6739 3.8809 21.4002Z">
                            </path>
                        </svg>
                        <span class="usa-sr-only">NCBI on Facebook</span>
                    </a>
                

                
                    <a href="https://www.linkedin.com/company/ncbinlm"
                       class="ncbi-footer__social-icon ncbi-footer__social-icon--gray"
                       target="_blank"
                       rel="noreferrer noopener">
                        <svg width="25"
                             height="23"
                             viewBox="0 0 26 24"
                             fill="none"
                             xmlns="http://www.w3.org/2000/svg"
                             focusable="false"
                             aria-hidden="true">
                            <path d="M14.6983 9.98423C15.6302 9.24808 16.5926 8.74754 17.6762 8.51991C19.673 8.09126 21.554 8.30824 23.1262 9.7526C24.2351 10.7723 24.7529 12.1115 25.0165 13.5612C25.1486 14.3363 25.2105 15.1218 25.2015 15.9081C25.2015 18.3043 25.2015 20.6898 25.2082 23.0806C25.2082 23.3468 25.1549 23.444 24.8621 23.4414C23.1297 23.4272 21.3992 23.4272 19.6704 23.4414C19.4041 23.4414 19.3429 23.3588 19.3442 23.1019C19.3535 20.5194 19.3442 17.9368 19.3442 15.3543C19.3442 14.0005 18.3258 12.9448 17.0266 12.9488C15.7273 12.9528 14.6983 14.0071 14.6983 15.361C14.6983 17.9328 14.6917 20.5047 14.6983 23.0753C14.6983 23.3708 14.6198 23.444 14.3296 23.4427C12.6185 23.4294 10.9079 23.4294 9.19779 23.4427C8.93155 23.4427 8.86099 23.3735 8.86232 23.1086C8.8783 19.7619 8.88628 16.4144 8.88628 13.066C8.88628 11.5688 8.87874 10.0708 8.86365 8.57182C8.86365 8.3575 8.90758 8.27896 9.14054 8.28029C10.9048 8.29094 12.6687 8.29094 14.4321 8.28029C14.6464 8.28029 14.6983 8.34818 14.6983 8.54653C14.6903 9.00047 14.6983 9.45441 14.6983 9.98423Z">
                            </path>
                            <path d="M6.55316 15.8443C6.55316 18.2564 6.55316 20.6699 6.55316 23.082C6.55316 23.3629 6.48127 23.4388 6.19906 23.4374C4.47737 23.4241 2.75568 23.4241 1.03399 23.4374C0.767751 23.4374 0.69986 23.3629 0.701191 23.1006C0.709178 18.2648 0.709178 13.4281 0.701191 8.59053C0.701191 8.34026 0.765089 8.27237 1.01669 8.2737C2.74991 8.28435 4.48048 8.28435 6.20838 8.2737C6.47462 8.2737 6.5465 8.33627 6.54517 8.6065C6.54783 11.0186 6.55316 13.4308 6.55316 15.8443Z">
                            </path>
                            <path d="M3.65878 0.243898C5.36804 0.243898 6.58743 1.45529 6.58743 3.1406C6.58743 4.75801 5.32145 5.95742 3.60819 5.96807C3.22177 5.97614 2.83768 5.90639 2.47877 5.76299C2.11985 5.61959 1.79344 5.40546 1.51897 5.13334C1.24449 4.86123 1.02755 4.53668 0.881058 4.17902C0.734563 3.82136 0.661505 3.43788 0.666231 3.05141C0.67555 1.42601 1.9362 0.242566 3.65878 0.243898Z">
                            </path>
                        </svg>
                        <span class="usa-sr-only">NCBI on LinkedIn</span>
                    </a>
                

                
                    <a href="https://github.com/ncbi"
                       class="ncbi-footer__social-icon ncbi-footer__social-icon--gray"
                       target="_blank"
                       rel="noreferrer noopener">
                        <svg width="28"
                             height="27"
                             viewBox="0 0 28 28"
                             fill="none"
                             xmlns="http://www.w3.org/2000/svg"
                             focusable="false"
                             aria-hidden="true">
                            <path d="M16.7228 20.6334C17.5057 20.5527 18.2786 20.3944 19.0301 20.1608C21.3108 19.4193 22.5822 17.8259 22.963 15.4909C23.1228 14.5112 23.1814 13.5287 22.9883 12.5437C22.8106 11.6423 22.4013 10.8028 21.8007 10.1076C21.7526 10.0605 21.7197 10 21.7064 9.934C21.6931 9.86799 21.7 9.79952 21.7262 9.73748C22.0856 8.6206 21.9711 7.51969 21.601 6.42677C21.582 6.3497 21.5345 6.2827 21.468 6.23923C21.4016 6.19577 21.3211 6.17906 21.2429 6.19248C20.7329 6.21649 20.2313 6.33051 19.7611 6.52928C19.1103 6.7908 18.4899 7.12198 17.9104 7.51703C17.84 7.56996 17.7581 7.60551 17.6713 7.62078C17.5846 7.63605 17.4954 7.6306 17.4112 7.60489C15.2596 7.05882 13.0054 7.06203 10.8554 7.61421C10.7806 7.63586 10.7018 7.63967 10.6253 7.62534C10.5487 7.611 10.4766 7.57892 10.4148 7.53167C9.64788 7.03247 8.85171 6.58918 7.96368 6.33359C7.65781 6.24338 7.34123 6.19458 7.02239 6.18849C6.94879 6.17986 6.87462 6.19893 6.81432 6.242C6.75402 6.28507 6.71191 6.34904 6.69621 6.42145C6.32342 7.51437 6.2209 8.61527 6.56307 9.73348C6.59635 9.84264 6.64694 9.93316 6.54177 10.0516C5.47666 11.2604 5.09988 12.6834 5.19574 14.2676C5.2663 15.4244 5.46201 16.5466 6.01454 17.5769C6.84399 19.1171 8.21664 19.9119 9.85158 20.3352C10.3938 20.4706 10.9444 20.5698 11.4998 20.632C11.5384 20.7492 11.4506 20.7798 11.408 20.8291C11.1734 21.1179 10.9894 21.4441 10.8634 21.7942C10.7622 22.0458 10.8315 22.4039 10.6065 22.5516C10.263 22.7766 9.83827 22.8485 9.42421 22.8871C8.17936 23.0056 7.26471 22.4877 6.6283 21.4348C6.25552 20.8184 5.76956 20.3325 5.08523 20.0663C4.76981 19.9325 4.42139 19.8967 4.08537 19.9638C3.7898 20.029 3.73788 20.1901 3.93891 20.4111C4.03639 20.5234 4.14989 20.6207 4.27575 20.6999C4.9796 21.1318 5.51717 21.7884 5.80152 22.5636C6.37002 23.9973 7.48039 24.5697 8.93825 24.6323C9.43741 24.6575 9.93768 24.615 10.4254 24.5058C10.5892 24.4672 10.6531 24.4872 10.6517 24.6762C10.6451 25.4936 10.6637 26.3123 10.6517 27.131C10.6517 27.6635 10.1684 27.9297 9.58663 27.7393C8.17396 27.2671 6.84977 26.5631 5.66838 25.656C2.59555 23.2891 0.720966 20.1861 0.217704 16.3376C-0.357453 11.9127 0.911353 8.00824 3.98551 4.73881C6.11909 2.42656 8.99932 0.939975 12.1203 0.540191C16.5351 -0.0601815 20.4347 1.14323 23.7232 4.16373C26.2449 6.47869 27.724 9.37672 28.1048 12.7726C28.5828 17.0325 27.3686 20.7945 24.4768 23.9827C22.9762 25.6323 21.0956 26.8908 18.9982 27.6488C18.8783 27.6927 18.7585 27.738 18.636 27.7726C18.0356 27.9404 17.6189 27.6395 17.6189 27.0098C17.6189 25.7452 17.6308 24.4806 17.6295 23.2159C17.6329 22.9506 17.6128 22.6856 17.5696 22.4238C17.4325 21.6664 17.3419 21.484 16.7228 20.6334Z">
                            </path>
                        </svg>
                        <span class="usa-sr-only">NCBI on GitHub</span>
                    </a>
                

                
                    <a href="https://ncbiinsights.ncbi.nlm.nih.gov/"
                       class="ncbi-footer__social-icon ncbi-footer__social-icon--gray"
                       target="_blank"
                       rel="noreferrer noopener">
                        <svg width="26"
                             height="26"
                             viewBox="0 0 27 27"
                             fill="none"
                             xmlns="http://www.w3.org/2000/svg"
                             focusable="false"
                             aria-hidden="true">
                            <path d="M23.7778 26.4574C23.1354 26.3913 22.0856 26.8024 21.636 26.3087C21.212 25.8444 21.4359 24.8111 21.324 24.0347C19.9933 14.8323 14.8727 8.80132 6.09057 5.85008C4.37689 5.28406 2.58381 4.99533 0.779072 4.99481C0.202773 4.99481 -0.0229751 4.83146 0.00455514 4.21479C0.0660406 3.08627 0.0660406 1.95525 0.00455514 0.826734C-0.0413285 0.0815827 0.259669 -0.0193618 0.896534 0.00266238C6.96236 0.222904 12.3693 2.24179 16.9889 6.16209C22.9794 11.2478 26.1271 17.7688 26.4372 25.648C26.4629 26.294 26.3179 26.5271 25.6609 26.4684C25.0827 26.417 24.4991 26.4574 23.7778 26.4574Z">
                            </path>
                            <path d="M14.8265 26.441C14.0924 26.441 13.2371 26.6795 12.6626 26.3786C12.0092 26.0372 12.3781 25.0644 12.246 24.378C11.1154 18.5324 6.6849 14.5497 0.74755 14.1001C0.217135 14.0615 -0.0104482 13.9422 0.0134113 13.3659C0.0519536 12.1454 0.0482829 10.9213 0.0134113 9.69524C-0.00127145 9.14464 0.196946 9.03268 0.703502 9.04736C9.21217 9.27128 16.5994 16.2511 17.2804 24.7231C17.418 26.4446 17.418 26.4446 15.6579 26.4446H14.832L14.8265 26.441Z">
                            </path>
                            <path d="M3.58928 26.4555C2.64447 26.4618 1.73584 26.0925 1.06329 25.4289C0.39073 24.7653 0.00933763 23.8617 0.0030097 22.9169C-0.00331824 21.9721 0.365937 21.0635 1.02954 20.3909C1.69315 19.7184 2.59675 19.337 3.54156 19.3306C4.48637 19.3243 5.39499 19.6936 6.06755 20.3572C6.7401 21.0208 7.1215 21.9244 7.12782 22.8692C7.13415 23.814 6.7649 24.7226 6.10129 25.3952C5.43768 26.0677 4.53409 26.4491 3.58928 26.4555Z">
                            </path>
                        </svg>
                        <span class="usa-sr-only">NCBI RSS feed</span>
                    </a>
                
            </div>
        </div>
    

    <div data-testid="gridContainer"
         class="grid-container ncbi-footer__container">
        <div class="grid-row ncbi-footer__main-content-container"
             data-testid="grid">
            
                <div class="ncbi-footer__column">
                    
                        <p class="ncbi-footer__circled-icons-heading">
                            Connect with NLM
                        </p>
                    

                    <div class="ncbi-footer__circled-icons-list">
                        
                            <a href=https://twitter.com/nlm_nih class="ncbi-footer__social-icon ncbi-footer__social-icon--circled" target="_blank" rel="noreferrer noopener">
                                <svg width="32"
                                     height="32"
                                     viewBox="0 0 40 40"
                                     fill="none"
                                     xmlns="http://www.w3.org/2000/svg"
                                     focusable="false"
                                     aria-hidden="true">
                                    <path d="m6.067 8 10.81 13.9L6 33.2h4.2l8.4-9.1 7.068 9.1H34L22.8 18.5 31.9 8h-3.5l-7.7 8.4L14.401 8H6.067Zm3.6 1.734h3.266l16.8 21.732H26.57L9.668 9.734Z">
                                    </path>
                                </svg>
                                <span class="usa-sr-only">NLM on X (formerly known as Twitter)</span>
                            </a>
                        

                        
                            <a href=https://www.facebook.com/nationallibraryofmedicine class="ncbi-footer__social-icon ncbi-footer__social-icon--circled" target="_blank" rel="noreferrer noopener">
                                <svg width="13"
                                     height="24"
                                     viewBox="0 0 13 24"
                                     fill="none"
                                     xmlns="http://www.w3.org/2000/svg"
                                     focusable="false"
                                     aria-hidden="true">
                                    <path d="M4.11371 23.1369C4.11371 23.082 4.11371 23.0294 4.11371 22.9745V12.9411H0.817305C0.6709 12.9411 0.670898 12.9411 0.670898 12.8016C0.670898 11.564 0.670898 10.3287 0.670898 9.09341C0.670898 8.97903 0.705213 8.95158 0.815017 8.95158C1.8673 8.95158 2.91959 8.95158 3.97417 8.95158H4.12057V8.83263C4.12057 7.8055 4.12057 6.7738 4.12057 5.74897C4.1264 4.92595 4.31387 4.11437 4.66959 3.37217C5.12916 2.38246 5.94651 1.60353 6.95717 1.1921C7.64827 0.905008 8.3913 0.764035 9.13953 0.778051C10.0019 0.791777 10.8644 0.830666 11.7268 0.860404C11.8869 0.860404 12.047 0.894717 12.2072 0.90158C12.2964 0.90158 12.3261 0.940469 12.3261 1.02968C12.3261 1.5421 12.3261 2.05452 12.3261 2.56465C12.3261 3.16857 12.3261 3.7725 12.3261 4.37642C12.3261 4.48165 12.2964 4.51367 12.1912 4.51138C11.5369 4.51138 10.8804 4.51138 10.2261 4.51138C9.92772 4.51814 9.63058 4.5526 9.33855 4.61433C9.08125 4.6617 8.84537 4.78881 8.66431 4.97766C8.48326 5.16652 8.3662 5.40755 8.32972 5.66661C8.28476 5.89271 8.26027 6.1224 8.25652 6.35289C8.25652 7.19014 8.25652 8.02969 8.25652 8.86923C8.25652 8.89439 8.25652 8.91955 8.25652 8.95615H12.0219C12.1797 8.95615 12.182 8.95616 12.1614 9.10714C12.0768 9.76596 11.9876 10.4248 11.9029 11.0813C11.8312 11.6319 11.7626 12.1824 11.697 12.733C11.6719 12.9434 11.6787 12.9434 11.4683 12.9434H8.26338V22.899C8.26338 22.979 8.26338 23.0591 8.26338 23.1392L4.11371 23.1369Z">
                                    </path>
                                </svg>
                                <span class="usa-sr-only">NLM on Facebook</span>
                            </a>
                        

                        
                            <a href=https://www.youtube.com/user/NLMNIH class="ncbi-footer__social-icon ncbi-footer__social-icon--circled" target="_blank" rel="noreferrer noopener">
                                <svg width="21"
                                     height="15"
                                     viewBox="0 0 21 15"
                                     fill="none"
                                     xmlns="http://www.w3.org/2000/svg"
                                     focusable="false"
                                     aria-hidden="true">
                                    <path d="M19.2561 1.47914C18.9016 1.15888 18.5699 0.957569 17.2271 0.834039C15.5503 0.678484 13.2787 0.655608 11.563 0.65332H9.43556C7.71987 0.65332 5.4483 0.678484 3.77151 0.834039C2.43098 0.957569 2.097 1.15888 1.74242 1.47914C0.813665 2.32097 0.619221 4.62685 0.598633 6.89384C0.598633 7.31781 0.598633 7.74101 0.598633 8.16345C0.626084 10.4121 0.827391 12.686 1.74242 13.521C2.097 13.8412 2.4287 14.0425 3.77151 14.1661C5.4483 14.3216 7.71987 14.3445 9.43556 14.3468H11.563C13.2787 14.3468 15.5503 14.3216 17.2271 14.1661C18.5676 14.0425 18.9016 13.8412 19.2561 13.521C20.1712 12.6929 20.3725 10.451 20.3999 8.22064C20.3999 7.74025 20.3999 7.25986 20.3999 6.77946C20.3725 4.54907 20.1689 2.30724 19.2561 1.47914ZM8.55942 10.5311V4.65201L13.5601 7.50005L8.55942 10.5311Z"
                                          fill="white" />
                                </svg>
                                <span class="usa-sr-only">NLM on YouTube</span>
                            </a>
                        
                    </div>
                </div>
            

            
                <address class="ncbi-footer__address ncbi-footer__column">
                    
        <p>
            <a class="usa-link usa-link--external"
            href="https://www.google.com/maps/place/8600+Rockville+Pike,+Bethesda,+MD+20894/%4038.9959508,
            -77.101021,17z/data%3D!3m1!4b1!4m5!3m4!1s0x89b7c95e25765ddb%3A0x19156f88b27635b8!8m2!3d38.9959508!
            4d-77.0988323"
            rel="noopener noreferrer" target="_blank">National Library of Medicine
            <br/> 8600 Rockville Pike<br/> Bethesda, MD 20894</a>
        </p>
    
                </address>
            

            
                <ul class="usa-list usa-list--unstyled ncbi-footer__vertical-list ncbi-footer__column">
                    
                        <li class="ncbi-footer__vertical-list-item">
                            









    <a href="https://www.nlm.nih.gov/web_policies.html" class="usa-link  usa-link--alt ncbi-footer__link"  >
        

        
            Web Policies
        

        
    </a>


                        </li>
                    
                        <li class="ncbi-footer__vertical-list-item">
                            









    <a href="https://www.nih.gov/institutes-nih/nih-office-director/office-communications-public-liaison/freedom-information-act-office" class="usa-link  usa-link--alt ncbi-footer__link"  >
        

        
            FOIA
        

        
    </a>


                        </li>
                    
                        <li class="ncbi-footer__vertical-list-item">
                            









    <a href="https://www.hhs.gov/vulnerability-disclosure-policy/index.html" class="usa-link usa-link--external usa-link--alt ncbi-footer__link" rel="noreferrer noopener" target='_blank' >
        

        
            HHS Vulnerability Disclosure
        

        
    </a>


                        </li>
                    
                </ul>
            

            
                <ul class="usa-list usa-list--unstyled ncbi-footer__vertical-list ncbi-footer__column">
                    
                        <li class="ncbi-footer__vertical-list-item">
                            









    <a href="https://support.nlm.nih.gov/" class="usa-link  usa-link--alt ncbi-footer__link"  >
        

        
            Help
        

        
    </a>


                        </li>
                    
                        <li class="ncbi-footer__vertical-list-item">
                            









    <a href="https://www.nlm.nih.gov/accessibility.html" class="usa-link  usa-link--alt ncbi-footer__link"  >
        

        
            Accessibility
        

        
    </a>


                        </li>
                    
                        <li class="ncbi-footer__vertical-list-item">
                            









    <a href="https://www.nlm.nih.gov/careers/careers.html" class="usa-link  usa-link--alt ncbi-footer__link"  >
        

        
            Careers
        

        
    </a>


                        </li>
                    
                </ul>
            
        </div>

        
            <div class="grid-row grid-col-12" data-testid="grid">
                <ul class="ncbi-footer__bottom-links-list">
                    
                        <li class="ncbi-footer__bottom-list-item">
                            









    <a href="https://www.nlm.nih.gov/" class="usa-link  usa-link--alt ncbi-footer__link"  >
        

        
            NLM
        

        
    </a>


                        </li>
                    
                        <li class="ncbi-footer__bottom-list-item">
                            









    <a href="https://www.nih.gov/" class="usa-link  usa-link--alt ncbi-footer__link"  >
        

        
            NIH
        

        
    </a>


                        </li>
                    
                        <li class="ncbi-footer__bottom-list-item">
                            









    <a href="https://www.hhs.gov/" class="usa-link usa-link--external usa-link--alt ncbi-footer__link" rel="noreferrer noopener" target='_blank' >
        

        
            HHS
        

        
    </a>


                        </li>
                    
                        <li class="ncbi-footer__bottom-list-item">
                            









    <a href="https://www.usa.gov/" class="usa-link usa-link--external usa-link--alt ncbi-footer__link" rel="noreferrer noopener" target='_blank' >
        

        
            USA.gov
        

        
    </a>


                        </li>
                    
                </ul>
            </div>
        
    </div>
</footer>

    


        
        
    
  <script  type="text/javascript" src="https://cdn.ncbi.nlm.nih.gov/core/pinger/pinger.js"> </script>


    
        

<button class="back-to-top" data-ga-category="pagination" data-ga-action="back_to_top">
    <label>Back to Top</label>
    <svg class="usa-icon order-0" aria-hidden="true" focusable="false" role="img">
        <use xlink:href="/static/img/sprite.svg#arrow_upward"></use>
    </svg>
</button>
    


        
    
    
    
        
    <script type="application/javascript">
    window.ncbi = window.ncbi || {};
    window.ncbi.pmc = window.ncbi.pmc || {};
    window.ncbi.pmc.options = {
        logLevel: 'INFO',
        
        staticEndpoint: '/static/',
        
        citeCookieName: 'pmc-cf',
    };
</script>
    <script type="module" crossorigin="" src="/static/assets/base-133c6271.js"></script>
    
    <script type="text/javascript" src="https://cdn.ncbi.nlm.nih.gov/core/jquery/jquery-3.6.0.min.js">&#xA0;</script>
    <script type="text/javascript">
        jQuery.getScript("https://cdn.ncbi.nlm.nih.gov/core/alerts/alerts.js", function () {
            galert(['div.nav_and_browser', 'div.header', '#universal_header', '.usa-banner', 'body > *:nth-child(1)'])
        });
    </script>


    <script type="text/javascript">var exports = {};</script>
     <script src="/static/CACHE/js/output.13b077bc3ffd.js"></script>

    <script type="module" crossorigin="" src="/static/assets/article-44d04358.js"></script>
    
        <script type="module" crossorigin="" src="/static/assets/math-574fdcc6.js"></script>
    
    

    </body>
</html>
